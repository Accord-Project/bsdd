<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Semantic bSDD</title>
<meta name="author" content="Vladimir Alexiev, Mihail Radkov, Nataliya Keberle" />
<meta name="keywords" content="Linked building data, LBD, buildingSMART Data Dictionary, bSDD, FAIR data, data quality" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<style> #content {max-width: 120em; margin: auto} h1,h2,h3,h4,h5,h6,h7 {font-family: Arial} .author, .date, .creator {-webkit-margin-before: 0em; -webkit-margin-after: 0em} .abstract {margin: 1em; padding: 1em; border: 1px solid black} .abstract:before {content: 'Abstract: '; font-weight: bold} #preamble p {font-size: 110%%; margin-left: auto; margin-right: auto; text-align: center} th.org-left   {text-align:left} th.org-right  {text-align:right} th.org-center {text-align:center} th, td {line-height: 1em; border-width: 1px; border-style: solid solid; border-spacing: 2px 2px; padding: 2px 1px} .CANCELED {color: blue} .MAYBE {color: blue} .POSTPONED {color: blue} .SAME {color: blue} .APPLIED {color: orange} .FOLLOW {color: orange} .INPROGRESS {color: orange} .NEXT {color: orange} .IER {color: orange}.underline {text-decoration:underline} </style>
<link rel="icon" type="image/x-icon" href="img/favicon.ico">
</head>
<body>
<div id="preamble" class="status">
<p class='author'>Author: Vladimir Alexiev, Mihail Radkov, Nataliya Keberle<br/>(<a href="mailto:vladimir.alexiev@ontotext.com">vladimir.alexiev@ontotext.com</a>)</p><p class='date'>Date: 2023-03-23</p><p><img src='./img/SemBSDD-Logo-400px.png'/></p>
</div>
<div id="content" class="content">
<h1 class="title">Semantic bSDD
<br />
<span class="subtitle">Improving the GraphQL, JSON and RDF Representations of buildingSmart Data Dictionary</span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#abstract">1. Abstract</a></li>
<li><a href="#introduction">2. Introduction</a>
<ul>
<li><a href="#bsdd">2.1. bSDD</a></li>
<li><a href="#graphql-benefits">2.2. GraphQL Benefits</a></li>
<li><a href="#original-graphql-bsdd-schema-voyager">2.3. Original GraphQL bSDD Schema: Voyager</a></li>
<li><a href="#original-graphql-bsdd-schema-problems">2.4. Original GraphQL bSDD Schema: Problems</a></li>
<li><a href="#refactored-graphql-bsdd-schema-voyager">2.5. Refactored GraphQL bSDD Schema: Voyager</a></li>
<li><a href="#graphiql-querying-of-original-endpoint">2.6. GraphiQL Querying of Original Endpoint</a></li>
<li><a href="#graphiql-querying-of-refactored-endpoint">2.7. GraphiQL Querying of Refactored Endpoint</a></li>
<li><a href="#files">2.8. Files</a></li>
<li><a href="#endpoints-and-pages">2.9. Endpoints and Pages</a></li>
</ul>
</li>
<li><a href="#original-bsdd-data">3. Original bSDD Data</a>
<ul>
<li><a href="#getting-bsdd-data-dumps">3.1. Getting bSDD Data Dumps</a></li>
<li><a href="#statistics">3.2. Statistics</a>
<ul>
<li><a href="#total-entities">3.2.1. Total Entities</a></li>
<li><a href="#classifications-per-domain">3.2.2. Classifications Per Domain</a></li>
<li><a href="#fields-used">3.2.3. Fields Used</a></li>
<li><a href="#fields-used-in-classification">3.2.4. Fields Used in Classification</a></li>
<li><a href="#fields-used-in-classificationproperty">3.2.5. Fields Used in ClassificationProperty</a></li>
<li><a href="#fields-used-in-property">3.2.6. Fields Used in Property</a></li>
<li><a href="#fields-used-in-propertyvalue">3.2.7. Fields Used in PropertyValue</a></li>
</ul>
</li>
<li><a href="#key-fields">3.3. Key Fields</a>
<ul>
<li><a href="#classificationtype">3.3.1. ClassificationType</a></li>
<li><a href="#propertyvaluekind-of-classificationproperty">3.3.2. PropertyValueKind of ClassificationProperty</a></li>
<li><a href="#propertyvaluekind-of-property">3.3.3. PropertyValueKind of Property</a></li>
<li><a href="#status">3.3.4. Status</a></li>
<li><a href="#dynamic-properties">3.3.5. Dynamic Properties</a></li>
<li><a href="#iswritable-property">3.3.6. isWritable Property</a></li>
<li><a href="#isrequired-property">3.3.7. isRequired Property</a></li>
<li><a href="#domains-with-iswritable-and-isrequired-properties">3.3.8. Domains with isWritable and isRequired Properties</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#suggested-improvements">4. Suggested Improvements</a>
<ul>
<li><a href="#return-the-same-data-across-apis">4.1. Return the Same Data Across APIs</a></li>
<li><a href="#improve-property-names">4.2. Improve Property Names</a></li>
<li><a href="#use-the-same-url-for-data-and-for-web-pages">4.3. Use the Same URL for Data and for Web Pages</a></li>
<li><a href="#improve-url-structure-and-consistency">4.4. Improve URL Structure and Consistency</a>
<ul>
<li><a href="#explicate-domain-versions">4.4.1. Explicate Domain Versions</a></li>
<li><a href="#declare-urls-to-be-id-and-use-a-mandatory-field-id">4.4.2. Declare URLs to be <code>ID</code> and Use a Mandatory Field <code>id</code></a></li>
<li><a href="#overlap-of-entity-classes-with-classificationtype">4.4.3. Overlap of Entity Classes with <code>classificationType</code></a></li>
<li><a href="#property-vs-classificationproperty-use-distinct-urls">4.4.4. Property vs ClassificationProperty: Use Distinct URLs</a></li>
<li><a href="#all-entities-should-have-url">4.4.5. All Entities Should Have URL</a></li>
</ul>
</li>
<li><a href="#modeling-issues">4.5. Modeling Issues</a>
<ul>
<li><a href="#modeling-of-complex-properties">4.5.1. Modeling of Complex Properties</a></li>
<li><a href="#modeling-of-dynamic-properties">4.5.2. Modeling of Dynamic Properties</a></li>
<li><a href="#improve-relations-between-entities">4.5.3. Improve Relations Between Entities</a></li>
<li><a href="#add-more-entities">4.5.4. Add More Entities</a></li>
<li><a href="#use-class-inheritance">4.5.5. Use Class Inheritance</a></li>
<li><a href="#improve-description-of-classificationproperties">4.5.6. Improve Description of ClassificationProperties</a></li>
<li><a href="#improve-representation-of-propertyvalues">4.5.7. Improve Representation of PropertyValues</a></li>
<li><a href="#improve-representation-of-predefinedvalue">4.5.8. Improve Representation of predefinedValue</a></li>
<li><a href="#improve-multilingual-support">4.5.9. Improve Multilingual Support</a></li>
</ul>
</li>
<li><a href="#improve-rdf-structure">4.6. Improve RDF Structure</a></li>
<li><a href="#graphql-improvements">4.7. GraphQL Improvements</a>
<ul>
<li><a href="#searchability-and-pagination">4.7.1. Searchability and Pagination</a></li>
<li><a href="#eliminate-parallel-links-between-entities">4.7.2. Eliminate Parallel Links Between Entities</a></li>
<li><a href="#graphql-arrays-and-nullability">4.7.3. GraphQL Arrays and Nullability</a></li>
<li><a href="#null-classifications-error">4.7.4. Null Classifications Error</a></li>
<li><a href="#null-classification-childs-error">4.7.5. Null Classification Childs Error</a></li>
<li><a href="#null-classificationproperty-name-error">4.7.6. Null ClassificationProperty Name Error</a></li>
<li><a href="#missing-domains">4.7.7. Missing Domains</a></li>
<li><a href="#unexpected-multiple-values">4.7.8. Unexpected Multiple Values</a></li>
<li><a href="#deprecated-properties">4.7.9. Deprecated Properties</a></li>
</ul>
</li>
<li><a href="#data-quality-problems">4.8. Data Quality Problems</a>
<ul>
<li><a href="#trim-leading-trailing-consecutive-whitespace">4.8.1. Trim Leading, Trailing, Consecutive Whitespace</a></li>
<li><a href="#improve-physical-quantities-and-units">4.8.2. Improve Physical Quantities and Units</a></li>
<li><a href="#rules-about-missing-data">4.8.3. Rules About Missing Data</a></li>
<li><a href="#unicode-problems">4.8.4. Unicode Problems</a></li>
<li><a href="#unresolved-html-entities">4.8.5. Unresolved HTML Entities</a></li>
<li><a href="#bad-classification-relations">4.8.6. Bad Classification Relations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#implementing-improvements">5. Implementing Improvements</a>
<ul>
<li><a href="#converting-json-to-raw-rdf-using-sparql-anything">5.1. Converting JSON to Raw RDF using SPARQL Anything</a>
<ul>
<li><a href="#raw-json-example">5.1.1. Raw JSON Example</a></li>
<li><a href="#raw-rdf-example">5.1.2. Raw RDF Example</a></li>
</ul>
</li>
<li><a href="#refactoring-rdf-using-sparql-update">5.2. Refactoring RDF using SPARQL Update</a>
<ul>
<li><a href="#original-rdf-example">5.2.1. Original RDF Example</a></li>
<li><a href="#refactored-rdf-example">5.2.2. Refactored RDF Example</a></li>
</ul>
</li>
<li><a href="#graphql-to-soml-and-back">5.3. GraphQL to SOML and Back</a></li>
<li><a href="#sample-queries">5.4. Sample Queries</a>
<ul>
<li><a href="#domains-with-lang-en-and-their-classifications">5.4.1. Domains with lang=EN and their Classifications</a></li>
<li><a href="#classificationproperties-in-ifc-class-ifcwall">5.4.2. ClassificationProperties in IFC class IfcWall</a></li>
<li><a href="#classifications-of-type-composed-property-and-their-constituent-properties">5.4.3. Classifications of Type COMPOSED_PROPERTY and their Constituent Properties</a></li>
<li><a href="#properties-that-have-connected-properties">5.4.4. Properties that Have Connected Properties</a></li>
<li><a href="#pagination">5.4.5. Pagination</a></li>
<li><a href="#classifications-with-relations">5.4.6. Classifications with Relations</a></li>
<li><a href="#relations-of-classifications">5.4.7. Relations of Classifications</a></li>
<li><a href="#length-properties">5.4.8. Length Properties</a></li>
</ul>
</li>
<li><a href="#graph-visualizations">5.5. Graph Visualizations</a>
<ul>
<li><a href="#composed-property-classifications">5.5.1. "COMPOSED_PROPERTY" Classifications</a></li>
<li><a href="#domain-classifications">5.5.2. "DOMAIN" Classifications</a></li>
<li><a href="#classification-relations">5.5.3. Classification Relations</a></li>
<li><a href="#multivalued-propsets">5.5.4. Multivalued propSets</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#acknowledgements">6. Acknowledgements</a></li>
</ul>
</div>
</div>

<div id="outline-container-abstract" class="outline-2">
<h2 id="abstract"><span class="section-number-2">1.</span> Abstract</h2>
<div class="outline-text-2" id="text-abstract">
<p>
The buildingSmart Data Dictionary (bSDD) is an important shared resource in the Architecture, Engineering, Construction, and Operations (AECO) domain.
It is a collection of datasets ("domains") that define various classifications (objects representing building components, products, and materials),
their properties, allowed values, etc.
bSDD defines a GraphQL API, as well as REST APIs that return JSON and RDF representations.
This improves the interoperability of bSDD and its easier deployment in architectural Computer Aided Design (CAD) and other AECO software.
</p>

<p>
However, bSDD data is not structured as well as possible, and data retrieved via different APIs is not identical in content and structure.
This lowers bSDD data quality, usability and trust.
</p>

<p>
We conduct a thorough comparison and analysis of bSDD data related to fulfillment of FAIR (findable, accessible, interoperable, and reusable) principles.
Based on this analysis, we suggest enhancements to make bSDD data better structured and more FAIR.
</p>

<p>
We implement many of the suggestions by refactoring the original data to make it better structured/interconnected, and more "semantic".
We provide a SPARQL endpoint using <a href="https://graphdb.ontotext.com/">Ontotext GraphDB</a>, and GraphQL endpoint using <a href="https://platform.ontotext.com/semantic-objects/">Ontotext Platform Semantic Objects</a>.
Our detailed work is available at <a href="https://github.com/Accord-Project/bsdd">https://github.com/Accord-Project/bsdd</a> (open source) and <a href="https://bsdd.ontotext.com">https://bsdd.ontotext.com</a> (home page, schemas, data, sample queries).
</p>
</div>
</div>

<div id="outline-container-introduction" class="outline-2">
<h2 id="introduction"><span class="section-number-2">2.</span> Introduction</h2>
<div class="outline-text-2" id="text-introduction">
</div>

<div id="outline-container-bsdd" class="outline-3">
<h3 id="bsdd"><span class="section-number-3">2.1.</span> bSDD</h3>
<div class="outline-text-3" id="text-bsdd">
<p>
Reusable data dictionaries are widely used for the electronic exchange of product and component information across industries, improving interoperation between systems.
Examples include:
</p>
<ul class="org-ul">
<li><a href="https://cdd.iec.ch/">IEC Common Data Dictionary</a> (IEC CDD): electrical components, units of measure, documents and certificates, etc.</li>
<li><a href="https://eclass.eu/en/">eCl@ss</a>: a product classification and parts description for a variety of industries.</li>
<li>ISO 15926 part 4 <a href="https://rds.posccaesar.org/">Reference Data and Services</a>: for digital information across process plant industries (oil &amp; gas).</li>
<li><a href="https://bsdd.buildingsmart.org/">buildingSMART Data Dictionary (bSDD)</a>: for materials and components in the AECO industry.</li>
</ul>

<p>
The bSDD is a hierarchical dictionary of object concepts (Classifications), their Properties and allowed values used in Building Information Models (BIM).
Property sets are predefined by regulation agencies and vendors and extend common property sets of the Industry Foundation Classes (IFC).
This allows to describe specific domains (e.g. transportation) and building elements (e.g. doors, windows, stairs).
bSDD is organized according to the ISO 23386 (2020) Methodology to describe, author and maintain properties in interconnected data dictionaries.
This is a language-independent model used for the development of dictionaries according to ISO 12006-3 (2022) Framework for object-oriented information.
</p>

<p>
bSDD was initiated to improve interoperability in the building and construction industry.
bSDD is a comprehensive solution that provisions open product data definitions, identification, and distribution methods.
</p>

<p>
As of February 2023, bSDD keeps descriptions of nearly 80,000 Classifications in 108 domains,
ranging from roads and rails to DIN, Omniclass, Uniclass, IFC extensions, etc.
It is a widely accepted source of BIM reference data.
bSDD uses URLs for nearly all defined entities to enable globalized data use in a variety of AECO applications and structured documents.
</p>
</div>
</div>

<div id="outline-container-graphql-benefits" class="outline-3">
<h3 id="graphql-benefits"><span class="section-number-3">2.2.</span> GraphQL Benefits</h3>
<div class="outline-text-3" id="text-graphql-benefits">
<p>
<a href="https://graphql.org/">GraphQL</a> as an approach to create simplified "facades" over various storages,
and to provide schema, uniform query language, API and runtime
for handling queries, mutations and subscriptions.
It has many benefits over traditional REST APIs:
</p>
<ul class="org-ul">
<li>Avoid over-fetching by specifying exactly which data and in what nested structure should be returned by the server</li>
<li>Data is returned in JSON that is precisely congruent to the shape of the query</li>
<li>Retrieve many resources in a single request; even across storages by using GraphQL Federation</li>
<li>Schema introspection that allows IDEs and query helpers to offer contextual auto-completion at any point in the query</li>
<li>Data validation (for both input through mutations and output through queries) that guarantees type and cardinality conformance (optional/mandatory, single/multi-valued)</li>
</ul>

<p>
bSDD does offer GraphQL access:
</p>
<ul class="org-ul">
<li>Test: <a href="https://test.bsdd.buildingsmart.org/graphiql/">https://test.bsdd.buildingsmart.org/graphiql/</a></li>
<li>Production: <a href="https://api.bsdd.buildingsmart.org/graphqls/">https://api.bsdd.buildingsmart.org/graphqls/</a> (secured endpoint).</li>
<li>NOTE: we worked with bSI to get access to the production endpoint, but due to delays all our analysis is done on data from the test endpoint.
Nevertheless, we believe that most of our findings also apply to the production data.</li>
</ul>
<p>
Both endpoints use <code>GraphiQL</code> - a graphical interactive in-browser <a href="https://github.com/graphql/graphiql/tree/main/packages/graphiql">GraphQL IDE</a>.
</p>
</div>
</div>

<div id="outline-container-original-graphql-bsdd-schema-voyager" class="outline-3">
<h3 id="original-graphql-bsdd-schema-voyager"><span class="section-number-3">2.3.</span> Original GraphQL bSDD Schema: Voyager</h3>
<div class="outline-text-3" id="text-original-graphql-bsdd-schema-voyager">
<p>
<a href="https://ivangoncharov.github.io/graphql-voyager/">GraphQL Voyager</a> (see <a href="https://github.com/IvanGoncharov/graphql-voyager">source</a>) is a visual app
that uses a Schema Introspection query (<code>schemaIntrospection.graphql</code>) to explore a GraphQL endpoint
and displays the schema of the endpoint, allowing the user to search and browse the available types and queries.
</p>

<p>
We wrote a page <a href="https://rawgit2.com/Accord-Project/bsdd/main/bsdd-graphql-voyager-orig.html">bsdd-graphql-voyager-orig</a> (see <code>bsdd-graphql-voyager-orig.html</code>) that deploys Voyager over the bSDD GraphQL endpoint.
We used it to investigate the original bSDD schema:
</p>


<div id="orgd59f06f" class="figure">
<p><img src="./img/bsdd-graphql-voyager-overview.png" alt="bsdd-graphql-voyager-overview.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Original bSDD GraphQL Schema: Overview (uncheck "Show leaf fields")</p>
</div>

<p>
As we can see, bSDD has 12 entities (object types):
</p>
<ul class="org-ul">
<li>Reference entities:
<ul class="org-ul">
<li><code>Country</code></li>
<li><code>Language</code></li>
<li><code>ReferenceDocument</code>, such as a standard</li>
<li><code>Unit</code>: unit of measure</li>
</ul></li>
<li><code>Domain</code>: dataset by a single data provider</li>
<li><code>Property</code>: global property definition
<ul class="org-ul">
<li><code>PropertyRelation</code>: relation between properties</li>
<li><code>PropertyValue</code>: allowed property value for enumerated properties</li>
</ul></li>
<li><code>Classification</code>: object, material, component
<ul class="org-ul">
<li><code>ClassificationRelation</code>: relation between classifications</li>
</ul></li>
<li><code>ClassificationProperty</code>: property that is localized to a classification
<ul class="org-ul">
<li><code>ClassificationPropertyValue</code>: allowed property value for enumerated properties</li>
</ul></li>
</ul>

<p>
We can also look at details of the schema:
</p>


<div id="org4ad1717" class="figure">
<p><img src="./img/bsdd-graphql-voyager-Classification-ClassificationProperty.png" alt="bsdd-graphql-voyager-Classification-ClassificationProperty.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Original bSDD GraphQL Schema: Detail of Classification and ClassificationProperty</p>
</div>

<p>
Last but not least, Voyager presents detailed and searchable documentation about the schema;
the same is available in the GraphiQL query tool.
</p>
</div>
</div>

<div id="outline-container-original-graphql-bsdd-schema-problems" class="outline-3">
<h3 id="original-graphql-bsdd-schema-problems"><span class="section-number-3">2.4.</span> Original GraphQL bSDD Schema: Problems</h3>
<div class="outline-text-3" id="text-original-graphql-bsdd-schema-problems">
<p>
Even in the Schema Overview (at low level of detail) we can notice some defects:
</p>
<ul class="org-ul">
<li>The reference entities (<code>Country, Language, ReferenceDocument, Unit</code>)
are disconnected from the rest of the schema, i.e. not used by the other entities</li>
<li>Relation entities have only an incoming link but no outgoing link.
This means that if you want to get some data of a <code>Classification</code>
and all its related <code>Classifications</code>, you need to issue two queries
because you cannot navigate past <code>ClassificationRelation</code>.</li>
<li>Many entities cannot be queried directly from the root, but have to be reached through their respective "parent" entity.</li>
<li>There are no backward relations (arrows) to get from a lower-level entity back to its "parent" entity.</li>
<li>There are a number of parallel relations (arrows).
This is not needed in GraphQL because the schema can use parameters to distinguish between the different uses.</li>
</ul>
<p>
At the high level of detail we can notice more defects:
</p>
<ul class="org-ul">
<li><code>Property</code> and <code>ClassificationProperty</code> are very similar, but there's no inheritace/relation between them</li>
<li><code>PropertyValue</code> and <code>ClassificationPropertyValue</code> are exactly the same, so can be reduced to one entity</li>
</ul>

<p>
We'll have a lot more to say about this in further sections.
But first let's look at a refactored (improved) schema.
</p>
</div>
</div>

<div id="outline-container-refactored-graphql-bsdd-schema-voyager" class="outline-3">
<h3 id="refactored-graphql-bsdd-schema-voyager"><span class="section-number-3">2.5.</span> Refactored GraphQL bSDD Schema: Voyager</h3>
<div class="outline-text-3" id="text-refactored-graphql-bsdd-schema-voyager">
<p>
The main purpose of this work is to refactor the bSDD data and schema in order to improve them.
We explain the refactoring process in the last section.
</p>

<p>
But we show the refactored schema here in order to compare it to the original schema.
We wrote the web page <a href="https://rawgit2.com/Accord-Project/bsdd/main/bsdd-graphql-voyager-refact.html">bsdd-graphql-voyager-refact.html</a> (see <code>bsdd-graphql-voyager-refact.html</code>)
that allows you to explore the refactored schema.
</p>


<div id="org1c7d1bd" class="figure">
<p><img src="./img/bsdd-graphql-voyager-refact-overview.png" alt="bsdd-graphql-voyager-refact-overview.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Refactored bSDD GraphQL Schema: Overview (uncheck "Show leaf fields")</p>
</div>

<p>
Improvements:
</p>
<ul class="org-ul">
<li>All entities are queryable directly from the root.
Note: There's a common interface <code>Object</code> that provides functionality common to all entities: the dashed arrows show that each entity implements it.
This creates some clutter in the diagram, but doesn't complicate querying and navigation.</li>
<li>There are no parallel arrows (relations) between entities;
each relation is named the same as the target entity, improving predictability and consistency.</li>
<li>Navigation between entities is bidirectional (e.g. <code>Domain.classification</code> but also <code>Classification.domain</code>),
which is a feature expected of a Knowledge Graph.
<ul class="org-ul">
<li>In particular, the <code>Classification</code> hierarchy can be navigated both up and down (<code>parentClassification, childClassification</code>)</li>
</ul></li>
<li>A query can traverse a <code>Relation</code> entity to get data about the related entity:
<ul class="org-ul">
<li><code>Classification.relation -&gt; ClassificationRelation.related -&gt; Classification</code></li>
<li><code>Property.relation -&gt; PropertyRelation.related -&gt; Property</code></li>
</ul></li>
<li>A single entity <code>PropertyValue</code> is used by both <code>Property</code> and <code>ClassificationProperty</code></li>
</ul>

<p>
This does not fix all defects noted with the original diagram.
The reference entities are still not used by the main entities.
To fix that would require data cleaning work
(eg to ensure that Unit code strings used in all Properties and ClassificationProperties are in the reference list).
</p>

<p>
We can also take a look at a detail of the refactored schema. It looks pretty similar,
but all fields are normalized to singular names,
and strings fields like <code>propertyNamespaceUri</code> are converted to object fields like <code>Property</code>.
</p>


<div id="org46bc1a6" class="figure">
<p><img src="./img/bsdd-graphql-voyager-refact-Classification-ClassificationProperty.png" alt="bsdd-graphql-voyager-refact-Classification-ClassificationProperty.png" />
</p>
<p><span class="figure-number">Figure 4: </span>Refactored bSDD GraphQL Schema: Detail of Classification and ClassificationProperty</p>
</div>
</div>
</div>

<div id="outline-container-graphiql-querying-of-original-endpoint" class="outline-3">
<h3 id="graphiql-querying-of-original-endpoint"><span class="section-number-3">2.6.</span> GraphiQL Querying of Original Endpoint</h3>
<div class="outline-text-3" id="text-graphiql-querying-of-original-endpoint">
<p>
<a href="https://test.bsdd.buildingsmart.org/graphiql">https://test.bsdd.buildingsmart.org/graphiql</a> is the original GraphQL endpoint.
</p>


<div id="org6c76186" class="figure">
<p><img src="./img/graphiql-orig.png" alt="graphiql-orig.png" />
</p>
<p><span class="figure-number">Figure 5: </span>GraphiQL Querying of Original bSDD Endpoint</p>
</div>

<p>
It provides a number of useful features:
</p>
<ul class="org-ul">
<li>Online searchable documentation of the GraphQL schema</li>
<li>Auto-completion of field names and parameters at any point in the query: queries practically "write themselves"!</li>
<li>Ability to parameterize queries through Query Variables</li>
<li>Code formatting (Prettifying) of the query</li>
<li>Syntax highlighting</li>
<li>History of previous queries</li>
<li>JSON results that conform exactly to the form of hate query</li>
</ul>
</div>
</div>

<div id="outline-container-graphiql-querying-of-refactored-endpoint" class="outline-3">
<h3 id="graphiql-querying-of-refactored-endpoint"><span class="section-number-3">2.7.</span> GraphiQL Querying of Refactored Endpoint</h3>
<div class="outline-text-3" id="text-graphiql-querying-of-refactored-endpoint">
<p>
<a href="https://bsdd.ontotext.com/graphiql/">https://bsdd.ontotext.com/graphiql/</a> is the refactored GraphQL endpoint:
</p>


<div id="org5334311" class="figure">
<p><img src="./img/graphiql-refact.png" alt="graphiql-refact.png" />
</p>
<p><span class="figure-number">Figure 6: </span>GraphiQL Querying of Refactored bSDD Endpoint</p>
</div>

<p>
We have deployed a newer version of GraphiQL that has all benefits described in the previous section, and adds some more:
</p>
<ul class="org-ul">
<li>A hierarchical Explorer pane that shows the total schema structure and allows you to select fields by clicking rather than typing.
The History and Documentation panes are still present (see toggles at the left edge)</li>
<li>Useful keyboard shortcuts</li>
<li>Search in the query text (in addition to search in the Documentation)</li>
<li>Improved syntax highlighting</li>
<li>Multiple query tabs so you can easily access several queries at once</li>
<li>The query response reports errors in addition to returning data
(this comes from our GraphQL server implementation, not from the GraphiQL version)</li>
</ul>
</div>
</div>

<div id="outline-container-files" class="outline-3">
<h3 id="files"><span class="section-number-3">2.8.</span> Files</h3>
<div class="outline-text-3" id="text-files">
<p>
Description of all files in <a href="https://github.com/Accord-Project/bsdd">https://github.com/Accord-Project/bsdd</a>:
</p>
<ul class="org-ul">
<li><code>bsdd-graphql-schema-orig.json</code>, 116k: original GraphQL schema, obtained with <code>schemaIntrospection.graphql</code></li>
<li><code>bsdd-graphql-schema-refact.json</code>, 867k: refactored GraphQL schema, obtained with <code>schemaIntrospection.graphql</code>.
The endpoint is generated with <a href="https://platform.ontotext.com/semantic-objects/">Ontotext Platform Semantic Objects</a>.
The reason it is so much bigger is that it includes a comprehensive <code>where</code> query language</li>
<li><code>bsdd-graphql-soml-template.yaml</code>: template file for the GraphQL-SOML generator</li>
<li><code>bsdd-graphql-soml-orig.yaml</code>: draft <a href="https://platform.ontotext.com/semantic-objects/soml/index.html">SOML</a> generated from the original GraphQL schema</li>
<li><code>bsdd-graphql-soml-refact.yaml</code>: SOML refactored by hand to make structural improvements. We use this with <a href="https://platform.ontotext.com/semantic-objects/">Ontotext Platform Semantic Objects</a> to generate the refactored GraphQL endpoint</li>
<li><code>bsdd-graphql-soml.patch</code>: difference between the two SOML schemas</li>
<li><code>bsdd-graphql-voyager-orig.html</code>: HTML page that displays the original GraphQL schema with Voyager</li>
<li><code>bsdd-graphql-voyager-refact.html</code>:HTML page that displays the refactored GraphQL schema with Voyager</li>
<li><code>bsdd-ontology.ttl</code>: start of a bSDD ontology, very incomplete</li>
<li><code>index.html</code>: home page source</li>
<li><code>README.org</code>: detailed description of the work we did in emacs <code>orgmode</code> (this file)</li>
<li><code>README.md</code>: detailed description of the work we did, exported to <code>markdown</code></li>
<li><code>README.html</code>: HTML rendition of the work we did</li>
<li><code>paper</code>: paper submitted to LDAC 2023
<ul class="org-ul">
<li><code>bsdd.bib</code>: bibtex file for the paper, made from the <a href="https://www.zotero.org/groups/3007408/semantic_bim">Zotero semantic BIM library</a>, we don't use it</li>
<li><code>bsdd.biblatex</code>: biblatex file for the paper, made from the same library, we use this one</li>
<li><code>Makefile</code>: update the bibliography files</li>
<li><code>paper.md</code>: paper as markdown</li>
<li><code>paper.tex</code>: paper as latex, generated with Scholarly Pandoc</li>
<li><code>paper.pdf</code>: paper as PDF</li>
</ul></li>
<li><code>graphql</code>: GraphQL queries to get the 9 kinds of entities from the original GraphQL endpoint
<ul class="org-ul">
<li>Also <code>schemaIntrospection.graphql</code> that gets the GraphQL schema of an endpoint</li>
</ul></li>
<li><code>graphql-refact</code>: some sample queries against the refactored GraphQL endpoint (TODO: add more?)</li>
<li><code>scripts</code>: all necessary scripts to export data in various formats, convert bSDD schema to SOML, convert JSON to RDF, refactor RDF, etc
<ul class="org-ul">
<li><code>bsdd2json.py</code>: connects to the original GraphQL API and exports all objects of the GraphQL schema as JSON (domains, classifications, classification properties, etc).
There is no way to get more than 5000 classifications per domain (a limitation of the <code>classificationSearch</code> field)</li>
<li><code>bsdd_export.py</code>: export one kind of bSDD entity using a specific GraphQL query</li>
<li><code>bsdd_graphql_api.py</code>: helper module for working with the bSDD GraphQL endpoint</li>
<li><code>graphql2soml.py</code>: generates a draft SOML from a GraphQL endpoint</li>
<li><code>list-zip.sparql</code>: list all files in a zip using SPARQL Anything</li>
<li><code>rdfize.sparql</code>: RDFize a bSDD JSON file using SPARQL Anything</li>
<li><code>rdfize-folder.sparql</code>: RDFize a folder of bSDD JSON files using SPARQL Anything</li>
<li><code>rdfize-zip.sparql</code>: RDFize a zip of bSDD JSON files using SPARQL Anything (doesn't work: <a href="https://github.com/SPARQL-Anything/sparql.anything/issues/335">https://github.com/SPARQL-Anything/sparql.anything/issues/335</a>)</li>
<li><code>transform.ru</code>: transform (refactor) RDF data. Described in detail below</li>
</ul></li>
<li><code>dump</code>: scripts to get the complete original bSDD data from the original GraphQL endpoint
<ul class="org-ul">
<li><code>docker-compose.yaml, Dockerfile</code>: docker files</li>
<li><code>dump.sh</code>: perform the dump</li>
<li><code>sparql-anything.bat</code>: batch file to invoke SPARQL Anything</li>
</ul></li>
<li><code>samples</code>: sample bSDD entities:
whole sets (e.g. <code>units</code>)
or selected "interesting" entities with most fields filled (e.g. <code>class-IfcWall, prop-Ifc-ACResistance</code>)
<ul class="org-ul">
<li><code>*-orig.json</code>: original files from GraphQL endpoint or JSON API</li>
<li><code>*-orig.ttl</code>: original files from RDF API (not all can be obtained this way, e.g. Domains cannot)</li>
<li><code>*-refact.ttl</code>: refactored RDF files</li>
<li><code>Makefile</code> to export and convert data</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-endpoints-and-pages" class="outline-3">
<h3 id="endpoints-and-pages"><span class="section-number-3">2.9.</span> Endpoints and Pages</h3>
<div class="outline-text-3" id="text-endpoints-and-pages">
<p>
Description of all endpoints that this project worked with and produced:
</p>
<ul class="org-ul">
<li><a href="https://bsdd.ontotext.com">https://bsdd.ontotext.com</a>: home page, includes all of these links</li>
<li><a href="https://bsdd.ontotext.com/README.html">https://bsdd.ontotext.com/README.html</a>: detailed description of the work we did (<a href="https://github.com/Accord-Project/bsdd/issues/14">issue #14</a>: make better version from .md instead of .org)</li>
<li><a href="https://bsdd.ontotext.com/paper/paper.pdf">https://bsdd.ontotext.com/paper/paper.pdf</a>: submitted to LDAC 2023</li>
<li><a href="https://bsdd.ontotext.com/paper/presentation.pdf">https://bsdd.ontotext.com/paper/presentation.pdf</a>: TODO</li>
<li><a href="https://test.bsdd.buildingsmart.org/graphql/">https://test.bsdd.buildingsmart.org/graphql/</a>: original GraphQL endpoint (protected)</li>
<li><a href="https://test.bsdd.buildingsmart.org/graphiql/">https://test.bsdd.buildingsmart.org/graphiql/</a>: original GraphQL query editor</li>
<li><a href="https://rawgit2.com/Accord-Project/bsdd/main/bsdd-graphql-voyager-orig.html">https://rawgit2.com/Accord-Project/bsdd/main/bsdd-graphql-voyager-orig.html</a>: original GraphQL schema visualization with Voyager</li>
<li><a href="https://bsdd.ontotext.com/platform">https://bsdd.ontotext.com/platform</a>: Semantic Objects workbench: administrative interface for the Ontotext Platform implementing GraphQL (protected)</li>
<li><a href="https://bsdd.ontotext.com/graphql/">https://bsdd.ontotext.com/graphql/</a>: refactored GraphQL endpoint (protected)</li>
<li><a href="https://bsdd.ontotext.com/graphiql/">https://bsdd.ontotext.com/graphiql/</a>: refactored GraphQL query editor</li>
<li><a href="https://rawgit2.com/Accord-Project/bsdd/main/bsdd-graphql-voyager-refact.html">https://rawgit2.com/Accord-Project/bsdd/main/bsdd-graphql-voyager-refact.html</a>: refactored GraphQL schema visualization with Voyager</li>
<li><a href="https://bsdd.ontotext.com/graphdb">https://bsdd.ontotext.com/graphdb</a>: GraphDB Workbench: administrative interface for our semantic database (protected)</li>
<li><a href="https://bsdd.ontotext.com/graphdb/repositories/bsdd">https://bsdd.ontotext.com/graphdb/repositories/bsdd</a>: GraphDB SPARQL endpoint</li>
<li><a href="https://bsdd.ontotext.com/graphdb/sparql">https://bsdd.ontotext.com/graphdb/sparql</a>: GraphDB SPARQL editor</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-original-bsdd-data" class="outline-2">
<h2 id="original-bsdd-data"><span class="section-number-2">3.</span> Original bSDD Data</h2>
<div class="outline-text-2" id="text-original-bsdd-data">
</div>

<div id="outline-container-getting-bsdd-data-dumps" class="outline-3">
<h3 id="getting-bsdd-data-dumps"><span class="section-number-3">3.1.</span> Getting bSDD Data Dumps</h3>
<div class="outline-text-3" id="text-getting-bsdd-data-dumps">
<p>
Although bSDD is available in RDF, we decided to fetch all data in GraphQL JSON due to RDF defects described below.
</p>

<p>
We use the script <code>bsdd2json.py</code> to connects to the original GraphQL API
and export all objects of the GraphQL schema as JSON (domains, classifications, classification properties, etc).
Running this script takes around 10 hours due to the large number of objects.
After it finishes, the exported data will be located in the <code>data/</code> directory (not included in Github).
</p>

<p>
To work with the script, use a virtual Python environment:
</p>
<ul class="org-ul">
<li>Create a virtual environment: <code>python3.9 -m venv .venv</code></li>
<li>Activate it: <code>source .venv/bin/activate</code></li>
<li>Install the required libraries: <code>pip install -r scripts/requirements.txt</code></li>
</ul>

<p>
The overall process of the script is:
</p>
<ul class="org-ul">
<li>Export all "root" types with their attributes, but not relations (object properties)
<ul class="org-ul">
<li>Domains in <code>data/domains.json</code> (<code>Domain</code> in GraphQL)</li>
<li>Countries in <code>data/domains.json</code> (<code>Country</code> in GraphQL)</li>
<li>Languages in <code>data/languages.json</code> (<code>Language</code> in GraphQL)</li>
<li>Measurements units in <code>data/units.json</code> (<code>Unit</code> in GraphQL)</li>
<li>Reference documents in <code>data/reference_documents.json</code> (<code>ReferenceDocument</code> in GraphQL)</li>
</ul></li>
<li>For each exported Domain, create a subdirectory and export all Classifications in that domain in separate JSONs (<code>Classification</code> in GraphQL).
This includes nested objects: <code>ClassificationProperty, ClassificationRelation, ClassificationPropertyValue</code></li>
<li>Collect all unique global Properties and export them in <code>properties.json</code> (<code>Property</code> in GraphQL)</li>
</ul>

<p>
On the other hand, <code>bsdd_export.py</code> invokes a given query (with or without variable, which is the <code>namespaceUri</code> of the entity sought), and returns a JSON response.
Examples:
</p>
<ul class="org-ul">
<li>Get all domains:</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">python scripts/bsdd_export.py getDomains -o domains.json
</pre>
</div>
<ul class="org-ul">
<li>Get a particular domain:</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">python scripts/bsdd_export.py getDomain -v <span style="color: #8b2252;">"URI=https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3"</span> -o ifc-4.3.json
</pre>
</div>
</div>
</div>

<div id="outline-container-statistics" class="outline-3">
<h3 id="statistics"><span class="section-number-3">3.2.</span> Statistics</h3>
<div class="outline-text-3" id="text-statistics">
<p>
Here we provide various statistics about bSDD data.
Although the bSDD schema is rich, we find that some features are rarely used.
</p>
<ul class="org-ul">
<li>It is possible that the production bSDD endpoint will have higher use of features
(our counts were done on the test endpoint)</li>
<li>The counts were performed on refactored RDF data, but we guarantee that we have not lost data during refactoring</li>
</ul>
</div>

<div id="outline-container-total-entities" class="outline-4">
<h4 id="total-entities"><span class="section-number-4">3.2.1.</span> Total Entities</h4>
<div class="outline-text-4" id="text-total-entities">
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-right">c</th>
<th scope="col" class="org-left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Classification</td>
<td class="org-right">31720</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ClassificationProperty</td>
<td class="org-right">111566</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ClassificationRelation</td>
<td class="org-right">6420</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">246</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Domain</td>
<td class="org-right">108</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Language</td>
<td class="org-right">39</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Property</td>
<td class="org-right">36069</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PropertyValue</td>
<td class="org-right">214121</td>
<td class="org-left">We merged <code>PropertyValue</code> and <code>ClassificationPropertyValue</code> because they have the same structure</td>
</tr>

<tr>
<td class="org-left">ReferenceDocument</td>
<td class="org-right">484</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Unit</td>
<td class="org-right">603</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
We used this query but then removed uninteresting RDF classes:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?type</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a0522d;">?x</span> a <span style="color: #a0522d;">?type</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a020f0;">desc</span>(<span style="color: #a0522d;">?c</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-classifications-per-domain" class="outline-4">
<h4 id="classifications-per-domain"><span class="section-number-4">3.2.2.</span> Classifications Per Domain</h4>
<div class="outline-text-4" id="text-classifications-per-domain">
<p>
The GraphQL API returns 108 Domains.
The distribution of number of Classifications per domain is as follows:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">domains</th>
<th scope="col" class="org-right">class from</th>
<th scope="col" class="org-right">class to</th>
<th scope="col" class="org-left">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-left">12 domains have no data at all (no classifications)</td>
</tr>

<tr>
<td class="org-right">28</td>
<td class="org-right">1</td>
<td class="org-right">9</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">19</td>
<td class="org-right">11</td>
<td class="org-right">99</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">15</td>
<td class="org-right">100</td>
<td class="org-right">499</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">500</td>
<td class="org-right">999</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">1000</td>
<td class="org-right">4999</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">5000</td>
<td class="org-right">5000</td>
<td class="org-left">Has more than 5000, but returns only 5000 due to lack of pagination in the GraphQL API</td>
</tr>
</tbody>
</table>

<p>
Domains with no classifications:
</p>
<pre class="example" id="org4fd1100">
http://identifier.buildingsmart.org/uri/spr/spr-cfhios-0.1
https://identifier.buildingsmart.org/uri/ArcDox/ArcDox-1.0
https://identifier.buildingsmart.org/uri/BBRI/BBRI-0.1
https://identifier.buildingsmart.org/uri/FCSI/keq-0.1
https://identifier.buildingsmart.org/uri/MTR/MTR-1
https://identifier.buildingsmart.org/uri/bimeta/bimeta-0.1
https://identifier.buildingsmart.org/uri/bimlib/bimlib-ru-temp-1
https://identifier.buildingsmart.org/uri/buildingsmart/demo-2-1.1
https://identifier.buildingsmart.org/uri/csi/omniclass-1
https://identifier.buildingsmart.org/uri/ethz/hosszu-0.1
https://identifier.buildingsmart.org/uri/growingcircle/transsmart-0.1
https://identifier.buildingsmart.org/uri/ifcrail/ifcrail-0.1
</pre>

<p>
One domain has more than 5000 classifications, but returns only 5000 due to lack of pagination in the GraphQL API:
</p>
<pre class="example" id="org0fa2716">
https://identifier.buildingsmart.org/uri/nbs/uniclass2015-1
</pre>
</div>
</div>

<div id="outline-container-fields-used" class="outline-4">
<h4 id="fields-used"><span class="section-number-4">3.2.3.</span> Fields Used</h4>
<div class="outline-text-4" id="text-fields-used">
<p>
This shows the total number of defined fields, and fields that are actually used in various entities.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-right">total</th>
<th scope="col" class="org-right">used</th>
<th scope="col" class="org-right">percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Classification</td>
<td class="org-right">26</td>
<td class="org-right">19</td>
<td class="org-right">73.08%</td>
</tr>

<tr>
<td class="org-left">ClassificationProperty</td>
<td class="org-right">51</td>
<td class="org-right">30</td>
<td class="org-right">58.82%</td>
</tr>

<tr>
<td class="org-left">ClassificationRelation</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">75.00%</td>
</tr>

<tr>
<td class="org-left">Country</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">100.00%</td>
</tr>

<tr>
<td class="org-left">Domain</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">100.00%</td>
</tr>

<tr>
<td class="org-left">Language</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">100.00%</td>
</tr>

<tr>
<td class="org-left">Property</td>
<td class="org-right">47</td>
<td class="org-right">33</td>
<td class="org-right">70.21%</td>
</tr>

<tr>
<td class="org-left">PropertyValue</td>
<td class="org-right">5</td>
<td class="org-right">2</td>
<td class="org-right">40.00%</td>
</tr>

<tr>
<td class="org-left">ReferenceDocument</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">100.00%</td>
</tr>

<tr>
<td class="org-left">Unit</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">100.00%</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-fields-used-in-classification" class="outline-4">
<h4 id="fields-used-in-classification"><span class="section-number-4">3.2.4.</span> Fields Used in Classification</h4>
<div class="outline-text-4" id="text-fields-used-in-classification">
<p>
This shows the percentage of use of fields in Classification.
It ignores null values like <code>""</code> and <code>"[]"</code>.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">field</th>
<th scope="col" class="org-right">c</th>
<th scope="col" class="org-right">percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bsdd:classificationType</td>
<td class="org-right">30357</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:code</td>
<td class="org-right">30357</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:countryOfOrigin</td>
<td class="org-right">8405</td>
<td class="org-right">27.6872%</td>
</tr>

<tr>
<td class="org-left">bsdd:countryOfUse</td>
<td class="org-right">9508</td>
<td class="org-right">31.3206%</td>
</tr>

<tr>
<td class="org-left">bsdd:creatorLanguageCode</td>
<td class="org-right">8317</td>
<td class="org-right">27.3973%</td>
</tr>

<tr>
<td class="org-left">bsdd:definition</td>
<td class="org-right">8906</td>
<td class="org-right">29.3375%</td>
</tr>

<tr>
<td class="org-left">bsdd:deprecationExplanation</td>
<td class="org-right">1</td>
<td class="org-right">0.0033%</td>
</tr>

<tr>
<td class="org-left">bsdd:documentReference</td>
<td class="org-right">33</td>
<td class="org-right">0.1087%</td>
</tr>

<tr>
<td class="org-left">bsdd:name</td>
<td class="org-right">30357</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:referenceCode</td>
<td class="org-right">29226</td>
<td class="org-right">96.2743%</td>
</tr>

<tr>
<td class="org-left">bsdd:relatedIfcEntityName</td>
<td class="org-right">5095</td>
<td class="org-right">16.7836%</td>
</tr>

<tr>
<td class="org-left">bsdd:relation</td>
<td class="org-right">5388</td>
<td class="org-right">17.7488%</td>
</tr>

<tr>
<td class="org-left">bsdd:status</td>
<td class="org-right">30357</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:subdivisionOfUse</td>
<td class="org-right">25</td>
<td class="org-right">0.0824%</td>
</tr>

<tr>
<td class="org-left">bsdd:synonym</td>
<td class="org-right">28404</td>
<td class="org-right">93.5666%</td>
</tr>

<tr>
<td class="org-left">bsdd:uid</td>
<td class="org-right">4251</td>
<td class="org-right">14.0034%</td>
</tr>

<tr>
<td class="org-left">bsdd:visualRepresentationUri</td>
<td class="org-right">9</td>
<td class="org-right">0.0296%</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">prefix</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?field</span> (count(<span style="color: #a0522d;">?field</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>)
<span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?cla</span> a bsdd:Classification; <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value</span> .
  <span style="color: #a020f0;">filter</span> (<span style="color: #a0522d;">?field</span> != rdf:type &amp;&amp; <span style="color: #a0522d;">?value</span> != <span style="color: #8b2252;">""</span> &amp;&amp; <span style="color: #a0522d;">?value</span> !=<span style="color: #8b2252;">"[]"</span>)
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-fields-used-in-classificationproperty" class="outline-4">
<h4 id="fields-used-in-classificationproperty"><span class="section-number-4">3.2.5.</span> Fields Used in ClassificationProperty</h4>
<div class="outline-text-4" id="text-fields-used-in-classificationproperty">
<p>
This shows the percentage of use of fields in ClassificationProperty.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">field</th>
<th scope="col" class="org-right">c</th>
<th scope="col" class="org-right">percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bsdd:allowedValue</td>
<td class="org-right">21277</td>
<td class="org-right">19.0712%</td>
</tr>

<tr>
<td class="org-left">bsdd:code</td>
<td class="org-right">111566</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:countryOfOrigin</td>
<td class="org-right">20768</td>
<td class="org-right">18.6150%</td>
</tr>

<tr>
<td class="org-left">bsdd:countryOfUse</td>
<td class="org-right">19859</td>
<td class="org-right">17.8002%</td>
</tr>

<tr>
<td class="org-left">bsdd:creatorLanguageCode</td>
<td class="org-right">19906</td>
<td class="org-right">17.8424%</td>
</tr>

<tr>
<td class="org-left">bsdd:dataType</td>
<td class="org-right">104960</td>
<td class="org-right">94.0788%</td>
</tr>

<tr>
<td class="org-left">bsdd:definition</td>
<td class="org-right">3964</td>
<td class="org-right">3.5531%</td>
</tr>

<tr>
<td class="org-left">bsdd:description</td>
<td class="org-right">17067</td>
<td class="org-right">15.2977%</td>
</tr>

<tr>
<td class="org-left">bsdd:dimension</td>
<td class="org-right">940</td>
<td class="org-right">0.8426%</td>
</tr>

<tr>
<td class="org-left">bsdd:documentReference</td>
<td class="org-right">859</td>
<td class="org-right">0.7699%</td>
</tr>

<tr>
<td class="org-left">bsdd:example</td>
<td class="org-right">4426</td>
<td class="org-right">3.9672%</td>
</tr>

<tr>
<td class="org-left">bsdd:methodOfMeasurement</td>
<td class="org-right">5</td>
<td class="org-right">0.0045%</td>
</tr>

<tr>
<td class="org-left">bsdd:name</td>
<td class="org-right">111566</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:pattern</td>
<td class="org-right">7</td>
<td class="org-right">0.0063%</td>
</tr>

<tr>
<td class="org-left">bsdd:physicalQuantity</td>
<td class="org-right">11678</td>
<td class="org-right">10.4673%</td>
</tr>

<tr>
<td class="org-left">bsdd:predefinedValue</td>
<td class="org-right">6219</td>
<td class="org-right">5.5743%</td>
</tr>

<tr>
<td class="org-left">bsdd:property</td>
<td class="org-right">111566</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:propertySet</td>
<td class="org-right">17907</td>
<td class="org-right">16.0506%</td>
</tr>

<tr>
<td class="org-left">bsdd:propertyValueKind</td>
<td class="org-right">111566</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:status</td>
<td class="org-right">111566</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:subdivisionOfUse</td>
<td class="org-right">19</td>
<td class="org-right">0.0170%</td>
</tr>

<tr>
<td class="org-left">bsdd:symbol</td>
<td class="org-right">79</td>
<td class="org-right">0.0708%</td>
</tr>

<tr>
<td class="org-left">bsdd:uid</td>
<td class="org-right">11602</td>
<td class="org-right">10.3992%</td>
</tr>

<tr>
<td class="org-left">bsdd:unit</td>
<td class="org-right">25231</td>
<td class="org-right">22.6153%</td>
</tr>

<tr>
<td class="org-left">bsdd:visualRepresentationUri</td>
<td class="org-right">4</td>
<td class="org-right">0.0036%</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span>  <span style="color: #a0522d;">?field</span> (count(<span style="color: #a0522d;">?field</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>)
<span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?prop</span> a bsdd:ClassificationProperty; <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value</span> .
  <span style="color: #a020f0;">filter</span> (<span style="color: #a0522d;">?field</span> != rdf:type &amp;&amp; <span style="color: #a0522d;">?value</span> != <span style="color: #8b2252;">""</span> &amp;&amp; <span style="color: #a0522d;">?value</span> !=<span style="color: #8b2252;">"[]"</span>)
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span>
</pre>
</div>
<p>
Note: <code>allowedValue</code> is a multivalued property, so it is counted separately like this:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a0522d;">?prop</span> a bsdd:ClassificationProperty
  <span style="color: #a020f0;">filter</span> <span style="color: #a020f0;">exists</span> {<span style="color: #a0522d;">?prop</span> bsdd:allowedValue []}
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-fields-used-in-property" class="outline-4">
<h4 id="fields-used-in-property"><span class="section-number-4">3.2.6.</span> Fields Used in Property</h4>
<div class="outline-text-4" id="text-fields-used-in-property">
<p>
This shows the percentage of use of fields in Property.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">field</th>
<th scope="col" class="org-right">c</th>
<th scope="col" class="org-right">percentage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bsdd:allowedValue</td>
<td class="org-right">5059</td>
<td class="org-right">14.4069%</td>
</tr>

<tr>
<td class="org-left">bsdd:code</td>
<td class="org-right">35115</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:connectedPropertyCode</td>
<td class="org-right">17</td>
<td class="org-right">0.0484%</td>
</tr>

<tr>
<td class="org-left">bsdd:countryOfOrigin</td>
<td class="org-right">12727</td>
<td class="org-right">36.2438%</td>
</tr>

<tr>
<td class="org-left">bsdd:countryOfUse</td>
<td class="org-right">12089</td>
<td class="org-right">34.4269%</td>
</tr>

<tr>
<td class="org-left">bsdd:creatorLanguageCode</td>
<td class="org-right">12401</td>
<td class="org-right">35.3154%</td>
</tr>

<tr>
<td class="org-left">bsdd:dataType</td>
<td class="org-right">33273</td>
<td class="org-right">94.7544%</td>
</tr>

<tr>
<td class="org-left">bsdd:definition</td>
<td class="org-right">2772</td>
<td class="org-right">7.8941%</td>
</tr>

<tr>
<td class="org-left">bsdd:description</td>
<td class="org-right">10132</td>
<td class="org-right">28.8538%</td>
</tr>

<tr>
<td class="org-left">bsdd:dimension</td>
<td class="org-right">613</td>
<td class="org-right">1.7457%</td>
</tr>

<tr>
<td class="org-left">bsdd:documentReference</td>
<td class="org-right">656</td>
<td class="org-right">1.8681%</td>
</tr>

<tr>
<td class="org-left">bsdd:example</td>
<td class="org-right">1084</td>
<td class="org-right">3.0870%</td>
</tr>

<tr>
<td class="org-left">bsdd:methodOfMeasurement</td>
<td class="org-right">3</td>
<td class="org-right">0.0085%</td>
</tr>

<tr>
<td class="org-left">bsdd:name</td>
<td class="org-right">35115</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:pattern</td>
<td class="org-right">2</td>
<td class="org-right">0.0057%</td>
</tr>

<tr>
<td class="org-left">bsdd:physicalQuantity</td>
<td class="org-right">3802</td>
<td class="org-right">10.8273%</td>
</tr>

<tr>
<td class="org-left">bsdd:propertyValueKind</td>
<td class="org-right">35115</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:status</td>
<td class="org-right">35115</td>
<td class="org-right">100.0000%</td>
</tr>

<tr>
<td class="org-left">bsdd:subdivisionOfUse</td>
<td class="org-right">3</td>
<td class="org-right">0.0085%</td>
</tr>

<tr>
<td class="org-left">bsdd:textFormat</td>
<td class="org-right">1</td>
<td class="org-right">0.0028%</td>
</tr>

<tr>
<td class="org-left">bsdd:uid</td>
<td class="org-right">4075</td>
<td class="org-right">11.6047%</td>
</tr>

<tr>
<td class="org-left">bsdd:unit</td>
<td class="org-right">6073</td>
<td class="org-right">17.2946%</td>
</tr>

<tr>
<td class="org-left">bsdd:visualRepresentationUri</td>
<td class="org-right">2</td>
<td class="org-right">0.0057%</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span>  <span style="color: #a0522d;">?field</span> (count(<span style="color: #a0522d;">?field</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>)
<span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?prop</span> a bsdd:Property.
  <span style="color: #a0522d;">?prop</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value</span> .
  <span style="color: #a020f0;">filter</span> (<span style="color: #a0522d;">?field</span> != rdf:type &amp;&amp; <span style="color: #a0522d;">?value</span> != <span style="color: #8b2252;">""</span> &amp;&amp; <span style="color: #a0522d;">?value</span> !=<span style="color: #8b2252;">"[]"</span>)
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-fields-used-in-propertyvalue" class="outline-4">
<h4 id="fields-used-in-propertyvalue"><span class="section-number-4">3.2.7.</span> Fields Used in PropertyValue</h4>
<div class="outline-text-4" id="text-fields-used-in-propertyvalue">
<p>
This shows the percentage of use of fields in PropertyValue (<code>allowedValues</code>).
Note: we have merged the classes <code>PropertyValue</code> and <code>ClassificationPropertyValue</code> into one, because they have exactly the same structure.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">field</th>
<th scope="col" class="org-right">c</th>
<th scope="col" class="org-left">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">code</td>
<td class="org-right">214122</td>
<td class="org-left">TODO: use this field in the URL</td>
</tr>

<tr>
<td class="org-left">description</td>
<td class="org-right">3751</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">namespaceUri</td>
<td class="org-right">24553</td>
<td class="org-left">TODO: In the rare cases when filled, use this field as URL</td>
</tr>

<tr>
<td class="org-left">value</td>
<td class="org-right">214121</td>
<td class="org-left">Currently use this field in the URL</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">PREFIX</span> rdf: <span style="color: #008b8b;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?field</span> (count(<span style="color: #a0522d;">?field</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a0522d;">?prop</span> a bsdd:PropertyValue; <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value</span>
  <span style="color: #a020f0;">filter</span> (<span style="color: #a0522d;">?field</span> != rdf:type &amp;&amp; <span style="color: #a0522d;">?value</span> != <span style="color: #8b2252;">""</span> &amp;&amp; <span style="color: #a0522d;">?value</span> !=<span style="color: #8b2252;">"[]"</span>)
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?field</span>
</pre>
</div>
<p>
In most PropertyValues, <code>code=value</code> and <code>namespaceUri</code> is not filled.
But there are some exceptions, and we should improve our RDF refactoring logic to take care of that, as described in the table comments above.
For example:
</p>
<ul class="org-ul">
<li><code>namespaceUri https://identifier.buildingsmart.org/uri/FTIA/FTIAtie-1.0/prop/verkon-toiminnallinen-kayttotarkoitus/value/vtk01</code></li>
<li>Has <code>code "vtk01"</code> and <code>value "Pituushalkeamien ehkisy"</code></li>
<li>We made       <code>https://identifier.buildingsmart.org/uri/FTIA/FTIAtie-1.0/prop/verkon-toiminnallinen-kayttotarkoitus/Pituushalkeamien ehkisy</code>
which is invalid URL because it includes a space</li>
<li>Instead, we should have made URL from <code>code</code>, or use <code>namespaceUri</code> directly</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-key-fields" class="outline-3">
<h3 id="key-fields"><span class="section-number-3">3.3.</span> Key Fields</h3>
<div class="outline-text-3" id="text-key-fields">
<p>
In this section we look at the distribution of values for key fields that have impact on how data is modeled.
Again, we see that some bSDD features are not really used.
</p>
</div>
<div id="outline-container-classificationtype" class="outline-4">
<h4 id="classificationtype"><span class="section-number-4">3.3.1.</span> ClassificationType</h4>
<div class="outline-text-4" id="text-classificationtype">
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-right">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">CLASS</td>
<td class="org-right">30792</td>
</tr>

<tr>
<td class="org-left">COMPOSED_PROPERTY</td>
<td class="org-right">387</td>
</tr>

<tr>
<td class="org-left">DOMAIN</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">MATERIAL</td>
<td class="org-right">493</td>
</tr>

<tr>
<td class="org-left">REFERENCE_DOCUMENT</td>
<td class="org-right">18</td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?type</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>)  {
  <span style="color: #a0522d;">?x</span> bsdd:classificationType <span style="color: #a0522d;">?type</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span>
</pre>
</div>
<p>
Classification is a fairly generic entity, which can designate:
</p>
<ul class="org-ul">
<li>CLASS: e.g. a building component, assembly, concept, etc</li>
<li>MATERIAL: a building material</li>
<li>COMPOSED_PROPERTY: a set of properties (we examine one such example below)</li>
</ul>
<p>
However, the other values in the table above cannot be justified:
</p>
<ul class="org-ul">
<li>DOMAIN: there is a specific entity <code>Domain</code>, so <code>Classification</code> should not have such type</li>
<li>REFERENCE_DOCUMENT: <code>Classification</code> has such a field, and there's a specific entity <code>ReferenceDocument</code>, so <code>Classification</code> should not have such type</li>
</ul>
</div>
</div>
<div id="outline-container-propertyvaluekind-of-classificationproperty" class="outline-4">
<h4 id="propertyvaluekind-of-classificationproperty"><span class="section-number-4">3.3.2.</span> PropertyValueKind of ClassificationProperty</h4>
<div class="outline-text-4" id="text-propertyvaluekind-of-classificationproperty">
<p>
We have listed all possible values in the table, and two of them are not used:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">value</th>
<th scope="col" class="org-right">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">COMPLEX</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left">COMPLEX_LIST</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left">LIST</td>
<td class="org-right">4837</td>
</tr>

<tr>
<td class="org-left">RANGE</td>
<td class="org-right">3490</td>
</tr>

<tr>
<td class="org-left">SINGLE</td>
<td class="org-right">103239</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?value</span> (count(<span style="color: #a0522d;">?value</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a0522d;">?prop</span> a bsdd:ClassificationProperty.
  <span style="color: #a0522d;">?prop</span> bsdd:propertyValueKind <span style="color: #a0522d;">?value</span> .
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?value</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?value</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-propertyvaluekind-of-property" class="outline-4">
<h4 id="propertyvaluekind-of-property"><span class="section-number-4">3.3.3.</span> PropertyValueKind of Property</h4>
<div class="outline-text-4" id="text-propertyvaluekind-of-property">
<p>
We have listed all possible values in the table, and two of them are not used:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">value</th>
<th scope="col" class="org-right">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">COMPLEX</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left">COMPLEX_LIST</td>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-left">LIST</td>
<td class="org-right">1259</td>
</tr>

<tr>
<td class="org-left">RANGE</td>
<td class="org-right">820</td>
</tr>

<tr>
<td class="org-left">SINGLE</td>
<td class="org-right">33990</td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?value</span> (count(<span style="color: #a0522d;">?value</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a0522d;">?prop</span> a bsdd:Property.
  <span style="color: #a0522d;">?prop</span> bsdd:propertyValueKind <span style="color: #a0522d;">?value</span> .
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?value</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?value</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-status" class="outline-4">
<h4 id="status"><span class="section-number-4">3.3.4.</span> Status</h4>
<div class="outline-text-4" id="text-status">
<p>
Breakdown of main entities by status.
</p>
<ul class="org-ul">
<li>Despite the endpoint being listed as "test", most objects are "Active"</li>
<li>We also noticed that some Domains lack any value!</li>
</ul>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">status</th>
<th scope="col" class="org-right">Classification</th>
<th scope="col" class="org-right">ClassificationProperty</th>
<th scope="col" class="org-right">Domain</th>
<th scope="col" class="org-right">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Active</td>
<td class="org-right">22543</td>
<td class="org-right">107746</td>
<td class="org-right">52</td>
<td class="org-right">34627</td>
</tr>

<tr>
<td class="org-left">Preview</td>
<td class="org-right">9176</td>
<td class="org-right">3819</td>
<td class="org-right">45</td>
<td class="org-right">1441</td>
</tr>

<tr>
<td class="org-left">Inactive</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left">NONE</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">10</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
We used this query, but then changed the table to 2-dimensional:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?status</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a0522d;">?x</span> a <span style="color: #a0522d;">?type</span>; bsdd:status <span style="color: #a0522d;">?status</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?status</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?status</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-dynamic-properties" class="outline-4">
<h4 id="dynamic-properties"><span class="section-number-4">3.3.5.</span> Dynamic Properties</h4>
<div class="outline-text-4" id="text-dynamic-properties">
<p>
Dynamic properties are interesting because they are calculated from other properties:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">isDynamic</th>
<th scope="col" class="org-right">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">false</td>
<td class="org-right">135250</td>
</tr>

<tr>
<td class="org-left">true</td>
<td class="org-right">12385</td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) <span style="color: #a0522d;">?isDynamic</span> <span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?d</span> bsdd:isDynamic <span style="color: #a0522d;">?isDynamic</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a020f0;">desc</span>(<span style="color: #a0522d;">?c</span>)
</pre>
</div>
<p>
According to the above, nearly 10% of properties are dynamic.
However, <code>dynamicParameterPropertyCodes</code> is always empty, so there is no indication from which properties those would be calculated.
</p>
</div>
</div>

<div id="outline-container-iswritable-property" class="outline-4">
<h4 id="iswritable-property"><span class="section-number-4">3.3.6.</span> isWritable Property</h4>
<div class="outline-text-4" id="text-iswritable-property">
<p>
<code>isWritable</code>  specifies whether the Property can be edited.
Most Properties don't have such characteristic.
We don't think the default is <code>false</code>, which means that the field is badly under-specified.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">ClassificationProperty</th>
<th scope="col" class="org-right">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">false</td>
<td class="org-right">4</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">true</td>
<td class="org-right">1653</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNDEF</td>
<td class="org-right">109909</td>
<td class="org-right">36069</td>
</tr>
</tbody>
</table>
<p>
We used this query, but then made a 2-dimensional table:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?isWritable</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a020f0;">values</span> <span style="color: #a0522d;">?type</span> {bsdd:Property bsdd:ClassificationProperty}
  <span style="color: #a0522d;">?x</span> a <span style="color: #a0522d;">?type</span>.
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?x</span> bsdd:isWritable <span style="color: #a0522d;">?isWritable1</span>}
  <span style="color: #a020f0;">bind</span>(coalesce(<span style="color: #a0522d;">?isWritable1</span>,<span style="color: #8b2252;">"UNDEF"</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?isWritable</span>)
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?isWritable</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?isWritable</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-isrequired-property" class="outline-4">
<h4 id="isrequired-property"><span class="section-number-4">3.3.7.</span> isRequired Property</h4>
<div class="outline-text-4" id="text-isrequired-property">
<p>
<code>isRequired</code> specifies whether the Property must be present in an object of the respective Classification.
Similar to the previous section, most Properties  don't have such characteristic.
But maybe here <code>false</code> is a suitable default.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">ClassificationProperty</th>
<th scope="col" class="org-right">Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">false</td>
<td class="org-right">2</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">true</td>
<td class="org-right">1667</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNDEF</td>
<td class="org-right">109897</td>
<td class="org-right">36069</td>
</tr>
</tbody>
</table>
<p>
We used this query, but then made a 2-dimensional table:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?isRequired</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a020f0;">values</span> <span style="color: #a0522d;">?type</span> {bsdd:Property bsdd:ClassificationProperty}
  <span style="color: #a0522d;">?x</span> a <span style="color: #a0522d;">?type</span>.
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?x</span> bsdd:isRequired <span style="color: #a0522d;">?isRequired1</span>}
  <span style="color: #a020f0;">bind</span>(coalesce(<span style="color: #a0522d;">?isRequired1</span>,<span style="color: #8b2252;">"UNDEF"</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?isRequired</span>)
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?isRequired</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?isRequired</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-domains-with-iswritable-and-isrequired-properties" class="outline-4">
<h4 id="domains-with-iswritable-and-isrequired-properties"><span class="section-number-4">3.3.8.</span> Domains with isWritable and isRequired Properties</h4>
<div class="outline-text-4" id="text-domains-with-iswritable-and-isrequired-properties">
<p>
Let's find all domains that have <code>isWritable</code> and <code>isRequired</code> <code>Properties</code>, and count such properties:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">domain</th>
<th scope="col" class="org-left">domainName</th>
<th scope="col" class="org-right">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/bimeta/bimeta-1.0">https://identifier.buildingsmart.org/uri/bimeta/bimeta-1.0</a></td>
<td class="org-left">Bauteiltypen nach DIN 276+x (geprft)</td>
<td class="org-right">1615</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.0">https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.0</a></td>
<td class="org-left">Fruit and vegetables</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.1">https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.1</a></td>
<td class="org-left">Fruit and vegetables</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/v5/fruitvegs-1.0">https://identifier.buildingsmart.org/uri/v5/fruitvegs-1.0</a></td>
<td class="org-left">Fruit and vegetables</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/v5/fruitvegs-v5-5.0">https://identifier.buildingsmart.org/uri/v5/fruitvegs-v5-5.0</a></td>
<td class="org-left">Fruit and vegetables</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/LCCrg-1.0">https://identifier.buildingsmart.org/uri/acca/LCCrg-1.0</a></td>
<td class="org-left">LCC_RG</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/limlab/PN001-1.1">https://identifier.buildingsmart.org/uri/limlab/PN001-1.1</a></td>
<td class="org-left">Ponti_ClassificazioneDegrado</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/alma/TestMaterial-0.4">https://identifier.buildingsmart.org/uri/alma/TestMaterial-0.4</a></td>
<td class="org-left">TestMaterial</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/alma/TestMaterial-0.5">https://identifier.buildingsmart.org/uri/alma/TestMaterial-0.5</a></td>
<td class="org-left">TestMaterial</td>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1">https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1</a></td>
<td class="org-left">Uniweimar</td>
<td class="org-right">8</td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?domain</span> <span style="color: #a0522d;">?domainName</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) {
  <span style="color: #a0522d;">?domain</span> a bsdd:Domain; bsdd:name <span style="color: #a0522d;">?domainName</span>; bsdd:classification <span style="color: #a0522d;">?cla</span>.
  <span style="color: #a0522d;">?cla</span> bsdd:classificationProperty <span style="color: #a0522d;">?prop</span>.
  <span style="color: #a0522d;">?prop</span> bsdd:isRequired true; bsdd:isWritable <span style="color: #a0522d;">?true</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?domain</span> <span style="color: #a0522d;">?domainName</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?domainName</span>
</pre>
</div>

<p>
As you can see, the vast majority of <code>isWritable</code> and <code>isRequired</code> Properties are in this Domain:
</p>
<ul class="org-ul">
<li><a href="https://identifier.buildingsmart.org/uri/bimeta/bimeta-1.0">https://identifier.buildingsmart.org/uri/bimeta/bimeta-1.0</a> "Bauteiltypen nach DIN 276+x (geprft)".
For example class "421.43 - Abgaswrmetauscher" has property "Hersteller" that <code>isWritable</code> and <code>isRequired</code>.</li>
<li>The rest are 6 test domains, and <code>LCC_RG, Ponti_ClassificazioneDegrado, Uniweimar</code></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-suggested-improvements" class="outline-2">
<h2 id="suggested-improvements"><span class="section-number-2">4.</span> Suggested Improvements</h2>
<div class="outline-text-2" id="text-suggested-improvements">
<p>
In this section we analyze shortcomings of the original bSDD data structuring, and suggest improvements.
</p>
</div>

<div id="outline-container-return-the-same-data-across-apis" class="outline-3">
<h3 id="return-the-same-data-across-apis"><span class="section-number-3">4.1.</span> Return the Same Data Across APIs</h3>
<div class="outline-text-3" id="text-return-the-same-data-across-apis">
<p>
We have compared three representations returned by the bSDD server:
</p>
<ul class="org-ul">
<li>JSON from the GraphQL API</li>
<li>JSON from the REST (entity) API</li>
<li>RDF  from the REST (entity) API</li>
</ul>

<p>
Importantly, some objects returned by GraphQL are not returned by the JSON and RDF APIs.
E.g. let's get the classifications of one particular domain:
</p>
<div class="org-src-container">
<pre class="src src-graphql">{
  domain(namespaceUri:<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/fvhf/vhf-0.002"</span>) {
    classificationSearch {
      namespaceUri
    }
}
</pre>
</div>
<p>
Nearly none of these are available from the JSON or RDF APIs:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">JSON API</span>
curl https://identifier.buildingsmart.org/uri/fvhf/vhf-0.002/class/G5
{<span style="color: #8b2252;">""</span>:[<span style="color: #8b2252;">"Classification with namespace URI 'https://identifier.buildingsmart.org/uri/fvhf/vhf-0.002/class/G5' not found"</span>]}

<span style="color: #b22222;"># </span><span style="color: #b22222;">RDF API</span>
curl -Haccept:text/turtle https://identifier.buildingsmart.org/uri/fvhf/vhf-0.002/class/G5
{<span style="color: #8b2252;">""</span>:[<span style="color: #8b2252;">"Classification with namespace URI 'https://identifier.buildingsmart.org/uri/fvhf/vhf-0.002/class/G5' not found"</span>]}
</pre>
</div>

<p>
We selected entities of each class that have the maximum number of filled fields, and compared the results returned by each API.
We found a number of detailed differences, as presented in the <a href="https://docs.google.com/spreadsheets/d/1z_NRMlExlVuqWhBbSErQ9iiDBY4O_fKMd3avV3-NCmo/edit">bSDD data analysis</a> spreadsheet:
</p>


<div id="org1376e74" class="figure">
<p><img src="./img/bsdd-data-analysis-sheet.png" alt="bsdd-data-analysis-sheet.png" />
</p>
<p><span class="figure-number">Figure 7: </span>Differences between bSDD GraphQL, JSON and RDF Data</p>
</div>

<p>
There are differences and omissions in some of the formats, as summarized in the table below.
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Entity.field</th>
<th scope="col" class="org-left">GraphQL</th>
<th scope="col" class="org-left">JSON API</th>
<th scope="col" class="org-left">RDF API</th>
<th scope="col" class="org-left">comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Classification.childs</td>
<td class="org-left">childs</td>
<td class="org-left">parentClassificationReference.namespaceUri</td>
<td class="org-left">NONE</td>
<td class="org-left">GraphQL points to child, JSON points to parent (1)</td>
</tr>

<tr>
<td class="org-left">Classification.domain</td>
<td class="org-left">NONE</td>
<td class="org-left">NONE</td>
<td class="org-left">bsdd:Domain</td>
<td class="org-left">GraphQL and JSON do not return <code>domain</code> whereas RDF returns it</td>
</tr>

<tr>
<td class="org-left">Classification.domainNamespaceUri</td>
<td class="org-left">NONE</td>
<td class="org-left">domainNamespaceUri</td>
<td class="org-left">NONE</td>
<td class="org-left">GraphQL and RDF do not return <code>domainNamespaceUri</code></td>
</tr>

<tr>
<td class="org-left">Property.domain</td>
<td class="org-left">NONE</td>
<td class="org-left">NONE</td>
<td class="org-left">bsdd:Domain</td>
<td class="org-left">GraphQL and JSON do not return <code>domain</code> whereas RDF returns it</td>
</tr>

<tr>
<td class="org-left">Property.domainNamespaceUri</td>
<td class="org-left">NONE</td>
<td class="org-left">domainNamespaceUri</td>
<td class="org-left">NONE</td>
<td class="org-left">GraphQL and RDF do not return <code>domainNamespaceUri</code></td>
</tr>

<tr>
<td class="org-left">ClassificationProperty</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">GraphQL and JSON overload the URL and use it for both <code>ClassificationProperty</code> and <code>Property</code> (2)</td>
</tr>

<tr>
<td class="org-left">ClassificationProperty.property</td>
<td class="org-left">namespaceUri</td>
<td class="org-left">namespaceUri</td>
<td class="org-left">propertyNamespaceUri</td>
<td class="org-left">GraphQL and JSON have no real link, just the overloaded URL. The RDF prop is a string, should be URL (3)</td>
</tr>

<tr>
<td class="org-left">ClassificationProperty.classification</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">classificationProperty</td>
<td class="org-left">RDF prop is misnamed, should be "classification" (4)</td>
</tr>
</tbody>
</table>

<p>
Illustrations of the points above:
</p>
<ul class="org-ul">
<li>(1) GraphQL field <code>childs</code> appears when one queries for <code>classification (namespaceUri:"...", includeChilds:true)</code>.
It includes a list of children classifications but with simple properties only.</li>
</ul>
<div class="org-src-container">
<pre class="src src-graphql">{
  classification(namespaceUri: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcWall"</span>, includeChilds: <span style="color: #008b8b;">true</span>) {
    name
    code
    namespaceUri
    childs {
      classificationType
      name
    }
  }
}
</pre>
</div>
<p>
results in
</p>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"data"</span>: {
    <span style="color: #8b2252;">"classification"</span>: {
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcWall"</span>,
      <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"IfcWall"</span>,
      <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcWall"</span>,
      <span style="color: #8b2252;">"childs"</span>: [
        {
          <span style="color: #8b2252;">"classificationType"</span>: <span style="color: #8b2252;">"CLASS"</span>,
          <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcWallStandardCase"</span>,
        },
        {
          <span style="color: #8b2252;">"classificationType"</span>: <span style="color: #8b2252;">"CLASS"</span>,
          <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcWall.ELEMENTEDWALL"</span>,
        }
        }}}
</pre>
</div>

<ul class="org-ul">
<li>(1) JSON includes the inverse link (from child to parent), e.g. when one fetches the subclass <code>IfcCableSegmentCABLESEGMENT</code>, one gets a parent link to <code>IfcCableSegment</code></li>
</ul>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #b22222;">// </span><span style="color: #b22222;">curl -s https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT</span>
{
  <span style="color: #8b2252;">"referenceCode"</span>: <span style="color: #8b2252;">"IfcCableSegmentCABLESEGMENT"</span>,
  <span style="color: #8b2252;">"parentClassificationReference"</span>: {
    <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment"</span>,
</pre>
</div>
<ul class="org-ul">
<li>(2,3) In GraphQL and JSON payload, <code>ClassificationProperty</code> does not have a distinct URL, and cannot be obtained separately from the <code>Classification</code> in which it lives.
As a consequence, ClassificationProperties are not considered as first-class entities</li>
</ul>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #b22222;">// </span><span style="color: #b22222;">curl -s https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT</span>
{
  <span style="color: #8b2252;">"referenceCode"</span>: <span style="color: #8b2252;">"IfcCableSegmentCABLESEGMENT"</span>,
  <span style="color: #8b2252;">"classificationProperties"</span>: [
    {
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ACResistance"</span>,
      <span style="color: #8b2252;">"propertyCode"</span>: <span style="color: #8b2252;">"ACResistance"</span>,
      <span style="color: #8b2252;">"propertyDomainName"</span>: <span style="color: #8b2252;">"IFC"</span>,
      <span style="color: #8b2252;">"propertyNamespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/ACResistance"</span>,
</pre>
</div>

<ul class="org-ul">
<li>(3) RDF includes the following attribute (string). Instead, it should be a relation (object property), e.g.  <code>bsdd:property &lt;prop/ACResistance&gt;</code></li>
</ul>
<div class="org-src-container">
<pre class="src src-turtle">@base <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/&gt;</span>.
<span style="color: #0000ff;">&lt;class/IfcCableSegmentCABLESEGMENT/ACResistance&gt;</span>
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyNamespaceUri</span> <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/ACResistance"</span>.
</pre>
</div>

<ul class="org-ul">
<li>(4) RDF includes the following relation. The source is a <code>ClassificationProperty</code> and the target is a <code>Classification</code>, so the relation should be named <code>classification</code></li>
</ul>
<div class="org-src-container">
<pre class="src src-turtle">@base <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/&gt;</span>.
<span style="color: #0000ff;">&lt;class/IfcCableSegmentCABLESEGMENT/ACResistance&gt;</span>
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ClassificationProperty</span> <span style="color: #0000ff;">&lt;class/IfcCableSegmentCABLESEGMENT&gt;</span>.
</pre>
</div>
</div>
</div>

<div id="outline-container-improve-property-names" class="outline-3">
<h3 id="improve-property-names"><span class="section-number-3">4.2.</span> Improve Property Names</h3>
<div class="outline-text-3" id="text-improve-property-names">
<p>
Property names should conform to naming conventions and be spelled consistently
</p>
<ul class="org-ul">
<li>Property (field) names should be spelled in singular, even when they refer to an array.
The arity is reflected in the property kind, e.g. in GraphQL, that's <code>SCALAR</code> vs <code>ARRAY</code>.
For example, <code>String</code> is a scalar string, whereas <code>[String]</code> is an array of strings.</li>
<li>The GraphQL and JSON field <code>childs</code> should be spelled properly as <code>children</code> (unless it's spelled in singular, see above)</li>
<li>RDF properties should conform to the <code>lowerCamelCase</code> convention, i.e. start with a lowercase letter.
Most ontologies conform to this convention, eg see the <a href="https://schema.org/docs/styleguide.html">Schema.org Styleguide</a></li>
<li><code>namespaceUri</code> is a misnomer since "namespace" means a set of URIs sharing the same prefix, but most bSDD URIs are <b>single</b> URIs.
URI is a general term that includes both URNs (non-resolvable) and URLs (resolvable).
According to Linked Data principles, it is better to use resolvable URLs.</li>
<li>RDF properties should use one consistent namespace.
Most props use <code>bsdd: &lt;http://bsdd.buildingsmart.org/def#&gt;</code>,
except <code>hasReference</code>, which uses a different namespace:
<code>&lt;http://bsdd.buildingsmart.org/relation/def#&gt;</code>.
You can see this problem by fetching:</li>
</ul>
<pre class="example">
curl -s -H Accept:text/turtle  https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.0/class/apple
</pre>
</div>
</div>

<div id="outline-container-use-the-same-url-for-data-and-for-web-pages" class="outline-3">
<h3 id="use-the-same-url-for-data-and-for-web-pages"><span class="section-number-3">4.3.</span> Use the Same URL for Data and for Web Pages</h3>
<div class="outline-text-3" id="text-use-the-same-url-for-data-and-for-web-pages">
<p>
bSDD has implemented "entity URLs", i.e. for each kind of entity it can return its data in JSON or RDF:
</p>
<div class="org-src-container">
<pre class="src src-sh">curl -s                      https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT
curl -s -Haccept:text/turtle https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT
</pre>
</div>
<p>
Note: to pretty-print the JSON, add this to the end of the command: <code>| jq .</code>
</p>

<p>
The same URL can be used to get a static web page in the browser:
<a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT</a>
</p>


<div id="org5fdfc80" class="figure">
<p><img src="./img/IFC-class-cableSegment-web.png" alt="IFC-class-cableSegment-web.png" />
</p>
<p><span class="figure-number">Figure 8: </span>CableSegment enity as displayed at the bSDD web site</p>
</div>

<p>
However, the interactive <a href="https://search.bsdd.buildingsmart.org">bSDD Search</a> UI uses a different URL that returns slightly different information:
<a href="https://search.bsdd.buildingsmart.org/Classification/Index/58453">https://search.bsdd.buildingsmart.org/Classification/Index/58453</a>
</p>


<div id="org807aa2b" class="figure">
<p><img src="./img/IFC-class-cableSegment-search.png" alt="IFC-class-cableSegment-search.png" />
</p>
<p><span class="figure-number">Figure 9: </span>CableSegment as displayed at the bSDD search site</p>
</div>

<p>
There is not really a need for two different web pages showing nearly the same info.
We think that with some modest change in technology, the Search UI can use the first (semantic) URL immediately instead of an internal (non-semantic) <code>Index/</code> URL.
Otherwise, there is a danger that people will start copying these non-semantic URLs in communication and (even worse) in AECO data.
</p>
</div>
</div>

<div id="outline-container-improve-url-structure-and-consistency" class="outline-3">
<h3 id="improve-url-structure-and-consistency"><span class="section-number-3">4.4.</span> Improve URL Structure and Consistency</h3>
<div class="outline-text-3" id="text-improve-url-structure-and-consistency">
<p>
To facilitate the accessibility of digital artifacts available from bSDD,
their URLs should be designed uniformly according to <a href="https://www.w3.org/DesignIssues/LinkedData.html">Linked Data Principles</a>.
Recommendations on ontology URI design, including versioning and opaque URIs to maintain evolution and multilingualism inherent to bSDD, are described at [@GarijoPoveda2020].
Proper bSDD domain URL design should take into account the following observations:
</p>
<ul class="org-ul">
<li>Almost all domain URLs have the same structure: <code>https://identifier.buildingsmart.org/uri/&lt;org&gt;/&lt;domain&gt;-&lt;version&gt;</code>.
There are only two exceptions:</li>
</ul>
<pre class="example" id="org6b881d1">
http://otl.amsterdam.nl
http://rdf.vegdata.no/V440/v440-owl
</pre>
<p>
The Linked Data Patterns book describes a pattern of <a href="https://patterns.dataincubator.org/book/hierarchical-uris.html">Hierarchical URIs</a>,
that make URLs more "hackable", allowing users to navigate the hierarchy by pruning the URI.
bSDD URLs could become more hierarchical if they follow this structure:
</p>
<pre class="example" id="org2a8db43">
https://identifier.buildingsmart.org/uri/&lt;org&gt;/&lt;domain&gt;/&lt;version&gt;
</pre>

<p>
Problems:
</p>
<ul class="org-ul">
<li>bSDD uses dash not slash to separate the versoion</li>
<li>In some cases, the <code>&lt;org&gt;</code> is repeated in the <code>&lt;domain&gt;</code> part</li>
<li>In some cases, the <code>&lt;org&gt;</code> name doesn't quite mesh with the domain name, perhaps due to the way bSDD allocates <code>&lt;org&gt;</code> identifiers to bSDD contributors
<ul class="org-ul">
<li>"bim-de/DINSPEC91400": the publisher of this spec is DIN (the German standards organization), not the <code>bim-de</code> initiative</li>
<li>"digibase/volkerwesselsbv": <a href="https://www.bimregister.nl/actueel/video/author/89-delanokenepa?start=250">bimregister.nl news from 2018</a> suggest that <code>digibase</code> is a new company/initaitive within Volker Wessel</li>
<li>"digibase/nen2699": the publisher of this spec is NEN (the Netherlands standards organization), not the <code>digibase</code> company/initiative</li>
<li>"digibase/digibasebouwlagen": perhaps the org name <code>digibase</code> should not be repeated as the prefix of the domain <code>bouwlagen</code> (building layers)</li>
</ul></li>
<li>A few domains use <code>http</code> whereas all others use <code>https</code>. All modern servers prefer <code>https</code> due to its better security.</li>
</ul>
<pre class="example" id="org0458391">
http://identifier.buildingsmart.org/uri/spr/spr-cfhios-0.1
http://otl.amsterdam.nl
http://rdf.vegdata.no/V440/v440-owl
</pre>
</div>

<div id="outline-container-explicate-domain-versions" class="outline-4">
<h4 id="explicate-domain-versions"><span class="section-number-4">4.4.1.</span> Explicate Domain Versions</h4>
<div class="outline-text-4" id="text-explicate-domain-versions">
<p>
bSDD includes multiple versions of some domains.
For example, here are all <code>ACCAtest</code> domain versions:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">dom</th>
<th scope="col" class="org-left">ver</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.1">https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.1</a></td>
<td class="org-left">0.1</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.35">https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.35</a></td>
<td class="org-left">0.35</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.40">https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.40</a></td>
<td class="org-left">0.40</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.41">https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.41</a></td>
<td class="org-left">0.41</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-1.0">https://identifier.buildingsmart.org/uri/acca/ACCAtest-1.0</a></td>
<td class="org-left">1.0</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-8.0">https://identifier.buildingsmart.org/uri/acca/ACCAtest-8.0</a></td>
<td class="org-left">8.0</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-9.0">https://identifier.buildingsmart.org/uri/acca/ACCAtest-9.0</a></td>
<td class="org-left">9.0</td>
</tr>
</tbody>
</table>
<p>
This was obtained with this SPARQL query:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">PREFIX</span> xsd: <span style="color: #008b8b;">&lt;http://www.w3.org/2001/XMLSchema#&gt;</span>
<span style="color: #a020f0;">select</span> * {
  <span style="color: #a0522d;">?dom</span> bsdd:version <span style="color: #a0522d;">?ver</span>
  <span style="color: #a020f0;">filter</span>(contains(str(<span style="color: #a0522d;">?dom</span>),<span style="color: #8b2252;">"ACCAtest"</span>))
} <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> xsd:decimal(<span style="color: #a0522d;">?ver</span>)
</pre>
</div>
<p>
We have seen no guidance how version numbers should be formatted.
</p>
<ul class="org-ul">
<li>If they are decimal number, they should be recorded with type <code>xsd:decimal</code> so they can be compared and sorted
(we cast them to that datatype in the query above)</li>
<li>But if they can have more decimal components (e.g. <code>1.0.1</code>) then they should not be recorded as <code>xsd:decimal</code></li>
</ul>
<p>
We believe it is worth explicating versions:
</p>
<ul class="org-ul">
<li>Either as <code>Domain</code> relations such as <code>previousVersion, nextVersion</code></li>
<li>Or as a new entity <code>DomainVersion</code>, to allow linking all versions of a domain to its master <code>Domain</code> entity</li>
</ul>
</div>
</div>

<div id="outline-container-declare-urls-to-be-id-and-use-a-mandatory-field-id" class="outline-4">
<h4 id="declare-urls-to-be-id-and-use-a-mandatory-field-id"><span class="section-number-4">4.4.2.</span> Declare URLs to be <code>ID</code> and Use a Mandatory Field <code>id</code></h4>
<div class="outline-text-4" id="text-declare-urls-to-be-id-and-use-a-mandatory-field-id">
<p>
The <a href="https://spec.graphql.org/draft/#sec-ID">GraphQL specification sec 3.5.5 ID</a> states:
"The <code>ID</code> scalar type represents a unique identifier,
often used to re-fetch an object or as the key for a cache."
This data type is similar to <code>String</code>, but is specifically used for identifiers.
</p>

<p>
Furthermore, the <a href="https://graphql.org/learn/global-object-identification/#node-interface">Global Object Identification Guide for GraphQL</a> recommends
that a;; objects should have a field <code>id</code> that returns non-null <code>ID!</code> (through the <code>Node</code> interface).
The <code>id</code> should be a "globally unique identifier" for the object,
and given just this <code>id</code>, the server should be able to re-fetch that object.
</p>

<ul class="org-ul">
<li>Most GraphQL implementations call this field simply <code>id</code>, whereas bSDD uses unwieldy property names like <code>namespaceUri</code>.</li>
<li>Many nodes do not have their own <code>namespaceUri</code> field, or it is not fully populated</li>
</ul>
</div>
</div>

<div id="outline-container-overlap-of-entity-classes-with-classificationtype" class="outline-4">
<h4 id="overlap-of-entity-classes-with-classificationtype"><span class="section-number-4">4.4.3.</span> Overlap of Entity Classes with <code>classificationType</code></h4>
<div class="outline-text-4" id="text-overlap-of-entity-classes-with-classificationtype">
<p>
The key field <code>classificationType</code> specifies the kind of classification. Let's do a count:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?c</span>) <span style="color: #a0522d;">?type</span> <span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?d</span> bsdd:classificationType <span style="color: #a0522d;">?type</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?type</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a020f0;">desc</span>(<span style="color: #a0522d;">?c</span>)
</pre>
</div>

<p>
Here are the results, and we see that some <code>classificationType</code> overlap with predefined entity types:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">c</th>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-left">overlaps with</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">29434</td>
<td class="org-left">"CLASS"</td>
<td class="org-left">ok</td>
</tr>

<tr>
<td class="org-right">489</td>
<td class="org-left">"MATERIAL"</td>
<td class="org-left">ok</td>
</tr>

<tr>
<td class="org-right">387</td>
<td class="org-left">"COMPOSED_PROPERTY"</td>
<td class="org-left">see next section</td>
</tr>

<tr>
<td class="org-right">29</td>
<td class="org-left">"DOMAIN"</td>
<td class="org-left"><code>Domain</code></td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-left">"REFERENCE_DOCUMENT"</td>
<td class="org-left"><code>ReferenceDocument</code></td>
</tr>
</tbody>
</table>

<p>
We can examine some of these unusual classifications with this query:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?x</span> <span style="color: #a0522d;">?name</span> <span style="color: #a0522d;">?type</span> {
  <span style="color: #a0522d;">?x</span> a bsdd:Classification; bsdd:classificationType <span style="color: #a0522d;">?type</span>; bsdd:name <span style="color: #a0522d;">?name</span>
  <span style="color: #a020f0;">filter</span>(<span style="color: #a0522d;">?type</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> (<span style="color: #8b2252;">"CLASS"</span>, <span style="color: #8b2252;">"MATERIAL"</span>))
}
</pre>
</div>

<p>
Examples of unusual classifications:
</p>
<ul class="org-ul">
<li><a href="https://identifier.buildingsmart.org/uri/ATALANE/REX-OBJ-1.0/class/589b06ad-f802-468b-939c-e60436601a7a">https://identifier.buildingsmart.org/uri/ATALANE/REX-OBJ-1.0/class/589b06ad-f802-468b-939c-e60436601a7a</a>
is a "REFERENCE_DOCUMENT" with name "dcret 2011-321 (23/03/2011)".
Why is it not a <code>ReferenceDocument</code> entity?</li>
<li><a href="https://identifier.buildingsmart.org/uri/acca/AASHTO-1.0/class/06">https://identifier.buildingsmart.org/uri/acca/AASHTO-1.0/class/06</a>
is a "DOMAIN" with name "Bridge Superstructure".
This reflects the hierarchical nature of the AASHTO-1.0 classification, which we can see clearly with the following query.
But bSDD accommodates classification hierarchies, so why "Bridge Superstructure" is "DOMAIN" and not "CLASS"?</li>
</ul>

<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?code</span> <span style="color: #a0522d;">?name</span> <span style="color: #a0522d;">?type</span> <span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?x</span> a bsdd:Classification; bsdd:name <span style="color: #a0522d;">?name</span>; bsdd:code <span style="color: #a0522d;">?code</span>; bsdd:classificationType <span style="color: #a0522d;">?type</span>.
  <span style="color: #a020f0;">filter</span>(strstarts(str(<span style="color: #a0522d;">?x</span>),<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/acca/AASHTO-1.0/class/06"</span>))
} <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?code</span>
</pre>
</div>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">code</th>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-left">type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">06</td>
<td class="org-left">Bridge Superstructure</td>
<td class="org-left">DOMAIN</td>
</tr>

<tr>
<td class="org-left">06.01</td>
<td class="org-left">Bearing</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.02</td>
<td class="org-left">Curb</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.03</td>
<td class="org-left">Deck</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.04</td>
<td class="org-left">Deck Drain</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.05</td>
<td class="org-left">Deck Joints</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.06</td>
<td class="org-left">Haunch</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.07</td>
<td class="org-left">Girder</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.08</td>
<td class="org-left">Median</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.09</td>
<td class="org-left">Parapet (Barrier)</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.10</td>
<td class="org-left">Railing</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.11</td>
<td class="org-left">Sidewalk</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.12</td>
<td class="org-left">Sound Wall (Barrier)</td>
<td class="org-left">CLASS</td>
</tr>

<tr>
<td class="org-left">06.13</td>
<td class="org-left">Transverse Member</td>
<td class="org-left">CLASS</td>
</tr>
</tbody>
</table>

<p>
We can posit (guess) two reasons for this structural problem:
</p>
<ul class="org-ul">
<li>The bSDD data model does not provide a way to model sub-domains or attach reference documents to specific domains</li>
<li>Some bSDD data contributors use <code>Classification</code> as a "dump" of all kinds of data, not just single entities</li>
</ul>
</div>
</div>

<div id="outline-container-property-vs-classificationproperty-use-distinct-urls" class="outline-4">
<h4 id="property-vs-classificationproperty-use-distinct-urls"><span class="section-number-4">4.4.4.</span> Property vs ClassificationProperty: Use Distinct URLs</h4>
<div class="outline-text-4" id="text-property-vs-classificationproperty-use-distinct-urls">
<p>
<code>Property</code> and <code>ClassificationProperty</code> are two different classes, but the latter does not have a distinct URL in GraphQL and JSON.
The same URL is overloaded to identify entities of both classes.
<code>ClassificationProperty</code> are thus "second class" entities and are not returned separately by the JSON or RDF entity API,
but only as part of the respective <code>Classification</code>:
</p>
<div class="org-src-container">
<pre class="src src-sh">curl https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT/ACResistance
{<span style="color: #8b2252;">""</span>:[<span style="color: #8b2252;">"Classification with namespace URI</span>
<span style="color: #8b2252;"> 'https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT/ACResistance'</span>
<span style="color: #8b2252;">  not found"</span>]}
</pre>
</div>

<p>
<code>ClassificationProperty</code> is identified only in RDF since this format forces one to use different identities for different nodes:
</p>
<div class="org-src-container">
<pre class="src src-turtle"><span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT/ACResistance&gt;</span>
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ClassificationProperty</span> <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT&gt;</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyDomainName</span> <span style="color: #8b2252;">"IFC"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyNamespaceUri</span> <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/ACResistance"</span>.
</pre>
</div>
</div>
</div>

<div id="outline-container-all-entities-should-have-url" class="outline-4">
<h4 id="all-entities-should-have-url"><span class="section-number-4">4.4.5.</span> All Entities Should Have URL</h4>
<div class="outline-text-4" id="text-all-entities-should-have-url">
<p>
Following the thinking of the previous section, all significant classes should have <code>ID</code>,
(which in the case of RDF data is the node URL).
</p>

<p>
However, many bSDD classes don't have such a field:
</p>
<ul class="org-ul">
<li><code>Domain, Property, Classification</code> do have <code>namespaceUri</code></li>
<li><code>Country, Language, Unit</code> don't have an ID but have a field (<code>code, isocode</code>)
that can be used to make an <code>ID</code>, when prepended with an appropriate prefix.
However, <code>Unit.code</code> is not always fit to be used in a URL</li>
<li><code>ClassificationProperty</code> doesn't have an ID in GraphQL.
We follow the bSDD RDF representation and assign a URL
from the URL of the owning object (<code>Classification</code>) and its own <code>propertyCode</code>:</li>
</ul>
<pre class="example">
Classification.namespaceUri+"/"+propertyCode
</pre>

<ul class="org-ul">
<li><code>PropertyValue, ClassificationPropertyValue</code> have <code>namespaceUri</code>
but it's optional and is rarely filled.
We assign URLs similarly to the previous case:
from the URL of the owning object and its <code>value</code>:</li>
</ul>
<pre class="example">
Property.namespaceUri+"/"+value OR
ClassificationProperty.namespaceUri+"/"+value
</pre>

<ul class="org-ul">
<li>The following classes have no fields suitable to make a URL, so they remain blank nodes:
<ul class="org-ul">
<li><code>ReferenceDocument</code>: only <code>name, title, date</code></li>
<li><code>ClassificationRelation</code>: a pair of <code>related</code> Classifications, no own URL</li>
<li><code>PropertyRelation</code>: a pair of <code>related</code> Properties, no own URL</li>
</ul></li>
</ul>

<p>
For example, the classification shown below has <code>ClassificationProperties</code> with no <code>propertyCode</code>
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/class/Nondestructive"</span>,
<span style="color: #8b2252;">"properties"</span>: [
  {
    <span style="color: #8b2252;">"description"</span>: <span style="color: #8b2252;">"Identifier of the tested structure"</span>,
    <span style="color: #8b2252;">"isRequired"</span>: <span style="color: #008b8b;">true</span>,
    <span style="color: #8b2252;">"isWritable"</span>: <span style="color: #008b8b;">true</span>,
    <span style="color: #8b2252;">"predefinedValue"</span>: <span style="color: #008b8b;">null</span>,
    <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Single"</span>,
    <span style="color: #8b2252;">"__typename"</span>: <span style="color: #8b2252;">"ClassificationProperty"</span>
  }...]
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-modeling-issues" class="outline-3">
<h3 id="modeling-issues"><span class="section-number-3">4.5.</span> Modeling Issues</h3>
<div class="outline-text-3" id="text-modeling-issues">
<p>
In addition to the technical recommendations above (to ease findability and accessibility of data in bSDD by improving URls),
we have noticed several modeling issues.
</p>
</div>

<div id="outline-container-modeling-of-complex-properties" class="outline-4">
<h4 id="modeling-of-complex-properties"><span class="section-number-4">4.5.1.</span> Modeling of Complex Properties</h4>
<div class="outline-text-4" id="text-modeling-of-complex-properties">
<p>
The bSDD data model allows the modeling of complex properties that are composed of other properties:
The key attribute <code>propertyValueKind</code> has values COMPLEX and COMPLEX_LIST used in combination with <code>connectedProperties</code>.
</p>
<ul class="org-ul">
<li>These key values are defined for <code>Property</code> and <code>ClassificationProperty</code></li>
<li>However, <code>connectedPropertyCodes</code> is defined only for <code>Property</code></li>
<li>More importantly, these key values are never used</li>
</ul>

<p>
<code>connectedProperty</code> is used only on seven <code>Properties</code> (and not <code>ClassificationProperties</code>):
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?prop</span> (group_concat(<span style="color: #a0522d;">?code</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?connectedPropCodes</span>) <span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?prop</span>  bsdd:connectedPropertyCode <span style="color: #a0522d;">?code</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?prop</span>
</pre>
</div>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">prop</th>
<th scope="col" class="org-left">connectedPropCodes</th>
<th scope="col" class="org-left">comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.0/prop/volume">https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.0/prop/volume</a></td>
<td class="org-left">"height depth width diameter"</td>
<td class="org-left">Just a sample, not a real domain</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.1/prop/volume">https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.1/prop/volume</a></td>
<td class="org-left">"height depth width diameter"</td>
<td class="org-left">Just a sample, not a real domain</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/TestObjective">https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/TestObjective</a></td>
<td class="org-left">"ComponentID StructureID"</td>
<td class="org-left">TestObjective relates to ComponentID and StructureID</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/ExpansionWave">https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/ExpansionWave</a></td>
<td class="org-left">"Frequency"</td>
<td class="org-left">Seems the connection should be symmetric, why is it not?</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/CPicture">https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/CPicture</a></td>
<td class="org-left">"BPicture APicture"</td>
<td class="org-left">A complete cluster of 3 connected props</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/BPicture">https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/BPicture</a></td>
<td class="org-left">"CPicture APicture"</td>
<td class="org-left">A complete cluster of 3 connected props</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/APicture">https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/APicture</a></td>
<td class="org-left">"CPicture BPicture"</td>
<td class="org-left">A complete cluster of 3 connected props</td>
</tr>
</tbody>
</table>

<p>
The meaning of <code>connectedPropertyCodes</code> is not defined:
</p>
<ul class="org-ul">
<li>Is it a symmetric/equivalence relation between properties?</li>
<li>Or is it used to point from a "master" property to its "subsidiary properties"?</li>
</ul>
<p>
The examples don't clarify this question.
</p>

<p>
Instead of using <code>connectedPropertyCode</code> to describe complex properties, some people have used classifications with the type "COMPOSED_PROPERTY".
One such example is <a href="https://identifier.buildingsmart.org/uri/buildingsmart-fr/BRIDGE-MINnD-1.0/class/609952491">https://identifier.buildingsmart.org/uri/buildingsmart-fr/BRIDGE-MINnD-1.0/class/609952491</a>
with name "Pile location" and definition "Gather properties to locate a pile".
We can see the properties comprising this "COMPOSED_PROPERTY" by using the link <code>Classification.classificationProperty</code>:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?type</span> <span style="color: #a0522d;">?code</span> <span style="color: #a0522d;">?name</span> <span style="color: #a0522d;">?def</span> {
  <span style="color: #a020f0;">bind</span>(<span style="color: #008b8b;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart-fr/BRIDGE-MINnD-1.0/class/609952491&gt;</span> <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?class</span>)
  {<span style="color: #a020f0;">bind</span>(<span style="color: #a0522d;">?class</span> <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?x</span>)} <span style="color: #a020f0;">union</span> {<span style="color: #a0522d;">?class</span> bsdd:classificationProperty <span style="color: #a0522d;">?x</span>}
  <span style="color: #a0522d;">?x</span> a <span style="color: #a0522d;">?type</span>; bsdd:code <span style="color: #a0522d;">?code</span>; bsdd:name <span style="color: #a0522d;">?name</span>
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?x</span> bsdd:definition <span style="color: #a0522d;">?def</span>}
}
</pre>
</div>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-left">code</th>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-left">def</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bsdd:Classification</td>
<td class="org-left">609952491</td>
<td class="org-left">Pile location</td>
<td class="org-left">Gather properties to locate a pile</td>
</tr>

<tr>
<td class="org-left">bsdd:ClassificationProperty</td>
<td class="org-left">PR277312330</td>
<td class="org-left">Elevation at the bottom of pile</td>
<td class="org-left">Height at the bottom of the pile</td>
</tr>

<tr>
<td class="org-left">bsdd:ClassificationProperty</td>
<td class="org-left">PR1084319020</td>
<td class="org-left">Elevation at the top of pile</td>
<td class="org-left">Height at the top of the pile</td>
</tr>

<tr>
<td class="org-left">bsdd:ClassificationProperty</td>
<td class="org-left">PR1964355937</td>
<td class="org-left">Skew angle at pile location</td>
<td class="org-left">Angle between the bridge axis and the pile axis</td>
</tr>

<tr>
<td class="org-left">bsdd:ClassificationProperty</td>
<td class="org-left">PR993801653</td>
<td class="org-left">Station at pile location</td>
<td class="org-left">Curvilinear abscissa at pile location</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-modeling-of-dynamic-properties" class="outline-4">
<h4 id="modeling-of-dynamic-properties"><span class="section-number-4">4.5.2.</span> Modeling of Dynamic Properties</h4>
<div class="outline-text-4" id="text-modeling-of-dynamic-properties">
<p>
12385 <code>Properties</code> are declared as <code>isDynamic</code> (135250 are not).
However, the field <code>dynamicParameterPropertyCode</code> is always empty, so one
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> * {
  <span style="color: #a0522d;">?prop</span> bsdd:isDynamic true.
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?prop</span> bsdd:dynamicParameterPropertyCode <span style="color: #a0522d;">?dyn</span>}
} <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a020f0;">desc</span>(<span style="color: #a0522d;">?dyn</span>)
</pre>
</div>

<p>
Additionally, <code>dynamicParameterPropertyCodes</code> is <code>String</code>, but should be <code>[Property]</code>, i.e. an array of <code>Properties</code> used to compute the dynamic property.
</p>
</div>
</div>

<div id="outline-container-improve-relations-between-entities" class="outline-4">
<h4 id="improve-relations-between-entities"><span class="section-number-4">4.5.3.</span> Improve Relations Between Entities</h4>
<div class="outline-text-4" id="text-improve-relations-between-entities">
<p>
bSDD includes numerous string attributes (codes or URLs) that should be converted to relations (object fields) to improve the connectedness of the bSDD has many string attributes (codes or URLs) that should be converted to the relations (object fields) to improve the connectedness of the GraphQL graph.
</p>
<ul class="org-ul">
<li><code>ClassificationRelation</code> and <code>PropertyRelation</code> do not have any outgoing relations. Instead, they use strings (e.g. <code>relatedPropertyUri</code>), thus blocking further GraphQL navigation.</li>
<li>There are several entities (<code>Country, Language, ReferenceDocument, Unit</code>) that are not used anywhere.
Instead of relations pointing to these types, the other types have properties  (e.g. <code>countryOfOrigin</code>, <code>countriesOfUse</code>) representing the same information as <code>String</code>.</li>
</ul>
<p>
Problems related to this approach:
</p>
<ul class="org-ul">
<li>One cannot easily navigate in the GraphQL graph.
e.g. to find the country name for <code>countriesOfUse: ["BG"]</code>, one needs to make a second query, get all countries, and look for that code.</li>
<li>It represents data denormalization that creates opportunities for data inconsistency or redundancy,
e.g. if <code>countriesOfUse</code> includes a code "XX" not defined in <code>Country</code>, is that a mistake, or is <code>Country</code> just an advisory table?</li>
</ul>

<p>
Here is a list of all strings that are candidates to be converted to object properties (relations). <code>[Foo]</code> indicates an array (multivalued property):
</p>
<ul class="org-ul">
<li><code>connectedPropertyCodes</code>: should become <code>[Property]</code></li>
<li><code>countriesOfUse</code>: should become <code>[Country]</code></li>
<li><code>countryOfOrigin</code>: should become <code>Country</code></li>
<li><code>creatorLanguagecode</code>: should become <code>Language</code></li>
<li><code>documentReference</code>: unclear whether it should be a URL, a bibliographic reference, a title, or some other free text. Should become <code>ReferenceDocument</code></li>
<li><code>dynamicParameterPropertyCodes</code>: should become <code>[Property]</code></li>
<li><code>example</code> "Illustrate possible use or values of the Property": could become <code>PropertyValue</code> if it's used consistently to show an example value (not a free text)</li>
<li><code>languageCode</code>: should become <code>Language</code></li>
<li><code>physicalQuantity</code>: could become a separate entity, since it governs what possible <code>units</code> are allowed. See detailed analysis of units later on</li>
<li><code>predefinedValue</code>: should become <code>PropertyValue</code>.
Actually this is a more difficult point because a predefined value could be a number thus not represented as <code>PropertyValue</code>.</li>
<li><code>propertySet</code>: should be made an entity, it's too important to be a mere string</li>
<li><code>relatedClassificationUri</code>: should become <code>Classification</code> (in our refactoring, we rename it to simply <code>related</code> to use the same name for both kinds of relation)</li>
<li><code>relatedIfcEntityNames</code>: since IFC is present as a bSDD Domain, should become a relation to the respective IFC Classification.</li>
<li><code>relatedPropertyUri</code>: should become <code>Property</code> (in our refactoring, we rename it to simply <code>related</code> to use the same name for both kinds of relation)</li>
<li><code>replacedObjectCodes, replacingObjectCodes</code>: should become some kind of objects. But because the field is never filled, we cannot tell what kind of objects</li>
<li><code>subdivisionsOfUse</code>: should be made an entity and become <code>[CountrySubdivision]</code>:
Just like the entity <code>Country</code> should be used as a lookup table for <code>countriesOfUse</code>.
Furthermore,  subdivisions are subjugated to countries, so each <code>CountrySubdivision</code> must have a relation to its parent <code>Country</code></li>
<li><code>units</code>: should become <code>[Unit]</code></li>
</ul>
</div>
</div>

<div id="outline-container-add-more-entities" class="outline-4">
<h4 id="add-more-entities"><span class="section-number-4">4.5.4.</span> Add More Entities</h4>
<div class="outline-text-4" id="text-add-more-entities">
<p>
Summarizing findings from previous sections, we recommend creating the following as additional first-class entities:
</p>
<ul class="org-ul">
<li><code>CountrySubdivision</code>: as lookup for <code>subdivisionsOfUse</code>, subjugated to <code>Country</code></li>
<li><code>DomainVersion</code>: to explicitly relate domain versions to each other, and to a master <code>Domain</code> entity</li>
<li><code>PhysicalQuantity</code>: to govern allowed <code>Units</code>, and to be subjugated to the <code>dimension*</code> fields</li>
<li><code>PropertySet</code>: important concept in both IFC and bSDD</li>
</ul>
</div>
</div>

<div id="outline-container-use-class-inheritance" class="outline-4">
<h4 id="use-class-inheritance"><span class="section-number-4">4.5.5.</span> Use Class Inheritance</h4>
<div class="outline-text-4" id="text-use-class-inheritance">
<p>
The following types are very similar, and most of their fields are duplicated between them, with no modularity or inheritance:
</p>
<ul class="org-ul">
<li><code>PropertyValue</code> and <code>ClassificationPropertyValue</code>: in fact are the same.
These are "value objects" (simple immutable objects), so there's no need to have two different types.</li>
<li><code>Property</code> and <code>ClassificationProperty</code>.
They differ by only 5 fields:
<ul class="org-ul">
<li><code>connectedPropertyCodes</code> (String) and <code>relations</code> (PropertyRelation) belong uniquely to <code>Property</code></li>
<li><code>isRequired</code> (Boolean), <code>isWritable</code> (Boolean), <code>predefinedValue</code> (String), <code>propertySet</code> (String) and <code>symbol</code> (String) below uniquely to <code>ClassificationProperty</code>.</li>
</ul></li>
</ul>
<p>
<code>Property</code> is a general property definition, while <code>ClassificationProperty</code> is a property modified locally to a <code>Classification</code>.
But since there are no rules on which fields of <code>Property</code> to reuse in  <code>ClassificationProperty</code>,
the latter type copies most of the fields from the former.
</p>

<p>
For example, the property <a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/HandicapAccessible">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/HandicapAccessible</a>
"Indication that this object is designed to be accessible by the handicapped"
is used for all kinds of spaces, as indicated by its <code>propertySet</code> "Pset_SpaceCommon".
There are over 300 Classisifaction Propertiess that use the indicated property:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?propName</span> <span style="color: #a0522d;">?class</span> <span style="color: #a0522d;">?className</span> <span style="color: #a0522d;">?classPropName</span> <span style="color: #a020f0;">where</span> {
  <span style="color: #a020f0;">bind</span>(<span style="color: #008b8b;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/HandicapAccessible&gt;</span> <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?prop</span>)
  <span style="color: #a0522d;">?prop</span> bsdd:name <span style="color: #a0522d;">?propName</span>.
  <span style="color: #a0522d;">?classProp</span> bsdd:property <span style="color: #a0522d;">?prop</span>; bsdd:name <span style="color: #a0522d;">?classPropName</span>.
  <span style="color: #a0522d;">?class</span> bsdd:classificationProperty <span style="color: #a0522d;">?classProp</span>; bsdd:name <span style="color: #a0522d;">?className</span>
} <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?className</span>
</pre>
</div>

<p>
Note: a lot of these are duplicated between the two domains <code>acca/ACCAtest-0.1, molio/cciconstruction-1.0</code>, eg:
</p>
<ul class="org-ul">
<li><a href="https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.1/class/A-FAA">https://identifier.buildingsmart.org/uri/acca/ACCAtest-0.1/class/A-FAA</a> vs</li>
<li><a href="https://identifier.buildingsmart.org/uri/molio/cciconstruction-1.0/class/A-FAA">https://identifier.buildingsmart.org/uri/molio/cciconstruction-1.0/class/A-FAA</a></li>
</ul>

<p>
The problem is that all these ClassificationProperties copy the same field values from the Property, over and over again:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?className</span> <span style="color: #a0522d;">?classPropName</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value1</span> <span style="color: #a0522d;">?value2</span> <span style="color: #a020f0;">where</span> {
  <span style="color: #a020f0;">bind</span>(<span style="color: #008b8b;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/HandicapAccessible&gt;</span> <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?prop</span>)
  <span style="color: #a0522d;">?classProp</span> bsdd:property <span style="color: #a0522d;">?prop</span>; bsdd:name <span style="color: #a0522d;">?classPropName</span>.
  <span style="color: #a0522d;">?class</span> bsdd:classificationProperty <span style="color: #a0522d;">?classProp</span>; bsdd:name <span style="color: #a0522d;">?className</span>.
  <span style="color: #a0522d;">?prop</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value1</span>.
  <span style="color: #a0522d;">?classProp</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value2</span>.
  <span style="color: #a020f0;">filter</span>(<span style="color: #a0522d;">?field</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> (rdf:type))
  <span style="color: #a020f0;">filter</span>(<span style="color: #a0522d;">?value1</span> != <span style="color: #a0522d;">?value2</span>)
}
</pre>
</div>

<p>
We also investigated the same problems across <b><b>all</b></b> props.
We ended up with a lot more complicated query:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">PREFIX</span> rdf: <span style="color: #008b8b;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?className</span> <span style="color: #a0522d;">?classPropName</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value1</span> <span style="color: #a0522d;">?value2</span> <span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?classProp</span> bsdd:property <span style="color: #a0522d;">?prop</span>; bsdd:name <span style="color: #a0522d;">?classPropName</span>.
  <span style="color: #a0522d;">?class</span> bsdd:classificationProperty <span style="color: #a0522d;">?classProp</span>; bsdd:name <span style="color: #a0522d;">?className</span>.
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?prop</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?val1</span>}
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?classProp</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?val2</span>}
  <span style="color: #a020f0;">filter</span>(<span style="color: #a0522d;">?field</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> (rdf:type, bsdd:allowedValue, bsdd:connectedPropertyCode,
                        bsdd:countryOfUse, bsdd:name, bsdd:description, bsdd:textFormat))
  <span style="color: #a020f0;">bind</span>(replace(str(<span style="color: #a0522d;">?val1</span>),<span style="color: #8b2252;">"[ \\n\\t]*(.*?)[ \\n\\t]*"</span>,<span style="color: #8b2252;">"$1"</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?value1</span>)
  <span style="color: #a020f0;">bind</span>(replace(str(<span style="color: #a0522d;">?val2</span>),<span style="color: #8b2252;">"[ \\n\\t]*(.*?)[ \\n\\t]*"</span>,<span style="color: #8b2252;">"$1"</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?value2</span>)
  <span style="color: #a020f0;">filter</span>(!bound(<span style="color: #a0522d;">?value1</span>) || !bound(<span style="color: #a0522d;">?value2</span>) || <span style="color: #a0522d;">?value1</span> != <span style="color: #a0522d;">?value2</span>)
}
</pre>
</div>

<p>
It does the following:
</p>
<ul class="org-ul">
<li>Allows for differences of optional fields, i.e. present in Property but missing in ClassificationProperty or vice versa</li>
<li>Trims leading and trailing whitespace from field values (see next section)</li>
<li>Ignores <code>rdf:type</code> because it's naturally different (<code>bsdd:Property</code> vs <code>bsdd:ClassificationProperty</code>)</li>
<li>Ignores <code>bsdd:name, bsdd:description</code> because minor variations are often present. Example for <code>bsdd:name</code> are:
"Inhalt(Menge)jeBestelleinheit" vs "Inhalt_(Menge)_je_Bestelleinheit"</li>
<li>Ignores <code>bsdd:allowedValue, bsdd:connectedPropertyCode, bsdd:countryOfUse</code> because these multi-valued fields are not so easy to compare (separate queries would be needed for this)</li>
<li>Ignores <code>bsdd:textFormat</code> because we saw only invalid values, such as "" and "F.001"</li>
</ul>

<p>
Valid changes include:
</p>
<ul class="org-ul">
<li><code>min/maxInclusive/Exclusive</code>: e.g. "Height" is defined to have a valid range 0..5000, but in the class "Apple" it's restricted to 1..25.
However, we have seen this only in sample domains.</li>
<li><code>unit</code>, e.g. from "m" to "mm" or "cm." Ideally, this should happen if the <code>physicalQuantity</code> and <code>dimension</code> are preserved but it is often not the case:
<ul class="org-ul">
<li>"Pitting": "Profondit in media": unit "" vs "mm" (which is invalid).</li>
<li>"Pitting": "Entit del fenomeno (sup)": unit "m" vs "m".
It seems there is an uncertainty how surface defects (pitting, erosion, patina) should be measured: as length/diameter or as area.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-improve-description-of-classificationproperties" class="outline-4">
<h4 id="improve-description-of-classificationproperties"><span class="section-number-4">4.5.6.</span> Improve Description of ClassificationProperties</h4>
<div class="outline-text-4" id="text-improve-description-of-classificationproperties">
<p>
Perhaps because there is no clearly defined distinction between global properties (<code>Property</code>) and local properties (<code>ClassificationProperty</code>),
and there are no rules on what fields they can inherit from one to the other, several local properties lack adequate descriptions.
For example, let's look at the local property <code>Status</code> in classification <a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox">IfcAirTerminalBox</a>:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Status"</span>,
<span style="color: #8b2252;">"description"</span>: <span style="color: #8b2252;">"The status currently assigned to the permit."</span>,
<span style="color: #8b2252;">"propertyCode"</span>: <span style="color: #8b2252;">"Status"</span>,
<span style="color: #8b2252;">"propertyNamespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/Status"</span>,
<span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_AirTerminalBoxTypeCommon"</span>,
</pre>
</div>
<p>
The local definition refers to an appropriate propertySet <code>Pset_AirTerminalBoxTypeCommon</code>,
but the <code>description</code> is not suitable to that classification (an "AirTerminalBox" is not a "permit"!).
</p>
</div>
</div>

<div id="outline-container-improve-representation-of-propertyvalues" class="outline-4">
<h4 id="improve-representation-of-propertyvalues"><span class="section-number-4">4.5.7.</span> Improve Representation of PropertyValues</h4>
<div class="outline-text-4" id="text-improve-representation-of-propertyvalues">
<p>
<code>PropertyValue</code> and <code>ClassificationPropertyValue</code> are structured values with rich fields: <code>code, value, namespaceUri, description, sortNumber</code>.
These fields allow:
</p>
<ul class="org-ul">
<li>Unique identification of values through <code>namespaceUri</code></li>
<li>Potentially multilingual translations in the future (if <code>value, description</code> are made multivalued and attached a language tag)</li>
<li>The logical ordering of values through <code>sortNumber</code> (as opposed to alphabetical ordering)</li>
</ul>
<p>
However, most structured values we've seen have only <code>code, value</code>
</p>

<p>
For example, consider this property:
</p>
<div class="org-src-container">
<pre class="src src-sh">curl https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/ArrangementType
</pre>
</div>

<p>
Its <code>description</code> includes not just a property description, but is followed by descriptions of values (newline-separated):
</p>
<div class="org-src-container">
<pre class="src src-json">      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ArrangementType"</span>,
      <span style="color: #8b2252;">"description"</span>: <span style="color: #8b2252;">"Terminal box arrangement.\n\</span>
<span style="color: #8b2252;">SingleDuct: Terminal box receives warm or cold air from a single air supply duct.\n\</span>
<span style="color: #8b2252;">DualDuct: Terminal box receives warm and cold air from separate air supply ducts."</span>,
</pre>
</div>
<p>
The same property when used in classification <a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox">IfcAirTerminalBox</a> has values described like this:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> * {
  <span style="color: #008b8b;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType&gt;</span> bsdd:allowedValue <span style="color: #a0522d;">?val</span>.
  <span style="color: #a0522d;">?val</span> bsdd:code <span style="color: #a0522d;">?code</span>;
       <span style="color: #b22222;"># bsdd:value ?value # same as "code"</span>
} <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?code</span>
</pre>
</div>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">val</th>
<th scope="col" class="org-left">code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/DUALDUCT">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/DUALDUCT</a></td>
<td class="org-left">DUALDUCT</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/NOTKNOWN">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/NOTKNOWN</a></td>
<td class="org-left">NOTKNOWN</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/OTHER">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/OTHER</a></td>
<td class="org-left">OTHER</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/SINGLEDUCT">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/SINGLEDUCT</a></td>
<td class="org-left">SINGLEDUCT</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/UNSET">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox/ArrangementType/UNSET</a></td>
<td class="org-left">UNSET</td>
</tr>
</tbody>
</table>
<p>
This has multiple problems:
</p>
<ul class="org-ul">
<li>Individual values have no description (<code>description</code> is not filled out)</li>
<li>Some values are described in the property definition, intermingling multiple descriptions together</li>
<li>The "standard" values NOTKNOWN, OTHER, UNSET are not described at all.</li>
<li>Values have no <code>namespaceUri</code>, precluding unique identification.</li>
</ul>
</div>
</div>

<div id="outline-container-improve-representation-of-predefinedvalue" class="outline-4">
<h4 id="improve-representation-of-predefinedvalue"><span class="section-number-4">4.5.8.</span> Improve Representation of predefinedValue</h4>
<div class="outline-text-4" id="text-improve-representation-of-predefinedvalue">
<p>
<code>allowedValues</code> (and its deprecated variant <code>possibleValues</code>) store structured values (<code>ClassificationPropertyValue</code>).
However, their "sibling" property <code>predefinedValue</code> holds a mere string and not a structured value, which means that even in the future, <code>predefinedValue</code> cannot be an enumeration value identified globally with a URL.
We could think of two possible reasons for this discrepancy:
</p>
<ul class="org-ul">
<li><code>predefinedValue</code> needs to hold not just enumeration values but also Real, String, Boolean, etc.
Then it should be structured as a variant and not be cast down to String.</li>
<li>It may be related to the poor description of PropertyValue</li>
</ul>
</div>
</div>

<div id="outline-container-improve-multilingual-support" class="outline-4">
<h4 id="improve-multilingual-support"><span class="section-number-4">4.5.9.</span> Improve Multilingual Support</h4>
<div class="outline-text-4" id="text-improve-multilingual-support">
<p>
bSDD is advertised as a multilingual dictionary.
In the GraphQL API, one can specify a desired language when fetching classifications and properties:
</p>
<div class="org-src-container">
<pre class="src src-graphql">classification(includeChilds: <span style="color: #228b22;">Boolean</span>, languageCode: <span style="color: #228b22;">String</span>, namespaceUri: <span style="color: #228b22;">String</span>!) {...}
property(languageCode: <span style="color: #228b22;">String</span>, namespaceUri: <span style="color: #228b22;">String</span>!) {...}
</pre>
</div>

<p>
However, each domain seems to be present in one language only (<b>unilingual</b>).
When you fetch a Classification or Property from the REST API:
</p>
<ul class="org-ul">
<li>Text properties like <code>name</code> and <code>description</code> are single-valued and present in one language only</li>
<li>There's a single-valued prop <code>creatorLanguageCode</code></li>
<li>Unlike <code>rdf:langString</code> that are self-describing (e.g. <code>"wall"@en</code> vs <code>"wand"@de</code>),
bSDD text fields do not carry a lang code with them</li>
</ul>
<p>
In contrast, <a href="https://platform.ontotext.com/semantic-objects/tutorials/graphql-query.html#filtering-literal-values">Ontotext Platform Semantic Objects</a> includes comprehensive facilities for selecting labels per language, including language fallback.
</p>
</div>
</div>
</div>

<div id="outline-container-improve-rdf-structure" class="outline-3">
<h3 id="improve-rdf-structure"><span class="section-number-3">4.6.</span> Improve RDF Structure</h3>
<div class="outline-text-3" id="text-improve-rdf-structure">
<p>
Overall, bSDD RDF represents the scope of bSDD data faithfully, although there are various omissions. We highlight the problems to be corrected.
Let's examine the RDF Turtle for <code>ClassificationProperty</code> "IfcCableSegmentCABLESEGMENT/ACResistance":
</p>
<div class="org-src-container">
<pre class="src src-turtle"><span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT/ACResistance&gt;</span>
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ClassificationProperty</span> <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT&gt;</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyDomainName</span> <span style="color: #8b2252;">"IFC"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyNamespaceUri</span> <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/ACResistance"</span>.
</pre>
</div>

<p>
It has these defects:
</p>
<ul class="org-ul">
<li>Lacks <code>rdf:type</code></li>
<li>RDF property names should start in lowercase</li>
<li>String attributes should be converted to relations whenever possiblek applicable</li>
<li>URLs should be object properties instead of strings</li>
</ul>

<p>
This Turtle can be corrected as follows:
</p>
<div class="org-src-container">
<pre class="src src-turtle"><span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT/ACResistance&gt;</span>
  <span style="color: #a020f0;">a</span> <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ClassificationProperty</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">classification</span> <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegmentCABLESEGMENT&gt;</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">domain</span> <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3&gt;</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">property</span> <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/ACResistance&gt;</span>.
</pre>
</div>
</div>
</div>

<div id="outline-container-graphql-improvements" class="outline-3">
<h3 id="graphql-improvements"><span class="section-number-3">4.7.</span> GraphQL Improvements</h3>
<div class="outline-text-3" id="text-graphql-improvements">
<p>
In this section we describe problems with the original bSDD GraphQL API.
</p>
</div>
<div id="outline-container-searchability-and-pagination" class="outline-4">
<h4 id="searchability-and-pagination"><span class="section-number-4">4.7.1.</span> Searchability and Pagination</h4>
<div class="outline-text-4" id="text-searchability-and-pagination">
<p>
The most important shortcomings of the original GraphQL API are:
</p>
<ul class="org-ul">
<li>One can search only by very few parameters.
The user is limited to very basic fetching of data: all entities of a class, entity by <code>namespaceUri</code>, or basic full-text search (<code>classificationSearch</code>).
GraphQL users cannot search e.g. for:
<ul class="org-ul">
<li>Compound properties and their constituents</li>
<li>Dynamic properties (although currently none has constituents)</li>
<li>Classifications with relations, and their related classifications</li>
<li>Properties that are Writable or Required</li>
<li>Properties with relations, and their related properties</li>
</ul></li>
<li>No pagination.
One cannot get only a portion of the results, and iterate through pages with <code>limit/offset</code>.
Due to this limitation, one cannot get more than 5000 classifications per domain.</li>
</ul>
<p>
These shortcomings are not present in our refactored GraphQL endpoint, whcih includes a comprehensive <code>where</code> query language.
You can see some sample queries towards the end.
</p>
</div>
</div>

<div id="outline-container-eliminate-parallel-links-between-entities" class="outline-4">
<h4 id="eliminate-parallel-links-between-entities"><span class="section-number-4">4.7.2.</span> Eliminate Parallel Links Between Entities</h4>
<div class="outline-text-4" id="text-eliminate-parallel-links-between-entities">
<p>
There are a number of parallel relations (arrows) in the original GraphQL schema.
</p>
<ul class="org-ul">
<li><code>Root.{domain,domains}</code></li>
<li><code>Domain.{classification,classificationSearch}</code></li>
<li><code>Classification.{property,properties}</code></li>
<li><code>Property.{allowedValues,possibleValues}</code>: <code>possibleValues</code> is deprecated and should be removed</li>
<li><code>ClassificationProperty.{allowedValues,possibleValues}</code>: same</li>
</ul>
<p>
This is not needed in GraphQL because the schema can use parameters to distinguish between different uses of the same field
(e.g. fetch one entity by URL vs search for entities).
It's best practice for the relation to be named the same as the target entity.
We have eliminated such parallel links from the refactored schema.
</p>
</div>
</div>

<div id="outline-container-graphql-arrays-and-nullability" class="outline-4">
<h4 id="graphql-arrays-and-nullability"><span class="section-number-4">4.7.3.</span> GraphQL Arrays and Nullability</h4>
<div class="outline-text-4" id="text-graphql-arrays-and-nullability">
<p>
A GraphQL schema can declare mandatory/optional status at the level of array and at the level of individual elements:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">type</th>
<th scope="col" class="org-left">meaning</th>
<th scope="col" class="org-left">valid examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>[Classification]</code></td>
<td class="org-left">Optional array of optional elements</td>
<td class="org-left"><code>null, [], [null], [Classification]</code></td>
</tr>

<tr>
<td class="org-left"><code>[Classification!]</code></td>
<td class="org-left">Optional array of mandatory elements</td>
<td class="org-left"><code>null, [], [Classification]</code></td>
</tr>

<tr>
<td class="org-left"><code>[Classification]!</code></td>
<td class="org-left">Mandatory array of optional elements</td>
<td class="org-left"><code>[], [null], [Classification]</code></td>
</tr>

<tr>
<td class="org-left"><code>[Classification!]!</code></td>
<td class="org-left">Mandatory array of mandatory elements</td>
<td class="org-left"><code>[], [Classification]</code></td>
</tr>
</tbody>
</table>
<p>
(As you see, there is no way to enforce a <b>non-empty</b> array in GraphQL.)
</p>

<p>
bSDD specifies arrays as <code>[Classification]</code>, which is the most permissive specification.
It means that <code>[null, null, null]</code> is a valid result of a query that returns an array of Classifications.
However, such result is not suitable because null elements are useless.
It would be better to use the type <code>[Classification!]</code>.
</p>
</div>
</div>

<div id="outline-container-null-classifications-error" class="outline-4">
<h4 id="null-classifications-error"><span class="section-number-4">4.7.4.</span> Null Classifications Error</h4>
<div class="outline-text-4" id="text-null-classifications-error">
<p>
Although <code>classificationSearch</code> is declared as nullable (see previous section), a GraphQL error is returned whenever the backend returns <code>null</code>.
Querying all domains with all their classifications:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">getDomainsAndClassifications</span> {
  domains {
    namespaceUri
    classificationSearch {
      namespaceUri
    }
  }
}
</pre>
</div>
<p>
Returns such an error:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"errors"</span>: [
    {
      <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"Error trying to resolve field 'classificationSearch'."</span>,
      <span style="color: #8b2252;">"locations"</span>: [
        {
          <span style="color: #8b2252;">"line"</span>: 4,
          <span style="color: #8b2252;">"column"</span>: 5
        }
      ],
      <span style="color: #8b2252;">"path"</span>: [
        <span style="color: #8b2252;">"domains"</span>,
        67,
        <span style="color: #8b2252;">"classificationSearch"</span>
      ],
      <span style="color: #8b2252;">"extensions"</span>: {
        <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"NULL_REFERENCE"</span>,
        <span style="color: #8b2252;">"codes"</span>: [
          <span style="color: #8b2252;">"NULL_REFERENCE"</span>
        ]
      }
    }
  ],
  <span style="color: #8b2252;">"data"</span>: {
    <span style="color: #8b2252;">"domains"</span>: [
      {
...
</pre>
</div>
</div>
</div>

<div id="outline-container-null-classification-childs-error" class="outline-4">
<h4 id="null-classification-childs-error"><span class="section-number-4">4.7.5.</span> Null Classification Childs Error</h4>
<div class="outline-text-4" id="text-null-classification-childs-error">
<p>
<code>Classification.childs</code> is defined as nullable: with type <code>[Classification]</code>
However, unless <code>includeChilds: true</code> is provided as input argument in <code>classification</code>,
queries return NULL_REFERENCE errors, thus breaking GraphQL spec compliance. E.g. this query:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">getClassificationChildren</span> {
  classification(namespaceUri: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox"</span>,
                 includeChilds: <span style="color: #008b8b;">false</span>) {
    namespaceUri
    childs {
      namespaceUri
    }
  }
}
</pre>
</div>
<p>
Returns this error:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"errors"</span>: [
    {
      <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"Error trying to resolve field 'childs'."</span>,
      <span style="color: #8b2252;">"locations"</span>: [
        {
          <span style="color: #8b2252;">"line"</span>: 4,
          <span style="color: #8b2252;">"column"</span>: 5
        }
      ],
      <span style="color: #8b2252;">"path"</span>: [
        <span style="color: #8b2252;">"classification"</span>,
        <span style="color: #8b2252;">"childs"</span>
      ],
      <span style="color: #8b2252;">"extensions"</span>: {
        <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"NULL_REFERENCE"</span>,
        <span style="color: #8b2252;">"codes"</span>: [
          <span style="color: #8b2252;">"NULL_REFERENCE"</span>
        ]
      }
    }
  ],
  <span style="color: #8b2252;">"data"</span>: {
    <span style="color: #8b2252;">"classification"</span>: {
      <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcAirTerminalBox"</span>,
      <span style="color: #8b2252;">"childs"</span>: <span style="color: #008b8b;">null</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-null-classificationproperty-name-error" class="outline-4">
<h4 id="null-classificationproperty-name-error"><span class="section-number-4">4.7.6.</span> Null ClassificationProperty Name Error</h4>
<div class="outline-text-4" id="text-null-classificationproperty-name-error">
<p>
Some ClassificationProperties have no <code>name</code>.
Although that field is declared nullable, bSDD does not return such properties and instead returns <code>NULL_REFERENCE</code> errors.
For example:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">getClassificationProperties</span> {
  classification(namespaceUri: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/molio/cciconstruction-1.0/class/L-NAA"</span>) {
    name
    properties {
      name
    }
  }
}
</pre>
</div>
<p>
This query returns four out of five properties: the 4th property is returned as <code>null</code>, along with an error:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"errors"</span>: [
    {
      <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"Error trying to resolve field 'name'."</span>,
      <span style="color: #8b2252;">"locations"</span>: [
        {
          <span style="color: #8b2252;">"line"</span>: 5,
          <span style="color: #8b2252;">"column"</span>: 7
        }
      ],
      <span style="color: #8b2252;">"path"</span>: [
        <span style="color: #8b2252;">"classification"</span>,
        <span style="color: #8b2252;">"properties"</span>,
        3,
        <span style="color: #8b2252;">"name"</span>
      ],
      <span style="color: #8b2252;">"extensions"</span>: {
        <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"NULL_REFERENCE"</span>,
        <span style="color: #8b2252;">"codes"</span>: [
          <span style="color: #8b2252;">"NULL_REFERENCE"</span>
        ]
      }
    }
  ],
  <span style="color: #8b2252;">"data"</span>: {
    <span style="color: #8b2252;">"classification"</span>: {
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Pane"</span>,
      <span style="color: #8b2252;">"properties"</span>: [
        {
          <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"FireRating"</span>
        },
        {
          <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ThermalTransmittance"</span>
        },
        {
          <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"GlassLayers"</span>
        },
        <span style="color: #008b8b;">null</span>,
        {
          <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IsExternal"</span>
        }
      ]
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-missing-domains" class="outline-4">
<h4 id="missing-domains"><span class="section-number-4">4.7.7.</span> Missing Domains</h4>
<div class="outline-text-4" id="text-missing-domains">
<p>
The GraphQL root field <code>domains</code> used to return some domains that are not available individually through the field <code>domain</code>, e.g.
</p>
<div class="org-src-container">
<pre class="src src-graphql">{
  domains {
    id: <span style="color: #228b22;">namespaceUri</span>
  }
  domain(namespaceUri: <span style="color: #8b2252;">"http://identifier.buildingsmart.org/uri/spr/spr-cfhios-0.1"</span>) {
    id: <span style="color: #228b22;">namespaceUri</span>
  }
}
</pre>
</div>
<p>
The second response for <code>domain</code> will be <code>null</code> although the domain is present in the <code>domains</code> response.
We saw this problem in January 2023, but it's not present in February 2023.
Note: <code>cfhios</code> above is misspelled, because the name of that data standard is "CFIHOS".
</p>
</div>
</div>

<div id="outline-container-unexpected-multiple-values" class="outline-4">
<h4 id="unexpected-multiple-values"><span class="section-number-4">4.7.8.</span> Unexpected Multiple Values</h4>
<div class="outline-text-4" id="text-unexpected-multiple-values">
<p>
The attribute <code>propertySet</code> is defined as single (SCALAR), see <code>bsdd-graphql-schema-orig.json</code>:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"propertySet"</span>,
<span style="color: #8b2252;">"description"</span>: <span style="color: #8b2252;">"Name of the property set"</span>,
<span style="color: #8b2252;">"args"</span>: [],
<span style="color: #8b2252;">"type"</span>: {
  <span style="color: #8b2252;">"kind"</span>: <span style="color: #8b2252;">"SCALAR"</span>,
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"String"</span>,
  <span style="color: #8b2252;">"ofType"</span>: <span style="color: #008b8b;">null</span>
},
</pre>
</div>
<p>
But in fact there are 1924 <code>ClassificationProperty</code> where this attribute is multi-valued:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">where</span> {
  <span style="color: #a0522d;">?classProp</span> bsdd:propertySet <span style="color: #a0522d;">?set1</span>, <span style="color: #a0522d;">?set2</span>
  <span style="color: #a020f0;">filter</span>(<span style="color: #a0522d;">?set1</span>&lt;<span style="color: #a0522d;">?set2</span>)
}
</pre>
</div>
<p>
For example:
</p>
<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">classProp</th>
<th scope="col" class="org-left">set1</th>
<th scope="col" class="org-left">set2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/bca/ifc-sg-0.1/class/IndependentWorkersDormitory/NumberofWorkers">https://identifier.buildingsmart.org/uri/bca/ifc-sg-0.1/class/IndependentWorkersDormitory/NumberofWorkers</a></td>
<td class="org-left">SGPset_Building</td>
<td class="org-left">SGPset_Site</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcElementAssemblySUSPENSIONASSEMBLY/ContactWireStagger">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcElementAssemblySUSPENSIONASSEMBLY/ContactWireStagger</a></td>
<td class="org-left">Pset_ElementAssemblyTypeOCSSuspension</td>
<td class="org-left">Pset_ElementAssemblyTypeSteadyDevice</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcElementAssemblySUSPENSIONASSEMBLY/ContactWireStagger">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcElementAssemblySUSPENSIONASSEMBLY/ContactWireStagger</a></td>
<td class="org-left">Pset_ElementAssemblyTypeCantilever</td>
<td class="org-left">Pset_ElementAssemblyTypeSteadyDevice</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcElementAssemblySUSPENSIONASSEMBLY/ContactWireStagger">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcElementAssemblySUSPENSIONASSEMBLY/ContactWireStagger</a></td>
<td class="org-left">Pset_ElementAssemblyTypeCantilever</td>
<td class="org-left">Pset_ElementAssemblyTypeOCSSuspension</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcRampFlight/PieceMark">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcRampFlight/PieceMark</a></td>
<td class="org-left">Pset_PrecastConcreteElementFabrication</td>
<td class="org-left">Pset_PrecastConcreteElementGeneral</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcRampFlight/TypeDesignation">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcRampFlight/TypeDesignation</a></td>
<td class="org-left">Pset_PrecastConcreteElementFabrication</td>
<td class="org-left">Pset_PrecastConcreteElementGeneral</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcPile/TypeDesignation">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcPile/TypeDesignation</a></td>
<td class="org-left">Pset_PrecastConcreteElementFabrication</td>
<td class="org-left">Pset_PrecastConcreteElementGeneral</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcPile/PieceMark">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcPile/PieceMark</a></td>
<td class="org-left">Pset_PrecastConcreteElementFabrication</td>
<td class="org-left">Pset_PrecastConcreteElementGeneral</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcColumn/TypeDesignation">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcColumn/TypeDesignation</a></td>
<td class="org-left">Pset_PrecastConcreteElementFabrication</td>
<td class="org-left">Pset_PrecastConcreteElementGeneral</td>
</tr>

<tr>
<td class="org-left"><a href="https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcColumn/Reference">https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcColumn/Reference</a></td>
<td class="org-left">Pset_ColumnCommon</td>
<td class="org-left">Pset_ReinforcementBarPitchOfColumn</td>
</tr>
</tbody>
</table>

<p>
The original bSDD GraphQL endpoint happily returns such mis-declared values. E.g. this query:
</p>
<div class="org-src-container">
<pre class="src src-graphql">{
  domain(namespaceUri: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3"</span>) {
    classification(namespaceUri:<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcElementAssemblySUSPENSIONASSEMBLY"</span>) {
      name
      properties{
        name
        propertyValueKind
        propertySet
      }
    }
  }
}
</pre>
</div>
<p>
Rteurns the offending property 3 times, without getting any warning:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ContactWireStagger"</span>,
  <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
  <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_ElementAssemblyTypeCantilever"</span>
},
{
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"SystemHeight"</span>,
  <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
  <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_ElementAssemblyTypeCantilever"</span>
},
{
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ContactWireHeight"</span>,
  <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
  <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_ElementAssemblyTypeOCSSuspension"</span>
},
{
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ContactWireStagger"</span>,
  <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
  <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_ElementAssemblyTypeOCSSuspension"</span>
},
{
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ContactWireStagger"</span>,
  <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
  <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_ElementAssemblyTypeSteadyDevice"</span>
},
</pre>
</div>
<p>
This will be an unpleasant surprise for processing applications that expect to get each property once,
and you see that the 3 copies of "ContactWireStagger" are not even returned consecutively.
</p>

<p>
Let's try a similar query at our refactored GraphQL endpoint:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">DomainIFC_ClassWall_Props</span> {
  domain(ID:<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3"</span>) {
    classification(ID:<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcWall"</span>) {
      name
      classificationProperty {
        name
        propertyValueKind
        propertySet
      }
    }
  }
}
</pre>
</div>
<p>
In contrast to the original, it returns error information for each offending occurrence (in addition to returning data):
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"errors"</span>: [
  {
    <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"Found 2 values for single-valued field 'propertySet' from 'ClassificationProperty'"</span>,
    <span style="color: #8b2252;">"path"</span>: [
      <span style="color: #8b2252;">"domain"</span>,
      0,
      <span style="color: #8b2252;">"classification"</span>,
      0,
      <span style="color: #8b2252;">"classificationProperty"</span>,
      24,
      <span style="color: #8b2252;">"propertySet"</span>
    ],
    <span style="color: #8b2252;">"locations"</span>: [
      {
        <span style="color: #8b2252;">"line"</span>: 8,
        <span style="color: #8b2252;">"column"</span>: 9
      }
    ]
  },
</pre>
</div>
<p>
We could fix this error easily by declaring the property to be multi-valued,
but we think that <code>propertySet</code> should in fact be single-valued, so the data should be fixed.
</p>
</div>
</div>

<div id="outline-container-deprecated-properties" class="outline-4">
<h4 id="deprecated-properties"><span class="section-number-4">4.7.9.</span> Deprecated Properties</h4>
<div class="outline-text-4" id="text-deprecated-properties">
<p>
The field <code>possibleValues</code> is described as "deprecated".
However, the GraphQL spec section <a href="https://spec.graphql.org/draft/#sec-Field-Deprecation">Field Deprecation</a> shows that a specific <code>@deprecated</code> directive should be used for this purpose.
In the refactored RDF data and GraphQL schema, we removed this field since it just duplicates the function of <code>allowedValues</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-data-quality-problems" class="outline-3">
<h3 id="data-quality-problems"><span class="section-number-3">4.8.</span> Data Quality Problems</h3>
<div class="outline-text-3" id="text-data-quality-problems">
<p>
We found many data quality problems in bSDD, as described below.
</p>
</div>

<div id="outline-container-trim-leading-trailing-consecutive-whitespace" class="outline-4">
<h4 id="trim-leading-trailing-consecutive-whitespace"><span class="section-number-4">4.8.1.</span> Trim Leading, Trailing, Consecutive Whitespace</h4>
<div class="outline-text-4" id="text-trim-leading-trailing-consecutive-whitespace">
<p>
Many bSDD fields are defined as <code>xsd:string</code>.
However, certain whitespaces in strings can be confusing and are not semantically meaningful
(i.e. two values differing only by such whitespace must not be considered to be different):
</p>
<ul class="org-ul">
<li>Leading and Trailing whitespaces should not be present</li>
<li>Consecutive whitespaces should not be present</li>
<li>Tabs should not be used: use spaces instead</li>
<li>Newlines are permissible only in a few cases, but should not be used to describe enumerations</li>
</ul>
<p>
The datatypes <code>xsd:TOKEN</code> and <code>xsd:NMTOKENS</code> have restrictions in this regard.
</p>

<p>
The following query finds some of these cases:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">select</span> * {
  <span style="color: #a0522d;">?x</span> <span style="color: #a0522d;">?field</span> <span style="color: #a0522d;">?value</span>
  <span style="color: #a020f0;">filter</span>(regex(str(<span style="color: #a0522d;">?value</span>),<span style="color: #8b2252;">"^[ \\n\\t]|[ \\n\\t]$"</span>))
}
</pre>
</div>

<p>
Examples where this happens (not a comprehensive list):
</p>
<ul class="org-ul">
<li><code>bsdd:dataType</code> (eg "Real "): this is a crucially important key field that must be controlled.</li>
<li><code>bsdd:description</code> that is an enumeration. Should be expressed as <code>allowedValues</code>. e.g. in <a href="https://identifier.buildingsmart.org/uri/engisis/RFI-02/prop/S25750_0010">https://identifier.buildingsmart.org/uri/engisis/RFI-02/prop/S25750_0010</a>:</li>
</ul>

<pre class="example" id="orgad5960c">
"EL=Elettronica,
SE=Semi-elettronica,
EM=Elettromeccanica,
EMS=Elettromeccanica CPS,
STI= Sistema Telef. Integr.(STI).

EL=Centrale Telefonica Elettronica,
SE=Centrale Telefonica Semi-Elettronica
 EM= Centrale Telefonica Elettromeccanica,
EMS= Centrale Telefonica Elettromeccanica CPS,
STI=  Centrale STI (Sistema Telefonico Integrato)
"
</pre>

<p>
The bSDD data entry or data ingest systems should have validations to prevent such whitespace.
e.g. we could define SHACL rules to prevent such cases.
</p>
</div>
</div>

<div id="outline-container-improve-physical-quantities-and-units" class="outline-4">
<h4 id="improve-physical-quantities-and-units"><span class="section-number-4">4.8.2.</span> Improve Physical Quantities and Units</h4>
<div class="outline-text-4" id="text-improve-physical-quantities-and-units">
<p>
Properties have three characteristics that should be closely correlated:
</p>
<ul class="org-ul">
<li><code>dimension</code>: dimension vector as 7 integers in the format:
L=Length M=Mass T=Time I=Electric current =Thermodynamic temperature N=Amount of substance J=Luminous intensity.
E.g. <code>"1 1 -2 0 0 0 0"</code> represents <code>Force=Length*Mass/Time^2</code></li>
<li><code>unit</code>: unit of measure, which should be compatible with the dimension.
E.g. "m, cm, mm, in" are all compatible with Length (<code>"1 0 0 0 0 0 0"</code>)
<ul class="org-ul">
<li>Unfortunately, the units are not spelled consistently and are incompatible with the type <code>Unit</code>.
There is some effort to incorporate (or migrate towards) the QUDT ontology:
some properties have attribute <code>qudtUnit</code> in the JSON API.</li>
<li>But this is not the right approach: <code>qudtUnit</code> should be attached to <code>Unit</code>, or should replace <code>Property.unit</code></li>
<li>Also, this migration is not yet implemented</li>
</ul></li>
<li><code>physicalQuantity</code>: physical quantity being measured, should be compatible with the dimension.
E.g. "Height, Width, Diameter" are all compatible with Length.</li>
</ul>

<p>
The following query finds all combinations of the three characteristics:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">PREFIX</span> rdf: <span style="color: #008b8b;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?dim</span> <span style="color: #a0522d;">?unit</span> <span style="color: #a0522d;">?quant</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?props</span>) {
  <span style="color: #a0522d;">?x</span> bsdd:unit <span style="color: #a0522d;">?unit</span>; bsdd:physicalQuantity <span style="color: #a0522d;">?quant</span>; bsdd:dimension <span style="color: #a0522d;">?dim</span>
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?dim</span> <span style="color: #a0522d;">?unit</span> <span style="color: #a0522d;">?quant</span>  <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?dim</span>
</pre>
</div>

<p>
There are 60 combinations, too many to present here. A lot of them are due to different spelling of <code>physicalQuantity</code>, which is free text, e.g.:
</p>
<ul class="org-ul">
<li>"Longueur" vs "Lnge | de-DE";</li>
<li>"Force" vs "Kraft | de-DE";</li>
<li>"Epaisseur" vs "Thickness"</li>
</ul>
<p>
This approach is wrong, because e.g. one cannot find all Thickness properties easily.
QUDT provides URLs for various measurable quantities, and labels in numerous languages.
</p>

<p>
Let's ignore <code>physicalQuantity</code>, but allow some of <code>dimension, unit</code> to be missing:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">PREFIX</span> rdf: <span style="color: #008b8b;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?dim</span> <span style="color: #a0522d;">?unit</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?props</span>) {
  {<span style="color: #a0522d;">?x</span> a bsdd:Property} <span style="color: #a020f0;">union</span> {<span style="color: #a0522d;">?x</span> a bsdd:ClassificationProperty}
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?x</span> bsdd:unit <span style="color: #a0522d;">?unit</span>}
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?x</span> bsdd:dimension <span style="color: #a0522d;">?dim</span>}
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?dim</span> <span style="color: #a0522d;">?unit</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?dim</span>
</pre>
</div>
<p>
There are 260 combinations, specifically:
</p>
<ul class="org-ul">
<li>134698 properties have no <code>dimension</code>.
<ul class="org-ul">
<li>2434 properties have <code>dimension</code> "" (the empty string).</li>
</ul></li>
<li>107861 properties have no <code>unit</code>, which is acceptable for enumerated and Boolean properties, and may be used for some dimensionless properties.</li>
<li>104887 properties have neither <code>unit</code> nor <code>dimension</code>, which is acceptable for enumerated and Boolean properties only.</li>
<li>29811 properties have <code>unit</code> but no <code>dimension</code>. e.g.
<ul class="org-ul">
<li>38 properties with unit "m" have the correct dimension vector "1 0 0 0 0 0 0", but 1529 properties have no dimension.</li>
<li>579 properties with unit "mm" have the correct dimension vector "1 0 0 0 0 0 0", but 14983 properties have no dimension, and 4 have the wrong dimension "2 0 3 0 0 0 0".</li>
</ul></li>
</ul>

<p>
Query for the last observation (about unit "mm"):
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">PREFIX</span> rdf: <span style="color: #008b8b;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a0522d;">?dim</span> (count(*) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?props</span>) {
  {<span style="color: #a0522d;">?x</span> a bsdd:Property} <span style="color: #a020f0;">union</span> {<span style="color: #a0522d;">?x</span> a bsdd:ClassificationProperty}
  <span style="color: #a0522d;">?x</span> bsdd:unit <span style="color: #8b2252;">"mm"</span>
  <span style="color: #a020f0;">optional</span> {<span style="color: #a0522d;">?x</span> bsdd:dimension <span style="color: #a0522d;">?dim</span>}
} <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?dim</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> <span style="color: #a0522d;">?dim</span>
</pre>
</div>

<p>
We can find these defective properties as follows:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">PREFIX</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">PREFIX</span> rdf: <span style="color: #008b8b;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span style="color: #a020f0;">select</span> * {
  {<span style="color: #a0522d;">?x</span> a bsdd:Property} <span style="color: #a020f0;">union</span> {<span style="color: #a0522d;">?x</span> a bsdd:ClassificationProperty}
  <span style="color: #a0522d;">?x</span> bsdd:unit <span style="color: #8b2252;">"mm"</span>; bsdd:dimension <span style="color: #8b2252;">"2 0 3 0 0 0 0"</span>; bsdd:name <span style="color: #a0522d;">?name</span>; bsdd:code <span style="color: #a0522d;">?code</span>
}
</pre>
</div>
<p>
They all represent the property EF007220 "Busbar thickness"
</p>
</div>
</div>

<div id="outline-container-rules-about-missing-data" class="outline-4">
<h4 id="rules-about-missing-data"><span class="section-number-4">4.8.3.</span> Rules About Missing Data</h4>
<div class="outline-text-4" id="text-rules-about-missing-data">
<p>
bSDD should define rules how to express missing data.
It is ok to have no <code>physicalQuantity</code> for dimensionless properties (e.g. count, percentage) or enumerated properties (having a list of <code>allowedValues</code>).
But such missing data is expressed as various free texts:
</p>
<ul class="org-ul">
<li>Property "Caractrisation du sol" ("Soil characterization")
in class "Teneur en eau du sol" ("Soil water content")
has <code>physicalQuantity</code> "sans grandeur" ("without magnitude")
because it's a dimensionless quantity.</li>
<li>Property "Document de rfrence de mise en uvre d'un revtement de sol rsilient" ("Reference document for the implementation of a resilient floor covering")
in class "Revtement de sol rsilient PVC  queues d'aronde et type puzzle" ("PVC resilient floor covering with dovetails of type puzzle")
has <code>physicalQuantity</code> "Without"
because it's an enumeration.</li>
<li>There are 4 properties with <code>physicalQuantity</code> "N/A" but <code>unit</code> "m": this makes no sense (the quantity should be "Length")</li>
</ul>
<p>
It's better to omit <code>physicalQuantity</code> altogether, rather than use a variety of phrases to indicate NONE.
</p>
</div>
</div>

<div id="outline-container-unicode-problems" class="outline-4">
<h4 id="unicode-problems"><span class="section-number-4">4.8.4.</span> Unicode Problems</h4>
<div class="outline-text-4" id="text-unicode-problems">
<p>
There are Unicode problems in some <code>bsdd:description</code>.
</p>

<p>
E.g. in <a href="https://identifier.buildingsmart.org/uri/buildingsmart-de/bSDTLS-1/prop/02-02-01-010">https://identifier.buildingsmart.org/uri/buildingsmart-de/bSDTLS-1/prop/02-02-01-010</a> :
</p>

<pre class="example" id="org93f2120">
"Zeit der mglichen Verarbeitung vor Aushrtung in [min] bei +23C und 50% rel. Luftfeuchtigkeit
"
</pre>

<p>
(also has a trailing newline)
</p>
</div>
</div>

<div id="outline-container-unresolved-html-entities" class="outline-4">
<h4 id="unresolved-html-entities"><span class="section-number-4">4.8.5.</span> Unresolved HTML Entities</h4>
<div class="outline-text-4" id="text-unresolved-html-entities">
<p>
There are unresolved HTML entities (encoded chars).
</p>

<p>
E.g. in <a href="https://identifier.buildingsmart.org/uri/engisis/RFI-02/prop/S27300_0200">https://identifier.buildingsmart.org/uri/engisis/RFI-02/prop/S27300_0200</a>:
</p>

<pre class="example" id="orgfc3fc46">
"(*)
Pu&amp;#242; essere valorizzato un solo valore. SCIA = valorizzabile per le attivit&amp;#224; di tipo A o per le attivit&amp;#224; di tipo B o C nel caso in cui a seguito della valutazione favorevole del progetto si sia presentata la SCIA (ma non sia stato ancora rilasciato copia del verbale della visita tecnica dei VVF -attivit&amp;#224; di tipo A o B- o il CPI -attivit&amp;#224; ...".
</pre>
</div>
</div>

<div id="outline-container-bad-classification-relations" class="outline-4">
<h4 id="bad-classification-relations"><span class="section-number-4">4.8.6.</span> Bad Classification Relations</h4>
<div class="outline-text-4" id="text-bad-classification-relations">
<p>
Some classifications relate to to a full classification URL, but to
<code>https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/</code>, which is incomplete.
For example, this query at the original GraphQL endpoint:
</p>
<div class="org-src-container">
<pre class="src src-graphql">{
  domain(namespaceUri: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/BBRI/CCTB-2020"</span>) {
    classification(namespaceUri: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/BBRI/CCTB-2020/class/42.15"</span>) {
      relations {
        relatedClassificationName
        relatedClassificationUri
      }
    }
  }
}
</pre>
</div>
<p>
Returns the following:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"domain"</span>: {
  <span style="color: #8b2252;">"classification"</span>: {
    <span style="color: #8b2252;">"relations"</span>: [
      {
        <span style="color: #8b2252;">"relatedClassificationName"</span>: <span style="color: #008b8b;">null</span>,
        <span style="color: #8b2252;">"relatedClassificationUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/"</span>
      }
    ]
  }
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-implementing-improvements" class="outline-2">
<h2 id="implementing-improvements"><span class="section-number-2">5.</span> Implementing Improvements</h2>
<div class="outline-text-2" id="text-implementing-improvements">
<p>
We implemented a lot (but not all) of the improvements suggested above by using the following process:
</p>
<ul class="org-ul">
<li>Fetching bSDD data as JSON</li>
<li>Converting it to RDF using <a href="https://sparql-anything.cc/">SPARQL Anything</a></li>
<li>Loading it to <a href="https://www.ontotext.com/products/graphdb/">GraphDB</a></li>
<li>Refactoring the RDF using SPARQL Update</li>
</ul>
</div>

<div id="outline-container-converting-json-to-raw-rdf-using-sparql-anything" class="outline-3">
<h3 id="converting-json-to-raw-rdf-using-sparql-anything"><span class="section-number-3">5.1.</span> Converting JSON to Raw RDF using SPARQL Anything</h3>
<div class="outline-text-3" id="text-converting-json-to-raw-rdf-using-sparql-anything">
<p>
In the next step we convert the JSON files to RDF.
We used the <a href="https://sparql-anything.cc/">SPARQL Anything</a> tool (see <a href="https://sparql-anything.readthedocs.io/">documentation</a>) that can convert various data formats to RDF by using SPARQL queries.
</p>

<p>
We developed two scripts:
</p>
<ul class="org-ul">
<li><a href="./scripts/rdfize.sparql">rdfize.sparql</a> rdfizes one file. Parameter:
<ul class="org-ul">
<li><code>-v file</code>: file (local) or URL</li>
</ul></li>
<li><a href="./scripts/rdfize-zip.sparql">rdfize-zip.sparql</a> rdfizes an archive (zip) of files. Parameters:
<ul class="org-ul">
<li><code>-v zip</code>: zip filename or URL</li>
<li><code>-v file</code>: file regexp pattern (default <code>.*</code>)</li>
</ul></li>
</ul>

<p>
The scripts invoke like this:
</p>
<pre class="example">
java -jar sparql-anything.jar -q rdfize.sparql    -v file=bSDD/ifc-4.3/IfcCableSegmentCABLESEGMENT.json
java -jar sparql-anything.jar -q rdfize-zip.sparql -v zip=bSDD/ifc-4.3.zip -v file=IfcCableSegmentCABLESEGMENT.json
</pre>


<p>
We explain the more complex script (<code>rdfize-zip.sparql</code>) below:
</p>
<div class="org-src-container">
<pre class="src src-sparql"><span style="color: #a020f0;">prefix</span> bsdd: <span style="color: #008b8b;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span>
<span style="color: #a020f0;">prefix</span> xyz:  <span style="color: #008b8b;">&lt;http://sparql.xyz/facade-x/data/&gt;</span>
<span style="color: #a020f0;">prefix</span> fx:   <span style="color: #008b8b;">&lt;http://sparql.xyz/facade-x/ns/&gt;</span>
<span style="color: #a020f0;">prefix</span> rdf:  <span style="color: #008b8b;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span>
<span style="color: #a020f0;">prefix</span> rdfs: <span style="color: #008b8b;">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span>
<span style="color: #a020f0;">prefix</span> xsd:  <span style="color: #008b8b;">&lt;http://www.w3.org/2001/XMLSchema#&gt;</span>

<span style="color: #a020f0;">construct</span> {
  <span style="color: #a0522d;">?s</span> <span style="color: #a0522d;">?p</span> <span style="color: #a0522d;">?o</span>
} <span style="color: #a020f0;">where</span> {
  <span style="color: #a020f0;">service</span> <span style="color: #008b8b;">&lt;x-sparql-anything:&gt;</span> {
    <span style="color: #a020f0;">bind</span>(coalesce(<span style="color: #a0522d;">?__file</span>,<span style="color: #8b2252;">".*"</span>) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?pattern</span>)
    fx:properties fx:location <span style="color: #a0522d;">?_zip</span>.
    fx:properties fx:archive.matches <span style="color: #a0522d;">?pattern</span>.
    [] fx:anySlot <span style="color: #a0522d;">?file</span>
    <span style="color: #a020f0;">service</span> <span style="color: #008b8b;">&lt;x-sparql-anything:media-type=application/json&gt;</span> {
      <span style="color: #a020f0;">bind</span>(str(bsdd:) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">?bsdd</span>)
      fx:properties fx:namespace <span style="color: #a0522d;">?bsdd</span>.
      fx:properties fx:location <span style="color: #a0522d;">?file</span>.
      fx:properties fx:<span style="color: #a020f0;">from</span>-archive <span style="color: #a0522d;">?_zip</span>.
      fx:properties fx:use-rdfs-member true.
      <span style="color: #a0522d;">?s</span> <span style="color: #a0522d;">?p</span> <span style="color: #a0522d;">?o</span>
    }
  }
}
</pre>
</div>

<p>
We use the simplest case of SPARQL Anything to convert JSON to RDF:
</p>
<pre class="example">
construct {?s ?p ?o} where {?s ?p ?o}
</pre>

<ul class="org-ul">
<li>The Raw RDF has a similar form to the JSON, see next section</li>
<li>It is possible to write more complex queries to drill down into the RDF structure, but we preferred to refactor RDF using SPARQL Update, see the section after next</li>
<li>SPARQL Anything uses the prefix <code>fx:</code> for its features and functions.</li>
<li>We define the <code>bsdd:</code> ontology namespace the same as the existing bSDD RDF data.</li>
<li>SPARQL Anything uses the prefix <code>xyz:</code> to emit the output data.
However, we use <code>fx:properties fx:namespace</code> to cast the data to the <code>bsdd:</code> namespace, so we don't use the <code>xyz:</code> prefix.
The argument of this parameter is a string, so we use <code>bind(str(bsdd:) as ?bsdd)</code> to convert the respective namespace URL to a string</li>
<li>We use the option <code>fx:properties fx:use-rdfs-member true</code> to emit JSON array members as multiple values of <code>rdfs:member</code> rather than the predicates <code>rdf:_1, rdf:_2 ...</code></li>
</ul>

<p>
All other lines of the script take care of handling input.
</p>
<ul class="org-ul">
<li>We use command-line parameters to pass (<a href="https://sparql-anything.readthedocs.io/en/latest/#query-templates-and-variable-bindings-cli-only">variable bindings to the SPARQL Anything CLI)</a>.
It uses the <a href="https://github.com/basilapi/basil/wiki/SPARQL-variable-name-convention-for-WEB-API-parameters-mapping">BASIL convention for variable names in queries</a>:
<code>?_zip</code> is a mandatory param, and <code>?__file</code> is an optional param</li>
<li>The outer <code>service</code> invocation opens the zip archive:
<ul class="org-ul">
<li>Provides a default value for <code>?__file</code> by using <code>coalesce</code></li>
<li>Opens the <code>?_zip</code> archive using <code>fx:location</code></li>
<li>Uses <code>fx:archive.matches</code> to find all filenames that match <code>?pattern</code></li>
<li>The result is a list that we parse out by using <code>fx:anySlot</code> and feed it as multiple bindings to the variable <code>?file</code></li>
</ul></li>
<li>The inner <code>service</code> invocation opens the respective files from the zip archive:
<ul class="org-ul">
<li>Now we set <code>fx:location</code> to the filename found in the archive</li>
<li>And we use <a href="https://sparql-anything.readthedocs.io/en/latest/Configuration/#from-archive">fx:from-archive</a> to open the archive again, and to read the file</li>
</ul></li>
</ul>
</div>

<div id="outline-container-raw-json-example" class="outline-4">
<h4 id="raw-json-example"><span class="section-number-4">5.1.1.</span> Raw JSON Example</h4>
<div class="outline-text-4" id="text-raw-json-example">
<p>
An example classification in JSON obtained with the following command:
</p>
<div class="org-src-container">
<pre class="src src-sh">curl -s https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment | jq . &gt; class-IfcCableSegment-orig1.json
</pre>
</div>

<p>
Shortened for brevity:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"referenceCode"</span>: <span style="color: #8b2252;">"IfcCableSegment"</span>,
  <span style="color: #8b2252;">"parentClassificationReference"</span>: {
    <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcFlowSegment"</span>,
    <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcFlowSegment"</span>,
    <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"IfcFlowSegment"</span>
  },
  <span style="color: #8b2252;">"classificationProperties"</span>: [
    {
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span>,
      <span style="color: #8b2252;">"description"</span>: <span style="color: #8b2252;">"Special installation conditions relating to particular types of installation based on IEC60364-5-52:2001 reference installation methods C and D."</span>,
      <span style="color: #8b2252;">"dataType"</span>: <span style="color: #8b2252;">"String"</span>,
      <span style="color: #8b2252;">"possibleValues"</span>: [
        {
          <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"BELOWCEILING"</span>,
          <span style="color: #8b2252;">"value"</span>: <span style="color: #8b2252;">"BELOWCEILING"</span>
        }
      ],
      <span style="color: #8b2252;">"propertyCode"</span>: <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span>,
      <span style="color: #8b2252;">"propertyDomainName"</span>: <span style="color: #8b2252;">"IFC"</span>,
      <span style="color: #8b2252;">"propertyNamespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/InstallationMethodFlagEnum"</span>,
      <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_CableSegmentOccurrence"</span>,
      <span style="color: #8b2252;">"propertyStatus"</span>: <span style="color: #8b2252;">"Active"</span>,
      <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"Single"</span>
    },
  ],
  <span style="color: #8b2252;">"domainNamespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3"</span>,
  <span style="color: #8b2252;">"activationDateUtc"</span>: <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>,
  <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"IfcCableSegment"</span>,
  <span style="color: #8b2252;">"countriesOfUse"</span>: [],
  <span style="color: #8b2252;">"definition"</span>: <span style="color: #8b2252;">"A cable segment is a flow segment used to carry electrical power, data, or telecommunications signals..."</span>,
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcCableSegment"</span>,
  <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment"</span>,
  <span style="color: #8b2252;">"replacedObjectCodes"</span>: [],
  <span style="color: #8b2252;">"replacingObjectCodes"</span>: [],
  <span style="color: #8b2252;">"status"</span>: <span style="color: #8b2252;">"Preview"</span>,
  <span style="color: #8b2252;">"subdivisionsOfUse"</span>: [],
  <span style="color: #8b2252;">"versionDateUtc"</span>: <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>
}
</pre>
</div>

<p>
The JSON representation obtained from the GraphQL API is very similar but not identical:
</p>
<ul class="org-ul">
<li>We include <code>__typename</code> for each node to help assigning <code>rdf:type</code> later</li>
<li>All fields are present, even when they are <code>null</code></li>
<li>GraphQL fields are sometimes named differently (e.g. <code>properties</code> instead of <code>classificationProperties</code>)</li>
<li>There are some other differences, e.g. see <code>class-IfcCableSegment-orig.json</code> (shortened for brevity):</li>
</ul>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment"</span>,
  <span style="color: #8b2252;">"__typename"</span>: <span style="color: #8b2252;">"Classification"</span>,
  <span style="color: #8b2252;">"classificationType"</span>: <span style="color: #8b2252;">"CLASS"</span>,
  <span style="color: #8b2252;">"relatedIfcEntityNames"</span>: [],
  <span style="color: #8b2252;">"synonyms"</span>: [],
  <span style="color: #8b2252;">"referenceCode"</span>: <span style="color: #8b2252;">"IfcCableSegment"</span>,
  <span style="color: #8b2252;">"properties"</span>: [
    {
      <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/InstallationMethodFlagEnum"</span>,
      <span style="color: #8b2252;">"__typename"</span>: <span style="color: #8b2252;">"ClassificationProperty"</span>,
      <span style="color: #8b2252;">"allowedValues"</span>: [
        {
          <span style="color: #8b2252;">"namespaceUri"</span>: <span style="color: #008b8b;">null</span>,
          <span style="color: #8b2252;">"__typename"</span>: <span style="color: #8b2252;">"ClassificationPropertyValue"</span>,
          <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"BELOWCEILING"</span>,
          <span style="color: #8b2252;">"description"</span>: <span style="color: #008b8b;">null</span>,
          <span style="color: #8b2252;">"value"</span>: <span style="color: #8b2252;">"BELOWCEILING"</span>,
          <span style="color: #8b2252;">"sortNumber"</span>: <span style="color: #008b8b;">null</span>
        },
      ],
      <span style="color: #8b2252;">"dataType"</span>: <span style="color: #8b2252;">"String"</span>,
      <span style="color: #8b2252;">"description"</span>: <span style="color: #8b2252;">"Special installation conditions relating to particular types of installation based on IEC60364-5-52:2001 reference installation methods C and D."</span>,
      <span style="color: #8b2252;">"dimension"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dimensionLength"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dimensionMass"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dimensionTime"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dimensionElectricCurrent"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dimensionThermodynamicTemperature"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dimensionAmountOfSubstance"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dimensionLuminousIntensity"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"dynamicParameterPropertyCodes"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"example"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"isDynamic"</span>: <span style="color: #008b8b;">false</span>,
      <span style="color: #8b2252;">"isRequired"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"isWritable"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"maxExclusive"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"maxInclusive"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"methodOfMeasurement"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"minExclusive"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"minInclusive"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"pattern"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"physicalQuantity"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"predefinedValue"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_CableSegmentOccurrence"</span>,
      <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
      <span style="color: #8b2252;">"symbol"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"units"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"activationDateUtc"</span>: <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>,
      <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span>,
      <span style="color: #8b2252;">"creatorLanguageCode"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"countriesOfUse"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"countryOfOrigin"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"deActivationDateUtc"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"definition"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"deprecationExplanation"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"documentReference"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span>,
      <span style="color: #8b2252;">"replacedObjectCodes"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"replacingObjectCodes"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"revisionDateUtc"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"revisionNumber"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"status"</span>: <span style="color: #8b2252;">"Active"</span>,
      <span style="color: #8b2252;">"subdivisionsOfUse"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"uid"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"versionDateUtc"</span>: <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>,
      <span style="color: #8b2252;">"versionNumber"</span>: <span style="color: #008b8b;">null</span>,
      <span style="color: #8b2252;">"visualRepresentationUri"</span>: <span style="color: #008b8b;">null</span>
    },
  ],
  <span style="color: #8b2252;">"relations"</span>: [],
  <span style="color: #8b2252;">"childs"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"activationDateUtc"</span>: <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>,
  <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"IfcCableSegment"</span>,
  <span style="color: #8b2252;">"creatorLanguageCode"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"countriesOfUse"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"countryOfOrigin"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"deActivationDateUtc"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"definition"</span>: <span style="color: #8b2252;">"A cable segment is a flow segment used to carry electrical power, data, or telecommunications signals..."</span>,
  <span style="color: #8b2252;">"deprecationExplanation"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"documentReference"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcCableSegment"</span>,
  <span style="color: #8b2252;">"replacedObjectCodes"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"replacingObjectCodes"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"revisionDateUtc"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"revisionNumber"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"status"</span>: <span style="color: #8b2252;">"Preview"</span>,
  <span style="color: #8b2252;">"subdivisionsOfUse"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"uid"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"versionDateUtc"</span>: <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>,
  <span style="color: #8b2252;">"versionNumber"</span>: <span style="color: #008b8b;">null</span>,
  <span style="color: #8b2252;">"visualRepresentationUri"</span>: <span style="color: #008b8b;">null</span>
}

</pre>
</div>
</div>
</div>

<div id="outline-container-raw-rdf-example" class="outline-4">
<h4 id="raw-rdf-example"><span class="section-number-4">5.1.2.</span> Raw RDF Example</h4>
<div class="outline-text-4" id="text-raw-rdf-example">
<p>
The example GraphQL JSON is converted to the following "raw" RDF (shortened for brevity).
Its structure is very similar to the original one, with empty blank nodes in various places, strings instead of URLs, etc.
</p>

<div class="org-src-container">
<pre class="src src-turtle"><span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">fx:</span><span style="color: #008b8b;"> </span>  <span style="color: #0000ff;">&lt;http://sparql.xyz/facade-x/ns/&gt;</span> .
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;"> </span> <span style="color: #0000ff;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">rdfs:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">xsd:</span><span style="color: #008b8b;"> </span> <span style="color: #0000ff;">&lt;http://www.w3.org/2001/XMLSchema#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">xyz:</span><span style="color: #008b8b;"> </span> <span style="color: #0000ff;">&lt;http://sparql.xyz/facade-x/data/&gt;</span> .

[ <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;">type</span>                   <span style="color: #228b22;">fx:</span><span style="color: #008b8b;">root</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">__typename</span>            <span style="color: #8b2252;">"Classification"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">activationDateUtc</span>     <span style="color: #8b2252;">"2022-12-31T00:00:00"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">classificationType</span>    <span style="color: #8b2252;">"CLASS"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">code</span>                  <span style="color: #8b2252;">"IfcCableSegment"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">definition</span>            <span style="color: #8b2252;">"A cable segment is a flow segment used to carry electrical power, data, or telecommunications signals..."</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">name</span>                  <span style="color: #8b2252;">"IfcCableSegment"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">namespaceUri</span>          <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">properties</span> [
    <span style="color: #228b22;">rdfs:</span><span style="color: #008b8b;">member</span>  [
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">__typename</span>          <span style="color: #8b2252;">"ClassificationProperty"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">activationDateUtc</span>   <span style="color: #8b2252;">"2022-12-31T00:00:00"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">allowedValues</span> [
      <span style="color: #228b22;">rdfs:</span><span style="color: #008b8b;">member</span>  [
      <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">__typename</span>        <span style="color: #8b2252;">"ClassificationPropertyValue"</span> ;
      <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">code</span>              <span style="color: #8b2252;">"BELOWCEILING"</span> ;
      <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">value</span>             <span style="color: #8b2252;">"BELOWCEILING"</span>
    ]] ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">code</span>                <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">dataType</span>            <span style="color: #8b2252;">"String"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">description</span>         <span style="color: #8b2252;">"Special installation conditions relating to particular types of installation based on IEC60364-5-52:2001 reference installation methods C and D."</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">isDynamic</span>           false ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">name</span>                <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">namespaceUri</span>        <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/InstallationMethodFlagEnum"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">propertySet</span>         <span style="color: #8b2252;">"Pset_CableSegmentOccurrence"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">propertyValueKind</span>   <span style="color: #8b2252;">"SINGLE"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">status</span>              <span style="color: #8b2252;">"Active"</span> ;
    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">versionDateUtc</span>      <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>
  ]] ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">referenceCode</span>         <span style="color: #8b2252;">"IfcCableSegment"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">relatedIfcEntityNames</span> []  ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">relations</span>             []  ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">status</span>                <span style="color: #8b2252;">"Preview"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">synonyms</span>              []  ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">versionDateUtc</span>        <span style="color: #8b2252;">"2022-12-31T00:00:00"</span>
] .
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-refactoring-rdf-using-sparql-update" class="outline-3">
<h3 id="refactoring-rdf-using-sparql-update"><span class="section-number-3">5.2.</span> Refactoring RDF using SPARQL Update</h3>
<div class="outline-text-3" id="text-refactoring-rdf-using-sparql-update">
<p>
There are various things to fix in the Raw RDF.
We wrote the SPARQL Update script <a href="./scripts/transform.ru">transform.ru</a> (<code>.ru</code> is teh W3C standard extension for this type of file).
It does the following:
</p>
<ul class="org-ul">
<li>Cut out fractional seconds from date-times, and add datatype <code>xsd:dateTime</code>
<ul class="org-ul">
<li>This pertains to <code>activationDateUtc deActivationDateUtc lastUpdatedUtc revisionDateUtc versionDateUtc</code></li>
<li><code>lastUpdatedUtc</code> has overly-specific timestamps to the precision of 10e-7 seconds, eg <code>2022-12-21T08:24:16.8080608</code>.
We cut out the fractional seconds because the GraphQL scalar type <code>DateTime</code> as currently implemented in the Ontotext Platform doesn't support such precision (nor do we see any business need for it in bSDD),</li>
<li>However, XSD allows any number of digits in the <a href="https://www.w3.org/TR/xmlschema11-2/#nt-seFrag">decimal part of seconds</a>, so we have posted an enhancement request <a href="https://ontotext.atlassian.net/browse/PLATFORM-4728">(PLATFORM-4728)</a> to allow this.</li>
</ul></li>
<li>Convert strings to URIs, and shorten props as appropriate
<ul class="org-ul">
<li>This pertains to all props called <code>*Uri</code>, and the following are shortened:</li>
</ul></li>
</ul>

<table border="1" cellspacing="0" cellpadding="2" rules="all" frame="box">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">full</th>
<th scope="col" class="org-left">short</th>
<th scope="col" class="org-left">comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bsdd:domainNamespaceUri</td>
<td class="org-left">bsdd:domain</td>
<td class="org-left">We point to the <code>Domain</code> not to its URI</td>
</tr>

<tr>
<td class="org-left">bsdd:relatedClassificationUri</td>
<td class="org-left">bsdd:related</td>
<td class="org-left">We use the pair <code>relation/related</code> for both <code>PropertyRelation, ClassificationRelation</code></td>
</tr>

<tr>
<td class="org-left">bsdd:relatedPropertyUri</td>
<td class="org-left">bsdd:related</td>
<td class="org-left">We use the pair <code>relation/related</code> for both <code>PropertyRelation, ClassificationRelation</code></td>
</tr>

<tr>
<td class="org-left">bsdd:parentClassificationReference</td>
<td class="org-left">bsdd:parentClassification</td>
<td class="org-left">We point to the parent <code>Classification</code>, so "reference" is parasitic</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>Drop redundant information of a referenced resource
<ul class="org-ul">
<li>e.g. inside <code>parentClassificationReference</code>, the properties <code>code, name</code> are dropped because they are defined in the master record of that classification, thus are redundant in the reference;</li>
</ul></li>
<li>Drop deprecated property <code>bsdd:possibleValues</code>, since <code>bsdd:allowedValue</code> is used instead;</li>
<li>Multi-valued properties: skip a level (<code>rdfs:member</code>) and change property name to singular:
<ul class="org-ul">
<li><code>bsdd:objects [rdfs:member [...], [...]]</code> becomes <code>bsdd:object [...], [...]</code>;</li>
<li>Empty lists like <code>bsdd:replacedObjectCodes []</code> above disappear altogether since that blank node representing the empty list is useless;</li>
</ul></li>
<li>Short-cut the property path <code>bsdd:parentClassificationReference/bsdd:namespaceUri</code> to just <code>bsdd:parentClassification</code>;</li>
<li>Add <code>rdf:type</code> based on GraphQL <code>__typename</code>;
<ul class="org-ul">
<li>e.g. <code>"__typename": "Domain"</code> becomes <code>rdf:type bsdd:Domain</code>;</li>
<li>However, <code>"__typename": "ClassificationPropertyValue"</code> becomes <code>rdf:type bsdd:PropertyValue</code>;
because the GraphQL class <code>ClassificationPropertyValue</code> is exactly the same as <code>PropertyValue</code>;</li>
</ul></li>
<li>Drop parasitic <code>rdf:type fx:root</code>;</li>
<li>Rename <code>ClassificationProperty.namespaceUri</code> to <code>ClassificationProperty.property</code> because that link refers to a <code>Property</code> specifically;</li>
<li>Add meaningful URIs to blank nodes whenever possible. In particular:
<ul class="org-ul">
<li><code>ClassificationProperty</code> gets URI: <code>Classification.uri+"/"+propertyCode</code> (here <code>+</code> indicates concatenation);</li>
<li><code>ClassificationPropertyValue</code> gets URI: <code>Classification.uri+"/"+ClassificationProperty.propertyCode +"/"+value</code>.
This class has <code>namespaceUri</code>, but that is optional and is rarely filled;</li>
<li><code>PropertyValue</code> gets URI: <code>Classification.uri+"/"+Property.propertyCode +"/"+value</code>.
This class has <code>namespaceUri</code>, but that is optional and is rarely filled.</li>
</ul></li>
<li>The following remain blank nodes:
<ul class="org-ul">
<li><code>ReferenceDocument</code>: no id field (only <code>name, title, date</code>);</li>
<li><code>ClassificationRelation</code>: is just a pair of <code>related</code> Properties, no own URI;</li>
<li><code>PropertyRelation</code>: is just a pair of <code>related</code> Properties, no own URI;</li>
</ul></li>
<li>Remove redundant <code>namespaceUri</code> when equal to the node's URI.</li>
</ul>

<p>
This SPARQL Update script is class-independent (works on any Raw bSDD RDF), so it can be used in two ways:
</p>
<ul class="org-ul">
<li>On an individual RDF file by using Jena's <code>update</code>, for testing</li>
<li>After loading all data to <a href="https://www.ontotext.com/products/graphdb/">GraphDB</a>, to transform all of it in one go</li>
</ul>
</div>

<div id="outline-container-original-rdf-example" class="outline-4">
<h4 id="original-rdf-example"><span class="section-number-4">5.2.1.</span> Original RDF Example</h4>
<div class="outline-text-4" id="text-original-rdf-example">
<p>
Now let's take a look at the original bSDD RDF <code>class-IfcCableSegment-orig.ttl</code> obtained with the following (shortened for brevity):
</p>
<pre class="example">
curl -s -Haccept:text/turtle https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment &gt; class-IfcCableSegment-orig.ttl
</pre>

<div class="org-src-container">
<pre class="src src-turtle">@base <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment&gt;</span>.

<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span><span style="color: #b22222;">.</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">rdfs:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span><span style="color: #b22222;">.</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">xsd:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://www.w3.org/2001/XMLSchema#&gt;</span><span style="color: #b22222;">.</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span><span style="color: #b22222;">.</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">qudtUnit:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://qudt.org/vocab/unit/&gt;</span>.
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">ifc4_3:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3&gt;</span><span style="color: #228b22;">.</span>

<span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment&gt;</span>
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ActivationDateUtc</span> <span style="color: #8b2252;">"2022-12-31"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Code</span> <span style="color: #8b2252;">"IfcCableSegment"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Definition</span> <span style="color: #8b2252;">"A cable segment is a flow segment used to carry electrical power, data, or telecommunications signals..."</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Domain</span> <span style="color: #228b22;">ifc4_3:</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Name</span> <span style="color: #8b2252;">"IfcCableSegment"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ReferenceCode</span> <span style="color: #8b2252;">"IfcCableSegment"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Status</span> <span style="color: #8b2252;">"Preview"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">VersionDateUtc</span> <span style="color: #8b2252;">"2022-12-31"</span>;
  <span style="color: #a020f0;">a</span> <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Classification</span><span style="color: #228b22;">.</span>

<span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment/InstallationMethodFlagEnum&gt;</span>
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ClassificationProperty</span> <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment&gt;</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">DataType</span> <span style="color: #8b2252;">"String"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Description</span> <span style="color: #8b2252;">"Special installation conditions relating to particular types of installation based on IEC60364-5-52:2001 reference installation methods C and D."</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Name</span> <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyCode</span> <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyDomainName</span> <span style="color: #8b2252;">"IFC"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyNamespaceUri</span> <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/InstallationMethodFlagEnum"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertySet</span> <span style="color: #8b2252;">"Pset_CableSegmentOccurrence"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyStatus</span> <span style="color: #8b2252;">"Active"</span>;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyValueKind</span> <span style="color: #8b2252;">"Single"</span>.
</pre>
</div>
<p>
It has numerous problems:
</p>
<ul class="org-ul">
<li>RDF naming conventions are not followed (prop names are in uppercase)</li>
<li>Classification Properties don't have <code>rdf:type bsdd:ClassificationProperty</code></li>
<li>The relation from Classification Property to Classification is in the wrong direction
(or should be renamed from <code>bsdd:ClassificationProperty</code> to <code>bsdd:classification</code>)</li>
<li><code>bsdd:PropertyNamespaceUri</code> should be a URL (object property) instead of string (datatype property)
and should be called <code>bsdd:property</code></li>
<li>Dates (eg <code>"2022-12-31"</code>) are rendered differently from JSON (have no timestamp), and lack appropriate datatype</li>
<li><code>allowedValues</code> and the respective <code>ClassificationPropertyValue</code> are missing altogether</li>
</ul>
</div>
</div>

<div id="outline-container-refactored-rdf-example" class="outline-4">
<h4 id="refactored-rdf-example"><span class="section-number-4">5.2.2.</span> Refactored RDF Example</h4>
<div class="outline-text-4" id="text-refactored-rdf-example">
<p>
After applying the refactoring transformation, we get the following refactored RDF <code>class-IfcCableSegment-refact.ttl</code> (shortened for brevity).
Compare it to both the original RDF (sec <a href="#original-rdf-example">5.2.1</a>) and the raw RDF (sec <a href="#raw-rdf-example">5.1.2</a>):
</p>
<div class="org-src-container">
<pre class="src src-turtle"><span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://bsdd.buildingsmart.org/def#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">fx:</span><span style="color: #008b8b;"> </span>  <span style="color: #0000ff;">&lt;http://sparql.xyz/facade-x/ns/&gt;</span> .
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;"> </span> <span style="color: #0000ff;">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">rdfs:</span><span style="color: #008b8b;"> </span><span style="color: #0000ff;">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">xsd:</span><span style="color: #008b8b;"> </span> <span style="color: #0000ff;">&lt;http://www.w3.org/2001/XMLSchema#&gt;</span><span style="color: #b22222;"> .</span>
<span style="color: #a020f0;">@prefix</span> <span style="color: #228b22;">xyz:</span><span style="color: #008b8b;"> </span> <span style="color: #0000ff;">&lt;http://sparql.xyz/facade-x/data/&gt;</span> <span style="color: #228b22;">.</span>

<span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment&gt;</span>
  <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;">type</span>                     <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">Classification</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">activationDateUtc</span>       <span style="color: #8b2252;">"2022-12-31T00:00:00"</span><span style="color: #008b8b;">^^xsd:dateTime</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">classificationProperty</span>  <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment/InstallationMethodFlagEnum&gt;</span>, ... ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">classificationType</span>      <span style="color: #8b2252;">"CLASS"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">code</span>                    <span style="color: #8b2252;">"IfcCableSegment"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">definition</span>              <span style="color: #8b2252;">"A cable segment is a flow segment used to carry electrical power, data, or telecommunications signals..."</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">name</span>                    <span style="color: #8b2252;">"IfcCableSegment"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">referenceCode</span>           <span style="color: #8b2252;">"IfcCableSegment"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">status</span>                  <span style="color: #8b2252;">"Preview"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">versionDateUtc</span>          <span style="color: #8b2252;">"2022-12-31T00:00:00"</span><span style="color: #008b8b;">^^xsd:dateTime</span> <span style="color: #228b22;">.</span>

<span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment/InstallationMethodFlagEnum&gt;</span>
  <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;">type</span>                <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">ClassificationProperty</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">activationDateUtc</span>  <span style="color: #8b2252;">"2022-12-31T00:00:00"</span><span style="color: #008b8b;">^^xsd:dateTime</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">allowedValue</span>       <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment/InstallationMethodFlagEnum/BELOWCEILING&gt;</span> , ... ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">code</span>               <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">dataType</span>           <span style="color: #8b2252;">"String"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">description</span>        <span style="color: #8b2252;">"Special installation conditions relating to particular types of installation based on IEC60364-5-52:2001 reference installation methods C and D."</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">isDynamic</span>          false ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">name</span>               <span style="color: #8b2252;">"InstallationMethodFlagEnum"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">property</span>           <span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/prop/InstallationMethodFlagEnum&gt;</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">propertySet</span>        <span style="color: #8b2252;">"Pset_CableSegmentOccurrence"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">propertyValueKind</span>  <span style="color: #8b2252;">"SINGLE"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">status</span>             <span style="color: #8b2252;">"Active"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">versionDateUtc</span>     <span style="color: #8b2252;">"2022-12-31T00:00:00"</span><span style="color: #008b8b;">^^xsd:dateTime</span> <span style="color: #228b22;">.</span>

<span style="color: #0000ff;">&lt;https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCableSegment/InstallationMethodFlagEnum/BELOWCEILING&gt;</span>
  <span style="color: #228b22;">rdf:</span><span style="color: #008b8b;">type</span>    <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">PropertyValue</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">code</span>   <span style="color: #8b2252;">"BELOWCEILING"</span> ;
  <span style="color: #228b22;">bsdd:</span><span style="color: #008b8b;">value</span>  <span style="color: #8b2252;">"BELOWCEILING"</span> .
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-graphql-to-soml-and-back" class="outline-3">
<h3 id="graphql-to-soml-and-back"><span class="section-number-3">5.3.</span> GraphQL to SOML and Back</h3>
<div class="outline-text-3" id="text-graphql-to-soml-and-back">
<p>
The major goal of this work is to improve the bSDD RDF representation and GraphQL API.
To achieve this, in addition to refactoring RDF:
</p>
<ul class="org-ul">
<li>The original GraphQL schema was fetched with GraphQL introspection: <code>bsdd-graphql-schema-orig.json</code>, 116kb</li>
<li>Then it was converted to a prototypical <a href="https://platform.ontotext.com/semantic-objects/soml/index.html">SOML schema</a> using the script <code>graphql2soml.py</code>: <code>bsdd-graphql-soml-orig.yaml</code>, 22kb.
As you can see from the size, SOML is much easier to understand and edit than a GraphQL schema as JSON DML.
This SOML schema has issues inherited from the original GraphQL schema.
The purpose of the generated SOML schema is to serve as a starting point (instead of starting from scratch)</li>
<li>The schema was refactored by hand, using similar steps as the RDF refactoring above: <code>bsdd-graphql-soml-refact.yaml</code>, 20kb.</li>
<li>That was loaded to <a href="https://platform.ontotext.com/semantic-objects/">Ontotext Platform Semantic Objects</a> to generate a refactored GraphQL schema: <code>bsdd-graphql-schema-refact.json</code>, 867k.
The reason it is so much bigger is that it includes a comprehensive <code>where</code> query language</li>
</ul>

<p>
The difference between the two SOML schemas is not so huge:
</p>
<div class="org-src-container">
<pre class="src src-sh">diff -wu1000 bsdd-graphql-soml-orig.yaml bsdd-graphql-soml-refact.yaml &gt; bsdd-graphql-soml.patch
</pre>
</div>


<div id="orge29dd41" class="figure">
<p><img src="./img/bsdd-graphql-soml-diff.png" alt="bsdd-graphql-soml-diff.png" />
</p>
<p><span class="figure-number">Figure 10: </span>Typical differences between the Original GraphQL schema (red) and the Refactored schema (green)</p>
</div>

<p>
We explain the differences seen in this figure:
</p>
<ul class="org-ul">
<li>Field names in plural are changed to singular because the field cardinality (<code>max</code>) already specifies whether it's single-valued or multi-valued</li>
<li>Field names are changed to reflect the target class.
E.g. <code>Classification.properties</code> is renamed to <code>Classification.classificationProperty</code> because it points to <code>ClassificationProperty</code></li>
<li>Parallel links (e.g. <code>property, properties</code>) are eliminated because
the same relation field (e.g. <code>classificationProperty</code>) can be used to fetch all or a single target entity, by URL (<code>ID</code>) or by search.</li>
<li><code>childClassification</code> in the refactored schema is always available,
unlike <code>childs</code> in the original schema that's available only if the current Classification was fetched with <code>includeChilds: true</code>.
Please note that such "hidden dependencies" violate the GraphQL typing specification.</li>
<li>Bidirectional navigation was added by using so-called "virtual inverses (<code>inverseAlias</code>)
(e.g. <code>parentClassification</code> can be used, even though there is no such relation recorded in the RDF repository).</li>
</ul>
</div>
</div>

<div id="outline-container-sample-queries" class="outline-3">
<h3 id="sample-queries"><span class="section-number-3">5.4.</span> Sample Queries</h3>
<div class="outline-text-3" id="text-sample-queries">
<p>
A number of SPARQL queries over refactored RDF data are shown in the sections above, because we used them for statistics.
In this section we show some sample GraphQL queries over the refactored endpoint, emphasizing searchability.
They are also saved in folder <code>graphql-refact</code>.
</p>
</div>

<div id="outline-container-domains-with-lang-en-and-their-classifications" class="outline-4">
<h4 id="domains-with-lang-en-and-their-classifications"><span class="section-number-4">5.4.1.</span> Domains with lang=EN and their Classifications</h4>
<div class="outline-text-4" id="text-domains-with-lang-en-and-their-classifications">
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">domainEn_Class</span> {
  domain(where: {languageCode: {EQ: <span style="color: #8b2252;">"EN"</span>}}) {
    name
    classification {
      id
      classificationType
      name
    }
  }
}
</pre>
</div>
<p>
This returns thousands of classifications in under 0.2s, e.g.:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"domain"</span>: [
  {
    <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/alma/hprops-1.0"</span>,
    <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"h props"</span>,
    <span style="color: #8b2252;">"classification"</span>: [
      {
        <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/alma/hprops-1.0/class/New_class_8_copy_10"</span>,
        <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"New classification 8"</span>
      },
</pre>
</div>
</div>
</div>

<div id="outline-container-classificationproperties-in-ifc-class-ifcwall" class="outline-4">
<h4 id="classificationproperties-in-ifc-class-ifcwall"><span class="section-number-4">5.4.2.</span> ClassificationProperties in IFC class IfcWall</h4>
<div class="outline-text-4" id="text-classificationproperties-in-ifc-class-ifcwall">
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">DomainIFC_ClassWall_Props</span> {
  domain(ID:<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3"</span>) {
    classification(ID:<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcWall"</span>) {
      name
      classificationProperty {
        name
        propertyValueKind
        propertySet
      }
    }
  }
}
</pre>
</div>
<p>
This returns some errors about <code>propertySet</code> which is declared as single-valued, but sometimes happens to be multi-valued:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"errors"</span>: [
  {
    <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"Found 2 values for single-valued field 'propertySet' from 'ClassificationProperty'"</span>,
    <span style="color: #8b2252;">"path"</span>: [
      <span style="color: #8b2252;">"domain"</span>,
      0,
      <span style="color: #8b2252;">"classification"</span>,
      0,
      <span style="color: #8b2252;">"classificationProperty"</span>,
      24,
      <span style="color: #8b2252;">"propertySet"</span>
    ],
    <span style="color: #8b2252;">"locations"</span>: [
      {
        <span style="color: #8b2252;">"line"</span>: 9,
        <span style="color: #8b2252;">"column"</span>: 9
      }
    ]
  },
</pre>
</div>

<p>
It then returns the requested data:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"domain"</span>: [
    {
      <span style="color: #8b2252;">"classification"</span>: [
        {
          <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcWall"</span>,
          <span style="color: #8b2252;">"classificationProperty"</span>: [
            {
              <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"GrossFootPrintArea"</span>,
              <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
              <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Qto_WallBaseQuantities"</span>
            },
            {
              <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"ManufacturingToleranceClass"</span>,
              <span style="color: #8b2252;">"propertyValueKind"</span>: <span style="color: #8b2252;">"SINGLE"</span>,
              <span style="color: #8b2252;">"propertySet"</span>: <span style="color: #8b2252;">"Pset_PrecastConcreteElementGeneral"</span>
            },
</pre>
</div>
</div>
</div>

<div id="outline-container-classifications-of-type-composed-property-and-their-constituent-properties" class="outline-4">
<h4 id="classifications-of-type-composed-property-and-their-constituent-properties"><span class="section-number-4">5.4.3.</span> Classifications of Type COMPOSED_PROPERTY and their Constituent Properties</h4>
<div class="outline-text-4" id="text-classifications-of-type-composed-property-and-their-constituent-properties">
<p>
Composed Properties are groups of thematically related properties.
They are expressed as a specific <code>classificationType</code> COMPOSED_PROPERTY.
Here you can see how we search for this enumerated value:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">Prop_composed</span> {
  classification(where:{classificationType:{EQ:COMPOSED_PROPERTY}}) {
    code name
    domain {name}
    classificationProperty {code name}
  }
}
</pre>
</div>
<p>
Part of the result:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"150822129"</span>,
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Stepped cap beam dimensions"</span>,
  <span style="color: #8b2252;">"domain"</span>: {
    <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"MINnD Bridge dictionary"</span>
  },
  <span style="color: #8b2252;">"classificationProperty"</span>: [
    {
      <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"PR2054415455"</span>,
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Elevation of bottom of step"</span>
    },
    {
      <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"PR445726735"</span>,
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Elevation of top of step"</span>
    },
    {
      <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"PR1543732693"</span>,
      <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"step depth"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-properties-that-have-connected-properties" class="outline-4">
<h4 id="properties-that-have-connected-properties"><span class="section-number-4">5.4.4.</span> Properties that Have Connected Properties</h4>
<div class="outline-text-4" id="text-properties-that-have-connected-properties">
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">Prop_connected</span> {
  property(where: {connectedPropertyCode:{}}) {
    id
    code
    connectedPropertyCode
  }
}
</pre>
</div>
<p>
Part of the result:
</p>
<div class="org-src-container">
<pre class="src src-json">{
   <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/bs-agri/fruitvegs-1.1/prop/volume"</span>,
   <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"volume"</span>,
   <span style="color: #8b2252;">"connectedPropertyCode"</span>: [
     <span style="color: #8b2252;">"height"</span>,
     <span style="color: #8b2252;">"depth"</span>,
     <span style="color: #8b2252;">"width"</span>,
     <span style="color: #8b2252;">"diameter"</span>
   ]
 },
 {
   <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/uniweimar/uniweimar-0.1/prop/TestObjective"</span>,
   <span style="color: #8b2252;">"code"</span>: <span style="color: #8b2252;">"TestObjective"</span>,
   <span style="color: #8b2252;">"connectedPropertyCode"</span>: [
     <span style="color: #8b2252;">"ComponentID"</span>,
     <span style="color: #8b2252;">"StructureID"</span>
   ]
 },
</pre>
</div>
</div>
</div>

<div id="outline-container-pagination" class="outline-4">
<h4 id="pagination"><span class="section-number-4">5.4.5.</span> Pagination</h4>
<div class="outline-text-4" id="text-pagination">
<p>
A significant limit of the original implementation is that it doesn't support pagination, i.e. fetching results in sections.
The refactored implementation supports this for any object.
Eg here we fetch 5 classifications from the largest domain, starting at number 100:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">Pagination</span> {
  domain(ID:<span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/nbs/uniclass2015-1"</span>) {
    classification(offset:100 limit:5) {
      id name
    }
  }
}
</pre>
</div>
<p>
Result:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"domain"</span>: [
  {
    <span style="color: #8b2252;">"classification"</span>: [
      {
        <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/nbs/uniclass2015-1/class/Ac_32_10_68"</span>,
        <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Propagating"</span>
      },
      {
        <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/nbs/uniclass2015-1/class/En_75_10_10"</span>,
        <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Broadcast communications buildings"</span>
      },
      {
        <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/nbs/uniclass2015-1/class/PM_40_50_12"</span>,
        <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Building codes approval"</span>
      },
      {
        <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/nbs/uniclass2015-1/class/Pr_40_30_30_32"</span>,
        <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Food preparation worktops"</span>
      },
      {
        <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/nbs/uniclass2015-1/class/Pr_60_60_38_42"</span>,
        <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Instantaneous plate heat exchangers"</span>
      }
    ]
  }
]
</pre>
</div>
</div>
</div>

<div id="outline-container-classifications-with-relations" class="outline-4">
<h4 id="classifications-with-relations"><span class="section-number-4">5.4.6.</span> Classifications with Relations</h4>
<div class="outline-text-4" id="text-classifications-with-relations">
<p>
We can easily find Classifications that have relations, then fetch data of their related Classifications:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">ClassificationRel</span> {
  classification(where:{relation:{}}) {
    id name
    relation {
      relationType
      related {
        id name
      }
    }
  }
}
</pre>
</div>
<p>
Please note that for each relation, this returns both the original Classification we started from, and the target Classification.
The reason is that the node <code>ClassificationRelation</code> has two <code>related</code> links:
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"classification"</span>: [
  {
    <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/ATALANE/REX-OBJ-1.0/class/262c5f4a-a631-4041-a5ea-569ebad4265b"</span>,
    <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Rev&#234;tement de sol r&#233;silient LVT acoustique &#224; poisser"</span>,
    <span style="color: #8b2252;">"relation"</span>: [
      {
        <span style="color: #8b2252;">"relationType"</span>: <span style="color: #8b2252;">"HasReference"</span>,
        <span style="color: #8b2252;">"related"</span>: [
          {
            <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/ATALANE/REX-OBJ-1.0/class/262c5f4a-a631-4041-a5ea-569ebad4265b"</span>,
            <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Rev&#234;tement de sol r&#233;silient LVT acoustique &#224; poisser"</span>
          },
          {
            <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCovering"</span>,
            <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcCovering"</span>
          }
        ]
      },
</pre>
</div>
</div>
</div>

<div id="outline-container-relations-of-classifications" class="outline-4">
<h4 id="relations-of-classifications"><span class="section-number-4">5.4.7.</span> Relations of Classifications</h4>
<div class="outline-text-4" id="text-relations-of-classifications">
<p>
We have implemented bidirectional graph navigation, so we can fetch related Classifications starting from <code>ClassificationRelation</code> instead of <code>Classification</code>:
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">ClassificationRel2</span> {
  classificationRelation {
    relationType
    related {
      id name
    }
  }
}
</pre>
</div>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8b2252;">"classificationRelation"</span>: [
   {
     <span style="color: #8b2252;">"relationType"</span>: <span style="color: #8b2252;">"HasReference"</span>,
     <span style="color: #8b2252;">"related"</span>: [
       {
         <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/ATALANE/REX-OBJ-1.0/class/262c5f4a-a631-4041-a5ea-569ebad4265b"</span>,
         <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"Rev&#234;tement de sol r&#233;silient LVT acoustique &#224; poisser"</span>
       },
       {
         <span style="color: #8b2252;">"id"</span>: <span style="color: #8b2252;">"https://identifier.buildingsmart.org/uri/buildingsmart/ifc-4.3/class/IfcCovering"</span>,
         <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"IfcCovering"</span>
       }
     ]
   },
</pre>
</div>
</div>
</div>

<div id="outline-container-length-properties" class="outline-4">
<h4 id="length-properties"><span class="section-number-4">5.4.8.</span> Length Properties</h4>
<div class="outline-text-4" id="text-length-properties">
<p>
Let's find all Properties with <code>dimension</code> vector indicating "length":
</p>
<div class="org-src-container">
<pre class="src src-graphql"><span style="color: #a020f0;">query</span> <span style="color: #0000ff;">LengthProps</span> {
  property(where:{dimension:{EQ:<span style="color: #8b2252;">"1 0 0 0 0 0 0"</span>}}) {
    physicalQuantity
    unit
  }
}
</pre>
</div>
<p>
We can now compare the variety associated with such properties, e.g.:
</p>
<ul class="org-ul">
<li><code>physicalQuantity</code>: "Epaisseur", "Longueur", "Lnge", "Flche je Lnge | de-DE", etc</li>
<li><code>unit</code>: "mm", "cm" but also stranger units like "mm/m"</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-graph-visualizations" class="outline-3">
<h3 id="graph-visualizations"><span class="section-number-3">5.5.</span> Graph Visualizations</h3>
<div class="outline-text-3" id="text-graph-visualizations">
<p>
In this section we show a couple of <a href="https://bsdd.ontotext.com/graphdb/graphs-visualizations">GraphDB visualizations</a> that we have implemented
to illustrate some more unusual Classifications and Properties.
Note: if you have a user account, you can enlarge "Maximum links to show" in Settings to see more nodes.
</p>
</div>

<div id="outline-container-composed-property-classifications" class="outline-4">
<h4 id="composed-property-classifications"><span class="section-number-4">5.5.1.</span> "COMPOSED_PROPERTY" Classifications</h4>
<div class="outline-text-4" id="text-composed-property-classifications">
<p>
<a href="https://bsdd.ontotext.com/graphdb/graphs-visualizations?config=2dc02fd322a646879505aafde547375a">This visualization</a> shows classifications of type "COMPOSED_PROPERTY" that serve as a container of related properties.
</p>


<div id="org0e70072" class="figure">
<p><img src="./img/viz-ClassCOMPOSED_PROPERTY.png" alt="viz-ClassCOMPOSED_PROPERTY.png" />
</p>
<p><span class="figure-number">Figure 11: </span>"COMPOSED_PROPERTY" Classifications</p>
</div>
</div>
</div>

<div id="outline-container-domain-classifications" class="outline-4">
<h4 id="domain-classifications"><span class="section-number-4">5.5.2.</span> "DOMAIN" Classifications</h4>
<div class="outline-text-4" id="text-domain-classifications">
<p>
<a href="https://bsdd.ontotext.com/graphdb/graphs-visualizations?config=7ecb0edaf0874c0aa81f2f0eb953b8ee">This visualization</a> shows classifications of type "DOMAIN" that serve as a "sub-domain" of Classifications.
Expanding a node shows its ClassificationProperties.
</p>


<div id="org01daf8b" class="figure">
<p><img src="./img/viz-ClassDOMAIN.png" alt="viz-ClassDOMAIN.png" />
</p>
<p><span class="figure-number">Figure 12: </span>"DOMAIN" Classifications</p>
</div>
</div>
</div>

<div id="outline-container-classification-relations" class="outline-4">
<h4 id="classification-relations"><span class="section-number-4">5.5.3.</span> Classification Relations</h4>
<div class="outline-text-4" id="text-classification-relations">
<p>
<a href="https://bsdd.ontotext.com/graphdb/graphs-visualizations?config=b977ae2529094192b469f3484029fc48">This visualizations</a> shows classifications that have relations (we ignore the relation name).
It shows a number of French classes relating to <code>Space, Slab, Covering</code>.
(Please note that another cluster that has "class" in the middle is due to data quality problems in BSDD.)
</p>


<div id="orgddb4630" class="figure">
<p><img src="./img/viz-ClassRel.png" alt="viz-ClassRel.png" />
</p>
<p><span class="figure-number">Figure 13: </span>Classification Relations</p>
</div>
</div>
</div>

<div id="outline-container-multivalued-propsets" class="outline-4">
<h4 id="multivalued-propsets"><span class="section-number-4">5.5.4.</span> Multivalued propSets</h4>
<div class="outline-text-4" id="text-multivalued-propsets">
<p>
<code>propSet</code> is expected to be single-valued by the GraphQL schema, but in fact there are some multi-valued occurrences.
<a href="https://bsdd.ontotext.com/graphdb/graphs-visualizations?config=fa3b8af3bc114b9b9046f9ceb11246f7">This visualization</a> looks for such cases (e.g. see this <a href="https://bsdd.ontotext.com/graphdb/graphs-visualizations?saved=56b5379edeeb4a1a80790e9011d8e264">saved visual graph</a>).
</p>


<div id="org6e4e7e9" class="figure">
<p><img src="./img/viz-multivaluedPropSet.png" alt="viz-multivaluedPropSet.png" />
</p>
<p><span class="figure-number">Figure 14: </span>Multivalued propSet, showing domain (purple), class (yellow), prop (red), set (blue)</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-acknowledgements" class="outline-2">
<h2 id="acknowledgements"><span class="section-number-2">6.</span> Acknowledgements</h2>
<div class="outline-text-2" id="text-acknowledgements">
<p>
This work is partially funded by the European Union's Horizon Europe research and innovation programme under grant agreement no 101056973 (ACCORD).
</p>

<p>
Author contributions:
</p>
<ul class="org-ul">
<li>VA conceived the work, described bSDD shortcomings, implemented GraphQL and RDF refactoring.</li>
<li>MK wrote GraphQL queries, fetched bSDD data, and deployed GraphDB and Ontotext Platform Semantic Objects.</li>
<li>NK performed statistics and comparisons of bSDD data and wrote the final paper.</li>
</ul>

<p>
We thank Lon van Berlo and Erik Baars from buildingSmart International for their help with accessing bSDD.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="creator">Exported by Emacs 28.1 (Org mode 9.5.2)</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
